------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/pei-chin/Research/FamaFrench_1993_Replication/logs/replication_log_ 2 Jan 2026.log
  log type:  text
 opened on:   2 Jan 2026, 14:11:50

. 
. * Display start time
. di "Replication started: `c(current_date)' `c(current_time)'"
Replication started:  2 Jan 2026 14:11:50

. di "Stata version: `c(stata_version)'"
Stata version: 18

. 
. /*------------------------------------------------------------------------------
>     Run individual do-files in sequence
> ------------------------------------------------------------------------------*/
. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. do "$root/code/01_data_preparation.do"
file /Users/pei-chin/Research/FamaFrench_1993_Replication/code/01_data_preparation.do not found
r(601);

end of do-file

r(601);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. do "$root/code/01_data_preparation.do"

. /*==============================================================================
>     01_data_preparation.do
>     
>     Purpose: Import and prepare data for Fama-French (1993) replication
>     
>     Input:  
>     - 25_Portfolios_5x5.csv (25 portfolios monthly returns)
>     - F-F_Research_Data_Factors.csv (FF3 factors)
>     
>     Output: 
>     - merged_data.dta (merged dataset ready for analysis)
> ==============================================================================*/
. 
. clear all

. 
. /*------------------------------------------------------------------------------
>     1. Import 25 Portfolios Data
> ------------------------------------------------------------------------------*/
. 
. * Import the 25 portfolios CSV
. * Note: Adjust the import command based on your actual file structure
. import delimited "$root/data/raw/25_Portfolios_5x5.csv", clear varnames(1)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/data/raw/25_Portfolios_5x5.csv not found
r(601);

end of do-file
r(601);

end of do-file

r(601);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. do "$root/code/01_data_preparation.do"

. /*==============================================================================
>     01_data_preparation.do
>     
>     Purpose: Import and prepare data for Fama-French (1993) replication
>     
>     Input:  
>     - 25_Portfolios_5x5.csv (25 portfolios monthly returns)
>     - F-F_Research_Data_Factors.csv (FF3 factors)
>     
>     Output: 
>     - merged_data.dta (merged dataset ready for analysis)
> ==============================================================================*/
. 
. clear all

. 
. /*------------------------------------------------------------------------------
>     1. Import 25 Portfolios Data
> ------------------------------------------------------------------------------*/
. 
. * Import the 25 portfolios CSV
. * Note: Adjust the import command based on your actual file structure
. import delimited "$root/data/raw/25_Portfolios_5x5.csv", clear varnames(1)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/data/raw/25_Portfolios_5x5.csv not found
r(601);

end of do-file
r(601);

end of do-file

r(601);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. do "$root/code/01_data_preparation.do"

. /*==============================================================================
>     01_data_preparation.do
>     
>     Purpose: Import and prepare data for Fama-French (1993) replication
>     
>     Input:  
>     - 25_Portfolios_5x5.csv (25 portfolios monthly returns)
>     - F-F_Research_Data_Factors.csv (FF3 factors)
>     
>     Output: 
>     - merged_data.dta (merged dataset ready for analysis)
> ==============================================================================*/
. 
. clear all

. 
. /*------------------------------------------------------------------------------
>     1. Import 25 Portfolios Data
> ------------------------------------------------------------------------------*/
. 
. * Import the 25 portfolios CSV
. * Note: Adjust the import command based on your actual file structure
. import delimited "$root/data/raw/25_Portfolios_5x5.csv", clear varnames(1)
(encoding automatically selected: ISO-8859-1)
(26 vars, 8,894 obs)

. 
. * The first column should be the date in YYYYMM format
. * Rename columns based on the structure: SMALL_LoBM, ME1_BM2, ... BIG_HiBM
. 
. * Assuming column names follow pattern like: 
. * Column 1 = date, Columns 2-26 = portfolio returns
. 
. * Rename the date variable
. rename v1 yyyymm
v1 ambiguous abbreviation
r(111);

end of do-file
r(111);

end of do-file

r(111);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     00_check_data_structure.do
>     
>     Purpose: Diagnose the structure of your CSV files before full import
>     
>     Run this FIRST to understand your data structure!
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. /*------------------------------------------------------------------------------
>     1. Check 25 Portfolios CSV Structure
> ------------------------------------------------------------------------------*/
. 
. di _newline(3) "=" * 70



=*70 invalid name
r(198);

end of do-file

r(198);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     00_check_data_structure.do (FIXED)
>     
>     Purpose: Diagnose the structure of your CSV files before full import
>     
>     Run this FIRST to understand your data structure!
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. /*------------------------------------------------------------------------------
>     1. Check 25 Portfolios CSV Structure
> ------------------------------------------------------------------------------*/
. 
. di ""


. di ""


. di "======================================================================"
======================================================================

. di "CHECKING: 25_Portfolios_5x5.csv"
CHECKING: 25_Portfolios_5x5.csv

. di "======================================================================"
======================================================================

. 
. * Import as strings to see everything
. import delimited "$root/data/raw/25_Portfolios_5x5.csv", clear stringcols(_all) varnames(nonames)
(encoding automatically selected: ISO-8859-1)
(26 vars, 8,895 obs)

. 
. * Show variable names
. describe, short

Contains data
 Observations:         8,895                  
    Variables:            26                  
Sorted by: 
     Note: Dataset has changed since last saved.

. 
. * Show first 20 rows
. di ""


. di "First 20 rows of the file:"
First 20 rows of the file:

. list v1 v2 v3 v4 v5 in 1/20, clean noobs

                                                                                                                               v1           v2  
>         v3          v4          v5  
                                                                            This file was created using the 202511 CRSP database.               
>                                     
                                              It contains value- and equal-weighted returns for portfolios formed on ME and BEME.               
>                                     
    The portfolios are constructed at the end of June.  BEME is book value at the last fiscal year end of the prior calendar year               
>                                     
                                                                          divided by ME at the end of December of the prior year.               
>                                     
                                                                                     Annual returns are from January to December.               
>                                     
                                                                                    Missing data are indicated by -99.99 or -999.               
>                                     
                                                                        The break points include utilities and include financials               
>                                     
                                                                       The  portfolios  include utilities and include financials.               
>                                     
                                                                                        Average Value Weighted Returns -- Monthly               
>                                     
                                                                                                                                    SMALL LoBM  
>    ME1 BM2     ME1 BM3     ME1 BM4  
                                                                                                                           192607       5.8276  
>    -1.7006      0.5118     -2.1477  
                                                                                                                           192608      -2.0206  
>    -8.0282      1.3968      2.1483  
                                                                                                                           192609      -4.8291  
>    -2.6806     -4.3417     -3.2683  
                                                                                                                           192610      -9.3633  
>    -3.5519     -3.5024      3.4413  
                                                                                                                           192611       5.5888  
>     4.1877      2.4384     -4.4495  
                                                                                                                           192612      14.9644  
>    -1.4263      0.0084      3.3801  
                                                                                                                           192701       1.0954  
>    -8.1352     -4.8280      3.0498  
                                                                                                                           192702       2.8672  
>    -0.4922      8.5078      5.2580  
                                                                                                                           192703       5.8224  
>    -0.0730     -5.8769     -3.9186  
                                                                                                                           192704       7.8274  
>     4.7880      4.3995      3.3905  

. 
. * Count total rows
. di ""


. di "Total rows in file: " _N
Total rows in file: 8895

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*------------------------------------------------------------------------------
>     2. Check Factors CSV Structure  
> ------------------------------------------------------------------------------*/
. 
. di ""


. di ""


. di "======================================================================"
======================================================================

. di "CHECKING: F-F_Research_Data_Factors.csv"
CHECKING: F-F_Research_Data_Factors.csv

. di "======================================================================"
======================================================================

. 
. import delimited "$root/data/raw/F-F_Research_Data_Factors.csv", clear stringcols(_all) varnames(nonames)
(encoding automatically selected: ISO-8859-1)
(5 vars, 1,293 obs)

. 
. * Show first 20 rows
. di ""


. di "First 20 rows of the file:"
First 20 rows of the file:

. list v1 v2 v3 v4 v5 in 1/20, clean noobs

                                                                                             v1                                                 
>                         v2        v3        v4        v5  
                                          This file was created using the 202507 CRSP database.                                                 
>                                                           
    The 1-month TBill rate data until 202405 are from Ibbotson Associates. Starting from 202406    the 1-month TBill rate is from ICE BofA US 1-
> Month Treasury Bill Index.                                
                                                                                                                                                
>                     Mkt-RF       SMB       HML        RF  
                                                                                         192607                                                 
>                       2.89     -2.55     -2.39      0.22  
                                                                                         192608                                                 
>                       2.64     -1.14      3.81      0.25  
                                                                                         192609                                                 
>                       0.38     -1.36      0.05      0.23  
                                                                                         192610                                                 
>                      -3.27     -0.14      0.82      0.32  
                                                                                         192611                                                 
>                       2.54     -0.11     -0.61      0.31  
                                                                                         192612                                                 
>                       2.62     -0.07      0.06      0.28  
                                                                                         192701                                                 
>                      -0.05     -0.32      4.58      0.25  
                                                                                         192702                                                 
>                       4.17      0.07      2.72      0.26  
                                                                                         192703                                                 
>                       0.14     -1.77     -2.38      0.30  
                                                                                         192704                                                 
>                       0.47      0.39      0.65      0.25  
                                                                                         192705                                                 
>                       5.45      1.55      4.80      0.30  
                                                                                         192706                                                 
>                      -2.38      0.51     -1.72      0.26  
                                                                                         192707                                                 
>                       7.26     -3.27     -1.13      0.30  
                                                                                         192708                                                 
>                       1.99     -0.77     -3.85      0.28  
                                                                                         192709                                                 
>                       4.77     -3.60     -0.57      0.21  
                                                                                         192710                                                 
>                      -4.29      2.03     -4.47      0.25  
                                                                                         192711                                                 
>                       6.52      2.78     -0.08      0.21  

. 
. * Count total rows
. di ""


. di "Total rows in file: " _N
Total rows in file: 1293

. 
. /*------------------------------------------------------------------------------
>     3. Recommendations
> ------------------------------------------------------------------------------*/
. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     01_data_preparation.do (FINAL FIXED VERSION)
>     
>     Purpose: Import and prepare data for Fama-French (1993) replication
>     
>     CSV Structure identified:
>     - Rows 1-9: Description text
>     - Row 10: Column headers (SMALL LoBM, ME1 BM2, etc.)
>     - Row 11+: Data starting from 192607
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. /*------------------------------------------------------------------------------
>     1. Import 25 Portfolios Data
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "Importing 25 Portfolios data..."
Importing 25 Portfolios data...

. 
. * Import CSV, skip first 10 rows (9 description + 1 header), use row 10 as varnames
. import delimited "$root/data/raw/25_Portfolios_5x5.csv", clear rowrange(11) varnames(10)
(encoding automatically selected: ISO-8859-1)
(26 vars, 8,888 obs)

. 
. * Check imported data
. describe, short

Contains data
 Observations:         8,888                  
    Variables:            26                  
Sorted by: 
     Note: Dataset has changed since last saved.

. list in 1/5

     +--------------------------------------------------------------------------------------------------------------------------------------+
  1. |                           thebreakpointsincludeutilitiesan |         v2 |        v3 |        v4 |        v5 |         v6 |        v7 |
     | The  portfolios  include utilities and include financials. |            |           |           |           |            |           |
     |--------------------------------------------------------------------------------------------------------------------------------------|
     |        v8 |        v9 |       v10 |       v11 |       v12 |       v13 |       v14 |       v15 |       v16  |       v17  |       v18  |
     |           |           |           |           |           |           |           |           |            |            |            |
     |-----------------------------------------------------------------------------------+--------------------------------------------------|
     |         v19   |         v20    |         v21    |         v22    |         v23    |         v24    |         v25    |         v26    |
     |               |                |                |                |                |                |                |                |
     +--------------------------------------------------------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------------------------------------------------------+
  2. |                           thebreakpointsincludeutilitiesan |         v2 |        v3 |        v4 |        v5 |         v6 |        v7 |
     |                  Average Value Weighted Returns -- Monthly |            |           |           |           |            |           |
     |--------------------------------------------------------------------------------------------------------------------------------------|
     |        v8 |        v9 |       v10 |       v11 |       v12 |       v13 |       v14 |       v15 |       v16  |       v17  |       v18  |
     |           |           |           |           |           |           |           |           |            |            |            |
     |-----------------------------------------------------------------------------------+--------------------------------------------------|
     |         v19   |         v20    |         v21    |         v22    |         v23    |         v24    |         v25    |         v26    |
     |               |                |                |                |                |                |                |                |
     +--------------------------------------------------------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------------------------------------------------------+
  3. |                           thebreakpointsincludeutilitiesan |         v2 |        v3 |        v4 |        v5 |         v6 |        v7 |
     |                                                            | SMALL LoBM |   ME1 BM2 |   ME1 BM3 |   ME1 BM4 | SMALL HiBM |   ME2 BM1 |
     |--------------------------------------------------------------------------------------------------------------------------------------|
     |        v8 |        v9 |       v10 |       v11 |       v12 |       v13 |       v14 |       v15 |       v16  |       v17  |       v18  |
     |   ME2 BM2 |   ME2 BM3 |   ME2 BM4 |   ME2 BM5 |   ME3 BM1 |   ME3 BM2 |   ME3 BM3 |   ME3 BM4 |   ME3 BM5  |   ME4 BM1  |   ME4 BM2  |
     |-----------------------------------------------------------------------------------+--------------------------------------------------|
     |         v19   |         v20    |         v21    |         v22    |         v23    |         v24    |         v25    |         v26    |
     |     ME4 BM3   |     ME4 BM4    |     ME4 BM5    |    BIG LoBM    |     ME5 BM2    |     ME5 BM3    |     ME5 BM4    |    BIG HiBM    |
     +--------------------------------------------------------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------------------------------------------------------+
  4. |                           thebreakpointsincludeutilitiesan |         v2 |        v3 |        v4 |        v5 |         v6 |        v7 |
     |                                                     192607 |     5.8276 |   -1.7006 |    0.5118 |   -2.1477 |     1.9583 |    1.2118 |
     |--------------------------------------------------------------------------------------------------------------------------------------|
     |        v8 |        v9 |       v10 |       v11 |       v12 |       v13 |       v14 |       v15 |       v16  |       v17  |       v18  |
     |    2.4107 |    0.6056 |   -2.6082 |   -0.4527 |    1.9071 |    2.4491 |   -0.4399 |    3.7289 |   -1.2629  |    1.5376  |    1.5460  |
     |-----------------------------------------------------------------------------------+--------------------------------------------------|
     |         v19   |         v20    |         v21    |         v22    |         v23    |         v24    |         v25    |         v26    |
     |      1.3389   |      0.2765    |      2.4678    |      3.3248    |      6.0909    |      2.0285    |      3.1263    |      0.5623    |
     +--------------------------------------------------------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------------------------------------------------------+
  5. |                           thebreakpointsincludeutilitiesan |         v2 |        v3 |        v4 |        v5 |         v6 |        v7 |
     |                                                     192608 |    -2.0206 |   -8.0282 |    1.3968 |    2.1483 |     8.5104 |    2.3620 |
     |--------------------------------------------------------------------------------------------------------------------------------------|
     |        v8 |        v9 |       v10 |       v11 |       v12 |       v13 |       v14 |       v15 |       v16  |       v17  |       v18  |
     |   -0.7525 |    3.8984 |    0.2299 |    6.2937 |   -0.9386 |    2.3875 |    1.9916 |    4.3179 |    8.1142  |    1.3858  |    3.8587  |
     |-----------------------------------------------------------------------------------+--------------------------------------------------|
     |         v19   |         v20    |         v21    |         v22    |         v23    |         v24    |         v25    |         v26    |
     |      1.9738   |      2.1336    |      5.3422    |      1.0169    |      4.1975    |      1.9769    |      5.4924    |      7.7576    |
     +--------------------------------------------------------------------------------------------------------------------------------------+

. 
. * The first variable should be the date (named something like "v1" or a weird name)
. * Let's rename based on position
. 
. * Get the name of the first variable and rename it
. ds
thebreakpo~n  v4            v7            v10           v13           v16           v19           v22           v25
v2            v5            v8            v11           v14           v17           v20           v23           v26
v3            v6            v9            v12           v15           v18           v21           v24

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. * Destring date
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced as long
(36 missing values generated)

. 
. * Drop any non-data rows (missing dates)
. drop if yyyymm == .
(36 observations deleted)

. drop if yyyymm < 100000
(196 observations deleted)

. 
. * Now rename the 25 portfolio variables
. * Order in Ken French data: Size 1-5 (rows) Ã— BM 1-5 (columns)
. * SMALL_LoBM = Size1_BM1, ME1_BM2 = Size1_BM2, ... BIG_HiBM = Size5_BM5
. 
. * Get remaining variable names
. ds yyyymm, not
v2   v3   v4   v5   v6   v7   v8   v9   v10  v11  v12  v13  v14  v15  v16  v17  v18  v19  v20  v21  v22  v23  v24  v25  v26

. local portvars `r(varlist)'

. 
. * Count - should be 25
. local nvars : word count `portvars'

. di "Number of portfolio variables: `nvars'"
Number of portfolio variables: 25

. 
. * Rename them systematically
. local i = 1

. foreach var of local portvars {
  2.     * Calculate size (1-5) and BM (1-5) from position
.     local size = ceil(`i'/5)
  3.     local bm = `i' - (`size'-1)*5
  4.     
.     rename `var' p`size'`bm'
  5.     local i = `i' + 1
  6. }

. 
. * Destring all portfolio returns
. foreach var of varlist p* {
  2.     cap destring `var', replace force
  3. }

. 
. * Replace missing codes with Stata missing
. foreach var of varlist p* {
  2.     replace `var' = . if `var' < -90
  3. }
(12 real changes made, 12 to missing)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. * Create date variables
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. * Sort and save temp
. sort date

. tempfile portfolios

. save `portfolios'
file /var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//S_59607.000001 saved as .dta format

. 
. di ""


. di "Portfolio data: " _N " observations"
Portfolio data: 8656 observations

. di "Date range: " yyyymm[1] " to " yyyymm[_N]
Date range: 192607 to 202511

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*------------------------------------------------------------------------------
>     2. Import Fama-French Factors
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "Importing Fama-French factors..."
Importing Fama-French factors...

. 
. * Check structure first - factors file likely has similar structure
. import delimited "$root/data/raw/F-F_Research_Data_Factors.csv", clear rowrange(4) varnames(3)
(encoding automatically selected: ISO-8859-1)
(5 vars, 1,290 obs)

. 
. * Check what we got
. describe, short

Contains data
 Observations:         1,290                  
    Variables:             5                  
Sorted by: 
     Note: Dataset has changed since last saved.

. list in 1/5

     +------------------------------------------------+
     |     v1     mktrf       smb       hml        rf |
     |------------------------------------------------|
  1. | 192607      2.89     -2.55     -2.39      0.22 |
  2. | 192608      2.64     -1.14      3.81      0.25 |
  3. | 192609      0.38     -1.36      0.05      0.23 |
  4. | 192610     -3.27     -0.14      0.82      0.32 |
  5. | 192611      2.54     -0.11     -0.61      0.31 |
     +------------------------------------------------+

. 
. * Rename first variable to yyyymm
. ds
v1     mktrf  smb    hml    rf

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. * Destring
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced as long
(3 missing values generated)

. 
. * Keep valid data rows only
. drop if yyyymm == .
(3 observations deleted)

. drop if yyyymm < 100000
(98 observations deleted)

. 
. * Get factor variable names and rename
. ds yyyymm, not
mktrf  smb    hml    rf

. local facvars `r(varlist)'

. 
. * The factors should be: Mkt-RF, SMB, HML, RF (in that order)
. local i = 1

. foreach var of local facvars {
  2.     if `i' == 1 rename `var' mktrf
  3.     if `i' == 2 rename `var' smb
  4.     if `i' == 3 rename `var' hml
  5.     if `i' == 4 rename `var' rf
  6.     local i = `i' + 1
  7.     if `i' > 4 continue, break
  8. }
  (all newnames==oldnames)
  (all newnames==oldnames)
  (all newnames==oldnames)
  (all newnames==oldnames)

. 
. * Destring factors
. foreach var in mktrf smb hml rf {
  2.     cap destring `var', replace force
  3. }

. 
. * Handle missing
. foreach var in mktrf smb hml rf {
  2.     cap replace `var' = . if `var' < -90
  3. }

. 
. * Create date variables
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. keep date yyyymm year month mktrf smb hml rf

. sort date

. 
. di ""


. di "Factor data: " _N " observations"
Factor data: 1189 observations

. 
. /*------------------------------------------------------------------------------
>     3. Merge Datasets

end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. 
. di ""


. di "Merging datasets..."
Merging datasets...

. 
. merge 1:1 date using `portfolios', nogen keep(match)
invalid file specification
r(198);

end of do-file

r(198);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     01_data_preparation_final.do (COMPLETE VERSION)
>     
>     Purpose: Import and prepare data for Fama-French (1993) replication
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. /*------------------------------------------------------------------------------
>     1. Import 25 Portfolios Data
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Step 1: Importing 25 Portfolios data..."
Step 1: Importing 25 Portfolios data...

. di "======================================================================"
======================================================================

. 
. * Import CSV, skip first 10 rows, use row 10 as varnames
. import delimited "$root/data/raw/25_Portfolios_5x5.csv", clear rowrange(11) varnames(10)
(encoding automatically selected: ISO-8859-1)
(26 vars, 8,888 obs)

. 
. * Get the name of the first variable and rename it to yyyymm
. ds
thebreakpo~n  v4            v7            v10           v13           v16           v19           v22           v25
v2            v5            v8            v11           v14           v17           v20           v23           v26
v3            v6            v9            v12           v15           v18           v21           v24

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. * Destring date
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced as long
(36 missing values generated)

. 
. * Drop non-data rows
. drop if yyyymm == .
(36 observations deleted)

. drop if yyyymm < 100000
(196 observations deleted)

. 
. * Rename the 25 portfolio variables
. ds yyyymm, not
v2   v3   v4   v5   v6   v7   v8   v9   v10  v11  v12  v13  v14  v15  v16  v17  v18  v19  v20  v21  v22  v23  v24  v25  v26

. local portvars `r(varlist)'

. 
. local i = 1

. foreach var of local portvars {
  2.     local size = ceil(`i'/5)
  3.     local bm = `i' - (`size'-1)*5
  4.     rename `var' p`size'`bm'
  5.     local i = `i' + 1
  6. }

. 
. * Destring all portfolio returns
. foreach var of varlist p* {
  2.     cap destring `var', replace force
  3. }

. 
. * Replace missing codes with Stata missing
. foreach var of varlist p* {
  2.     replace `var' = . if `var' < -90
  3. }
(12 real changes made, 12 to missing)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. * Create date variables
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. sort date

. tempfile portfolios

. save `portfolios'
file /var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//S_59607.000001 saved as .dta format

. 
. di "Portfolio data: " _N " observations"
Portfolio data: 8656 observations

. di "Date range: " yyyymm[1] " to " yyyymm[_N]
Date range: 192607 to 202511

. 
. /*------------------------------------------------------------------------------
>     2. Import Fama-French Factors
> ------------------------------------------------------------------------------*/
. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*------------------------------------------------------------------------------
>     2. Import Fama-French Factors
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Step 2: Importing Fama-French Factors..."
Step 2: Importing Fama-French Factors...

. di "======================================================================"
======================================================================

. 
. * First, check the structure of factors file
. import delimited "$root/data/raw/F-F_Research_Data_Factors.csv", clear stringcols(_all) varnames(nonames)
(encoding automatically selected: ISO-8859-1)
(5 vars, 1,293 obs)

. 
. * Show first 10 rows to understand structure
. di "First 10 rows of factors file:"
First 10 rows of factors file:

. list v1 v2 v3 v4 v5 in 1/10, clean noobs

                                                                                             v1                                                 
>                         v2        v3        v4        v5  
                                          This file was created using the 202507 CRSP database.                                                 
>                                                           
    The 1-month TBill rate data until 202405 are from Ibbotson Associates. Starting from 202406    the 1-month TBill rate is from ICE BofA US 1-
> Month Treasury Bill Index.                                
                                                                                                                                                
>                     Mkt-RF       SMB       HML        RF  
                                                                                         192607                                                 
>                       2.89     -2.55     -2.39      0.22  
                                                                                         192608                                                 
>                       2.64     -1.14      3.81      0.25  
                                                                                         192609                                                 
>                       0.38     -1.36      0.05      0.23  
                                                                                         192610                                                 
>                      -3.27     -0.14      0.82      0.32  
                                                                                         192611                                                 
>                       2.54     -0.11     -0.61      0.31  
                                                                                         192612                                                 
>                       2.62     -0.07      0.06      0.28  
                                                                                         192701                                                 
>                      -0.05     -0.32      4.58      0.25  

. 
. * Now import properly - factors file typically has 3 header rows
. * Row 1: description, Row 2: blank or more description, Row 3: column names
. * Data starts around row 4
. 
. clear

. import delimited "$root/data/raw/F-F_Research_Data_Factors.csv", clear rowrange(5) varnames(4)
(encoding automatically selected: ISO-8859-1)
(5 vars, 1,290 obs)

. 
. describe, short

Contains data
 Observations:         1,290                  
    Variables:             5                  
Sorted by: 
     Note: Dataset has changed since last saved.

. list in 1/5

     +------------------------------------------------+
     |     v1     mktrf       smb       hml        rf |
     |------------------------------------------------|
  1. | 192607      2.89     -2.55     -2.39      0.22 |
  2. | 192608      2.64     -1.14      3.81      0.25 |
  3. | 192609      0.38     -1.36      0.05      0.23 |
  4. | 192610     -3.27     -0.14      0.82      0.32 |
  5. | 192611      2.54     -0.11     -0.61      0.31 |
     +------------------------------------------------+

. 
. * Rename first variable to yyyymm
. ds
v1     mktrf  smb    hml    rf

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. * Destring
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced as long
(3 missing values generated)

. 
. * Keep valid monthly data only (6-digit YYYYMM format)
. * This also removes annual data that might be at the end of the file
. drop if yyyymm == .
(3 observations deleted)

. drop if yyyymm < 100000
(98 observations deleted)

. drop if yyyymm > 209912
(0 observations deleted)

. 
. * Rename factor variables
. ds yyyymm, not
mktrf  smb    hml    rf

. local facvars `r(varlist)'

. di "Factor variables found: `facvars'"
Factor variables found: mktrf smb hml rf

. 
. * Rename based on position (Mkt-RF, SMB, HML, RF)
. local newnames "mktrf smb hml rf"

. local i = 1

. foreach var of local facvars {
  2.     local newname : word `i' of `newnames'
  3.     if "`newname'" != "" {
  4.         rename `var' `newname'
  5.     }
  6.     local i = `i' + 1
  7. }
  (all newnames==oldnames)
  (all newnames==oldnames)
  (all newnames==oldnames)
  (all newnames==oldnames)

. 
. * Destring factors
. foreach var in mktrf smb hml rf {
  2.     cap destring `var', replace force
  3. }

. 
. * Handle missing values
. foreach var in mktrf smb hml rf {
  2.     cap replace `var' = . if `var' < -90
  3. }

. 
. * Create date variables
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. keep date yyyymm year month mktrf smb hml rf

. sort date

. 
. di "Factor data: " _N " observations"
Factor data: 1189 observations

. di "Date range: " yyyymm[1] " to " yyyymm[_N]
Date range: 192607 to 202507

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. 
. /*------------------------------------------------------------------------------
>     3. Merge Datasets
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Step 3: Merging datasets..."
Step 3: Merging datasets...

. di "======================================================================"
======================================================================

. 
. merge 1:1 date using `portfolios', nogen keep(match)
invalid file specification
r(198);

end of do-file

r(198);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     01_data_preparation_complete.do (FIXED)
>     
>     Purpose: Import and prepare data for Fama-French (1993) replication
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. * Create directories if needed
. cap mkdir "$root/data"

. cap mkdir "$root/data/processed"

. 
. /*------------------------------------------------------------------------------
>     1. Import 25 Portfolios Data
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Step 1: Importing 25 Portfolios data..."
Step 1: Importing 25 Portfolios data...

. di "======================================================================"
======================================================================

. 
. import delimited "$root/data/raw/25_Portfolios_5x5.csv", clear rowrange(11) varnames(10)
(encoding automatically selected: ISO-8859-1)
(26 vars, 8,888 obs)

. 
. * Rename first variable to yyyymm
. ds
thebreakpo~n  v4            v7            v10           v13           v16           v19           v22           v25
v2            v5            v8            v11           v14           v17           v20           v23           v26
v3            v6            v9            v12           v15           v18           v21           v24

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced as long
(36 missing values generated)

. drop if yyyymm == .
(36 observations deleted)

. drop if yyyymm < 100000
(196 observations deleted)

. 
. * Rename 25 portfolio variables
. ds yyyymm, not
v2   v3   v4   v5   v6   v7   v8   v9   v10  v11  v12  v13  v14  v15  v16  v17  v18  v19  v20  v21  v22  v23  v24  v25  v26

. local portvars `r(varlist)'

. 
. local i = 1

. foreach var of local portvars {
  2.     local size = ceil(`i'/5)
  3.     local bm = `i' - (`size'-1)*5
  4.     rename `var' p`size'`bm'
  5.     local i = `i' + 1
  6. }

. 
. * Destring and clean
. foreach var of varlist p* {
  2.     cap destring `var', replace force
  3. }

. 
. foreach var of varlist p* {
  2.     replace `var' = . if `var' < -90
  3. }
(12 real changes made, 12 to missing)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. * Create date variables
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. sort date

. 
. di "Portfolio data: " _N " observations"
Portfolio data: 8656 observations

. di "Date range: " yyyymm[1] " to " yyyymm[_N]
Date range: 192607 to 202511

. 
. * Save to actual file (not tempfile)
. save "$root/data/processed/portfolios_temp.dta", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/data/processed/portfolios_temp.dta not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/data/processed/portfolios_temp.dta saved

. 
. /*------------------------------------------------------------------------------
>     2. Import Fama-French Factors
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Step 2: Importing Fama-French Factors..."
Step 2: Importing Fama-French Factors...

. di "======================================================================"
======================================================================

. 
. clear

. import delimited "$root/data/raw/F-F_Research_Data_Factors.csv", clear rowrange(5) varnames(4)
(encoding automatically selected: ISO-8859-1)
(5 vars, 1,290 obs)

. 
. * Rename first variable to yyyymm
. ds
v1     mktrf  smb    hml    rf

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced as long
(3 missing values generated)

. drop if yyyymm == .
(3 observations deleted)

. drop if yyyymm < 100000
(98 observations deleted)

. drop if yyyymm > 209912
(0 observations deleted)

. 
. * Destring factors
. foreach var in mktrf smb hml rf {
  2.     cap destring `var', replace force
  3. }

. 
. foreach var in mktrf smb hml rf {
  2.     cap replace `var' = . if `var' < -90
  3. }

. 
. * Create date variables
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. keep date yyyymm year month mktrf smb hml rf

. sort date

. 
. di "Factor data: " _N " observations"
Factor data: 1189 observations

. di "Date range: " yyyymm[1] " to " yyyymm[_N]
Date range: 192607 to 202507

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*------------------------------------------------------------------------------
>     3. Merge Datasets
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Step 3: Merging datasets..."
Step 3: Merging datasets...

. di "======================================================================"
======================================================================

. 
. * Merge with portfolios data
. merge 1:1 date using "$root/data/processed/portfolios_temp.dta", nogen keep(match)
variable date does not uniquely identify observations in the using data
r(459);

end of do-file

r(459);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     01_data_preparation_v4.do
>     
>     Purpose: Import and prepare data for Fama-French (1993) replication
>     
>     Note: Ken French's 25 Portfolios file contains MULTIPLE sections:
>     - Value-weighted returns (what we want)
>     - Equal-weighted returns
>     - etc.
>     We only need the first section (value-weighted).
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. cap mkdir "$root/data"

. cap mkdir "$root/data/processed"

. 
. /*------------------------------------------------------------------------------
>     1. Import 25 Portfolios Data (Value-Weighted Only)
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Step 1: Importing 25 Portfolios data..."
Step 1: Importing 25 Portfolios data...

. di "======================================================================"
======================================================================

. 
. * First, let's understand the file structure
. import delimited "$root/data/raw/25_Portfolios_5x5.csv", clear stringcols(_all) varnames(nonames)
(encoding automatically selected: ISO-8859-1)
(26 vars, 8,895 obs)

. 
. * Find rows that look like section headers (contain text, not numbers)
. * Look for where "Equal" or "Annual" appears - this marks a new section
. gen rownum = _n

. gen is_header = regexm(v1, "[A-Za-z]")

. gen is_date = regexm(v1, "^[0-9]{6}$")

. 
. * List rows that might be section breaks
. di "Potential section headers:"
Potential section headers:

. list rownum v1 v2 if is_header == 1 & rownum > 10 in 1/50

. 
. * Find the first section break after data starts
. summarize rownum if is_header == 1 & rownum > 15

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      rownum |         24    5809.125    2121.418       1204       8895

. local section_end = r(min) - 1

. 
. di ""


. di "First data section ends at row: `section_end'"
First data section ends at row: 1203

. 
. * Now import just the value-weighted section
. clear

. import delimited "$root/data/raw/25_Portfolios_5x5.csv", clear rowrange(11:`section_end') varnames(10)
(encoding automatically selected: ISO-8859-1)
(26 vars, 1,190 obs)

. 
. * Rename first variable to yyyymm
. ds
thebreakpo~n  v4            v7            v10           v13           v16           v19           v22           v25
v2            v5            v8            v11           v14           v17           v20           v23           v26
v3            v6            v9            v12           v15           v18           v21           v24

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced as long
(3 missing values generated)

. drop if yyyymm == .
(3 observations deleted)

. drop if yyyymm < 100000
(0 observations deleted)

. 
. * Check for duplicates
. duplicates report yyyymm

Duplicates in terms of yyyymm

--------------------------------------
   Copies | Observations       Surplus
----------+---------------------------
        1 |         1187             0
--------------------------------------

. duplicates list yyyymm if yyyymm != .

Duplicates in terms of yyyymm

(0 observations are duplicates)

. 
. * Rename 25 portfolio variables
. ds yyyymm, not
v2   v3   v4   v5   v6   v7   v8   v9   v10  v11  v12  v13  v14  v15  v16  v17  v18  v19  v20  v21  v22  v23  v24  v25  v26

. local portvars `r(varlist)'

. local nvars : word count `portvars'

. di "Number of portfolio variables: `nvars'"
Number of portfolio variables: 25

. 
. local i = 1

. foreach var of local portvars {
  2.     local size = ceil(`i'/5)
  3.     local bm = `i' - (`size'-1)*5
  4.     rename `var' p`size'`bm'
  5.     local i = `i' + 1
  6. }

. 
. * Destring and clean
. foreach var of varlist p* {
  2.     cap destring `var', replace force
  3. }

. 
. foreach var of varlist p* {
  2.     replace `var' = . if `var' < -90
  3. }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. * Create date variables
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. sort date

. 
. * Verify uniqueness
. isid date

. di "Portfolio data: " _N " observations (unique by date)"
Portfolio data: 1187 observations (unique by date)

. di "Date range: " yyyymm[1] " to " yyyymm[_N]
Date range: 192607 to 202505

. 
. save "$root/data/processed/portfolios_temp.dta", replace
file /Users/pei-chin/Research/FamaFrench_1993_Replication/data/processed/portfolios_temp.dta saved

. 
. /*------------------------------------------------------------------------------
>     2. Import Fama-French Factors
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Step 2: Importing Fama-French Factors..."
Step 2: Importing Fama-French Factors...

. di "======================================================================"
======================================================================

. 
. clear

. import delimited "$root/data/raw/F-F_Research_Data_Factors.csv", clear rowrange(5) varnames(4)
(encoding automatically selected: ISO-8859-1)
(5 vars, 1,290 obs)

. 
. ds
v1     mktrf  smb    hml    rf

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced as long
(3 missing values generated)

. drop if yyyymm == .
(3 observations deleted)

. drop if yyyymm < 100000
(98 observations deleted)

. drop if yyyymm > 209912
(0 observations deleted)

. 
. foreach var in mktrf smb hml rf {
  2.     cap destring `var', replace force
  3.     cap replace `var' = . if `var' < -90
  4. }

. 
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. keep date yyyymm year month mktrf smb hml rf

. sort date

. 
. * Check for duplicates in factors too
. duplicates report date

Duplicates in terms of date

--------------------------------------
   Copies | Observations       Surplus
----------+---------------------------
        1 |         1189             0
--------------------------------------

. bysort date: keep if _n == 1
(0 observations deleted)

. 
. di "Factor data: " _N " observations"
Factor data: 1189 observations

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

.     3. Merge Datasets
3. is not a valid command name
r(199);

end of do-file

r(199);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. 
. /*------------------------------------------------------------------------------
>     3. Merge Datasets
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Step 3: Merging datasets..."
Step 3: Merging datasets...

. di "======================================================================"
======================================================================

. 
. merge 1:1 date using "$root/data/processed/portfolios_temp.dta", nogen keep(match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             1,187  
    -----------------------------------------

. sort date

. 
. di "Merged data: " _N " observations"
Merged data: 1187 observations

. di "Date range: " %tm date[1] " to " %tm date[_N]
Date range:  1926m7 to  2025m5

. 
. cap erase "$root/data/processed/portfolios_temp.dta"

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*------------------------------------------------------------------------------
>     4. Calculate Excess Returns
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Step 4: Calculating excess returns..."
Step 4: Calculating excess returns...

. di "======================================================================"
======================================================================

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         gen exret`size'`bm' = p`size'`bm' - rf
  4.     }
  5. }

. 
. di "Created 25 excess return variables"
Created 25 excess return variables

. 
. /*------------------------------------------------------------------------------

end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*------------------------------------------------------------------------------
>     5. Save Final Dataset
> ------------------------------------------------------------------------------*/
. 
. order date yyyymm year month mktrf smb hml rf p* exret*

. compress
  variable date was float now int
  variable year was float now int
  variable month was float now byte
  (8,309 bytes saved)

. save "$root/data/processed/merged_data.dta", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/data/processed/merged_data.dta not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/data/processed/merged_data.dta saved

. 
. /*------------------------------------------------------------------------------
>     6. Summary
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "DATA PREPARATION COMPLETE!"
DATA PREPARATION COMPLETE!

. di "======================================================================"
======================================================================

. di ""


. di "Output: $root/data/processed/merged_data.dta"
Output: /Users/pei-chin/Research/FamaFrench_1993_Replication/data/processed/merged_data.dta

. di "Sample: " %tm date[1] " to " %tm date[_N]
Sample:  1926m7 to  2025m5

. di "N = " _N " months"
N = 1187 months

. di ""


. di "Factor Summary:"
Factor Summary:

. summarize mktrf smb hml rf

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       mktrf |      1,187    .6841618    5.320598     -28.74      38.81
         smb |      1,187    .1637742    3.158712     -17.41      35.96
         hml |      1,187    .3463606     3.55905     -13.83      35.52
          rf |      1,187     .269604    .2495654       -.06       1.35

. 
. di ""


. di "Portfolio Excess Returns (corners):"
Portfolio Excess Returns (corners):

. summarize exret11 exret15 exret51 exret55

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     exret11 |      1,187    .5509995    11.91993    -49.503   147.8201
     exret15 |      1,187    1.330208    9.169148   -33.0903    99.4873
     exret51 |      1,187    .6840005    5.341898   -28.4828    32.3293
     exret55 |      1,187    .9486664    8.457548   -45.5856    98.0192

. 
. di ""


. di "======================================================================"
======================================================================

. 
end of do-file

. use "/Users/pei-chin/Research/FamaFrench_1993_Replication/data/processed/merged_data.dta"

. describe

Contains data from /Users/pei-chin/Research/FamaFrench_1993_Replication/data/processed/merged_data.dta
 Observations:         1,187                  
    Variables:            58                  2 Jan 2026 14:28
------------------------------------------------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------------------------------------------------
date            int     %tm                   
yyyymm          long    %10.0g                
year            int     %9.0g                 
month           byte    %9.0g                 
mktrf           double  %10.0g                Mkt-RF
smb             double  %10.0g                SMB
hml             double  %10.0g                HML
rf              double  %10.0g                RF
p11             double  %10.0g                
p12             double  %10.0g                
p13             double  %10.0g                
p14             double  %10.0g                
p15             double  %10.0g                
p21             double  %10.0g                
p22             double  %10.0g                
p23             double  %10.0g                
p24             double  %10.0g                
p25             double  %10.0g                
p31             double  %10.0g                
p32             double  %10.0g                
p33             double  %10.0g                
p34             double  %10.0g                
p35             double  %10.0g                
p41             double  %10.0g                
p42             double  %10.0g                
p43             double  %10.0g                
p44             double  %10.0g                
p45             double  %10.0g                
p51             double  %10.0g                
p52             double  %10.0g                
p53             double  %10.0g                
p54             double  %10.0g                
p55             double  %10.0g                
exret11         float   %9.0g                 
exret12         float   %9.0g                 
exret13         float   %9.0g                 
exret14         float   %9.0g                 
exret15         float   %9.0g                 
exret21         float   %9.0g                 
exret22         float   %9.0g                 
exret23         float   %9.0g                 
exret24         float   %9.0g                 
exret25         float   %9.0g                 
exret31         float   %9.0g                 
exret32         float   %9.0g                 
exret33         float   %9.0g                 
exret34         float   %9.0g                 
exret35         float   %9.0g                 
exret41         float   %9.0g                 
exret42         float   %9.0g                 
exret43         float   %9.0g                 
exret44         float   %9.0g                 
exret45         float   %9.0g                 
exret51         float   %9.0g                 
exret52         float   %9.0g                 
exret53         float   %9.0g                 
exret54         float   %9.0g                 
exret55         float   %9.0g                 
------------------------------------------------------------------------------------------------------------------------------------------------
Sorted by: date

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     02_summary_statistics.do
>     
>     Purpose: Replicate Fama-French (1993) Table 2
>              Summary statistics for 25 portfolios and factors
>     
>     Input:  merged_data.dta
>     Output: Summary statistics tables
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. * Create output directory
. cap mkdir "$root/output"

. cap mkdir "$root/output/tables"

. 
. * Load data
. use "$root/data/processed/merged_data.dta", clear

. 
. di ""


. di "======================================================================"
======================================================================

. di "SUMMARY STATISTICS - Replicating Table 2"
SUMMARY STATISTICS - Replicating Table 2

. di "======================================================================"
======================================================================

. di ""


. di "Sample period: " %tm date[1] " to " %tm date[_N]
Sample period:  1926m7 to  2025m5

. di "Number of months: " _N
Number of months: 1187

. di "======================================================================"
======================================================================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. 
. /*------------------------------------------------------------------------------
>     1. Factor Summary Statistics
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 1: Factor Summary Statistics"
Part 1: Factor Summary Statistics

. di "======================================================================"
======================================================================

. di ""


. 
. * Calculate statistics for each factor
. foreach var in mktrf smb hml rf {
  2.     quietly summarize `var'
  3.     local mean_`var' = r(mean)
  4.     local sd_`var' = r(sd)
  5.     local n_`var' = r(N)
  6.     local tstat_`var' = `mean_`var'' / (`sd_`var'' / sqrt(`n_`var''))
  7. }

. 
. di "Factor         Mean     Std Dev    t-stat     N"
Factor         Mean     Std Dev    t-stat     N

. di "------------------------------------------------------"
------------------------------------------------------

. di "Mkt-RF      " %8.3f `mean_mktrf' "   " %8.3f `sd_mktrf' "   " %6.2f `tstat_mktrf' "   " `n_mktrf'
Mkt-RF         0.684      5.321     4.43   1187

. di "SMB         " %8.3f `mean_smb' "   " %8.3f `sd_smb' "   " %6.2f `tstat_smb' "   " `n_smb'
SMB            0.164      3.159     1.79   1187

. di "HML         " %8.3f `mean_hml' "   " %8.3f `sd_hml' "   " %6.2f `tstat_hml' "   " `n_hml'
HML            0.346      3.559     3.35   1187

. di "RF          " %8.3f `mean_rf' "   " %8.3f `sd_rf' "   " %6.2f `tstat_rf' "   " `n_rf'
RF             0.270      0.250    37.22   1187

. di "------------------------------------------------------"
------------------------------------------------------

. 
. /*------------------------------------------------------------------------------

end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. 
. /*------------------------------------------------------------------------------
>     2. Portfolio Mean Excess Returns (5x5 Matrix)
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 2: Mean Excess Returns (% per month)"
Part 2: Mean Excess Returns (% per month)

. di "======================================================================"
======================================================================

. di ""


. di "Rows = Size (1=Small to 5=Big)"
Rows = Size (1=Small to 5=Big)

. di "Cols = Book-to-Market (1=Low/Growth to 5=High/Value)"
Cols = Book-to-Market (1=Low/Growth to 5=High/Value)

. di ""


. 
. * Create matrix for mean returns
. matrix mean_ret = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly summarize exret`size'`bm'
  4.         matrix mean_ret[`size', `bm'] = r(mean)
  5.     }
  6. }

. 
. * Display matrix
. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "          (Growth)                               (Value)"
          (Growth)                               (Value)

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f mean_ret[`size',1] %8.3f mean_ret[`size',2] %8.3f mean_ret[`size',3] %8.3f mean_ret[`size',4] %8.3f me
> an_ret[`size',5]
  4. }
Small         0.551   0.645   0.964   1.116   1.330
Size2         0.633   0.917   0.948   1.026   1.219
Size3         0.708   0.897   0.908   0.993   1.095
Size4         0.726   0.772   0.835   0.960   1.023
Big           0.684   0.645   0.702   0.666   0.949

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. * Calculate row and column averages
. di ""


. di "Average by Size (across all B/M):"
Average by Size (across all B/M):

. forvalues size = 1/5 {
  2.     local rowsum = 0
  3.     forvalues bm = 1/5 {
  4.         local rowsum = `rowsum' + mean_ret[`size', `bm']
  5.     }
  6.     local rowavg = `rowsum' / 5
  7.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big", "Size`size'"))
  8.     di "  `size_label': " %8.3f `rowavg'
  9. }
  Small:    0.921
  Size2:    0.949
  Size3:    0.920
  Size4:    0.863
  Big:    0.729

. 
. di ""


. di "Average by B/M (across all Size):"
Average by B/M (across all Size):

. forvalues bm = 1/5 {
  2.     local colsum = 0
  3.     forvalues size = 1/5 {
  4.         local colsum = `colsum' + mean_ret[`size', `bm']
  5.     }
  6.     local colavg = `colsum' / 5
  7.     local bm_label = cond(`bm'==1, "Low BM", cond(`bm'==5, "High BM", "BM`bm'"))
  8.     di "  `bm_label': " %8.3f `colavg'
  9. }
  Low BM:    0.661
  BM2:    0.775
  BM3:    0.871
  BM4:    0.952
  High BM:    1.123

. 
. /*------------------------------------------------------------------------------
>     3. Portfolio Standard Deviations (5x5 Matrix)
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 3: Standard Deviations of Excess Returns (% per month)"
Part 3: Standard Deviations of Excess Returns (% per month)

. di "======================================================================"
======================================================================

. di ""


. 
. matrix sd_ret = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly summarize exret`size'`bm'
  4.         matrix sd_ret[`size', `bm'] = r(sd)
  5.     }
  6. }

. 
. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f sd_ret[`size',1] %8.3f sd_ret[`size',2] %8.3f sd_ret[`size',3] %8.3f sd_ret[`size',4] %8.3f sd_ret[`si
> ze',5]
  4. }
Small        11.920   9.657   8.852   8.281   9.169
Size2         7.972   7.482   7.221   7.436   8.675
Size3         7.355   6.486   6.466   6.937   8.375
Size4         6.197   6.104   6.301   6.822   8.563
Big           5.342   5.257   5.580   6.533   8.458

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. /*------------------------------------------------------------------------------
>     4. t-Statistics for Mean Returns
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 4: t-Statistics for Mean Excess Returns"
Part 4: t-Statistics for Mean Excess Returns

. di "======================================================================"
======================================================================

. di ""


. di "(Testing H0: mean = 0)"
(Testing H0: mean = 0)

. di ""


. 
. matrix tstat_ret = J(5, 5, .)

. local T = _N

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local tstat = mean_ret[`size', `bm'] / (sd_ret[`size', `bm'] / sqrt(`T'))
  4.         matrix tstat_ret[`size', `bm'] = `tstat'
  5.     }
  6. }

. 
. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.2f tstat_ret[`size',1] %8.2f tstat_ret[`size',2] %8.2f tstat_ret[`size',3] %8.2f tstat_ret[`size',4] %8.2
> f tstat_ret[`size',5]
  4. }
Small          1.59    2.30    3.75    4.64    5.00
Size2          2.74    4.22    4.52    4.75    4.84
Size3          3.32    4.77    4.84    4.93    4.50
Size4          4.04    4.36    4.57    4.85    4.12
Big            4.41    4.23    4.33    3.51    3.86

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. /*------------------------------------------------------------------------------
>     5. Size and Value Spreads
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 5: Size and Value Spreads"
Part 5: Size and Value Spreads

. di "======================================================================"
======================================================================

. di ""


. 
. * SMB-like spread: Average Small - Average Big
. local small_avg = (mean_ret[1,1] + mean_ret[1,2] + mean_ret[1,3] + mean_ret[1,4] + mean_ret[1,5]) / 5

. local big_avg = (mean_ret[5,1] + mean_ret[5,2] + mean_ret[5,3] + mean_ret[5,4] + mean_ret[5,5]) / 5

. local size_spread = `small_avg' - `big_avg'

. 
. di "Size Spread (Small - Big):"
Size Spread (Small - Big):

. di "  Average Small portfolio return: " %8.3f `small_avg'
  Average Small portfolio return:    0.921

. di "  Average Big portfolio return:   " %8.3f `big_avg'
  Average Big portfolio return:      0.729

. di "  Size spread:                    " %8.3f `size_spread'
  Size spread:                       0.192

. 
. di ""


. 
. * HML-like spread: Average High BM - Average Low BM
. local highbm_avg = (mean_ret[1,5] + mean_ret[2,5] + mean_ret[3,5] + mean_ret[4,5] + mean_ret[5,5]) / 5

. local lowbm_avg = (mean_ret[1,1] + mean_ret[2,1] + mean_ret[3,1] + mean_ret[4,1] + mean_ret[5,1]) / 5

. local value_spread = `highbm_avg' - `lowbm_avg'

. 
. di "Value Spread (High B/M - Low B/M):"
Value Spread (High B/M - Low B/M):

. di "  Average High B/M portfolio return: " %8.3f `highbm_avg'
  Average High B/M portfolio return:    1.123

. di "  Average Low B/M portfolio return:  " %8.3f `lowbm_avg'
  Average Low B/M portfolio return:     0.661

. di "  Value spread:                      " %8.3f `value_spread'
  Value spread:                         0.463

. 
. /*------------------------------------------------------------------------------
>     6. Factor Correlations
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 6: Factor Correlations"
Part 6: Factor Correlations

. di "======================================================================"
======================================================================

. di ""


. 
. correlate mktrf smb hml
(obs=1,187)

             |    mktrf      smb      hml
-------------+---------------------------
       mktrf |   1.0000
         smb |   0.3204   1.0000
         hml |   0.2283   0.1250   1.0000


. 
. /*------------------------------------------------------------------------------
>     7. Export Results to CSV
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Exporting results to CSV..."
Exporting results to CSV...

. di "======================================================================"
======================================================================

. 
. * Export mean returns matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = mean_ret[`size', 1] if size == `size'
  3.     replace bm2 = mean_ret[`size', 2] if size == `size'
  4.     replace bm3 = mean_ret[`size', 3] if size == `size'
  5.     replace bm4 = mean_ret[`size', 4] if size == `size'
  6.     replace highbm = mean_ret[`size', 5] if size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. label define size_lbl 1 "Small" 2 "Size2" 3 "Size3" 4 "Size4" 5 "Big"

. label values size size_lbl

. 
. export delimited "$root/output/tables/table2_mean_returns.csv", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table2_mean_returns.csv not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table2_mean_returns.csv saved

. restore

. 
. * Export standard deviations matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = sd_ret[`size', 1] if size == `size'
  3.     replace bm2 = sd_ret[`size', 2] if size == `size'
  4.     replace bm3 = sd_ret[`size', 3] if size == `size'
  5.     replace bm4 = sd_ret[`size', 4] if size == `size'
  6.     replace highbm = sd_ret[`size', 5] if size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table2_std_dev.csv", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table2_std_dev.csv not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table2_std_dev.csv saved

. restore

. 
. di ""


. di "======================================================================"
======================================================================

. di "SUMMARY STATISTICS COMPLETE!"
SUMMARY STATISTICS COMPLETE!

. di "======================================================================"
======================================================================

. di ""


. di "Key Findings:"
Key Findings:

. di "1. Size Effect: Small stocks earn " %5.3f `size_spread' "% more per month than big stocks"
1. Size Effect: Small stocks earn 0.192% more per month than big stocks

. di "2. Value Effect: High B/M stocks earn " %5.3f `value_spread' "% more per month than low B/M"
2. Value Effect: High B/M stocks earn 0.463% more per month than low B/M

. di ""


. di "Output files:"
Output files:

. di "  - $root/output/tables/table2_mean_returns.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table2_mean_returns.csv

. di "  - $root/output/tables/table2_std_dev.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table2_std_dev.csv

. di "======================================================================"
======================================================================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     03_capm_regressions.do
>     
>     Purpose: Run CAPM (one-factor) regressions (replicating Table 4)
>     
>     Model: R(t) - RF(t) = a + b[RM(t) - RF(t)] + e(t)
>     
>     Table 4 reports:
>     - Market betas (b)
>     - RÂ² values
>     - Intercepts (alphas)
>     - Residual standard errors
> ==============================================================================*/
. 
. use "$root/data/processed/merged_data.dta", clear

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*------------------------------------------------------------------------------
>     1. Setup Matrices to Store Results
> ------------------------------------------------------------------------------*/
. 
. * Matrices for 5x5 results
. matrix betas = J(5, 5, .)       // Market betas

. matrix alphas = J(5, 5, .)      // Intercepts

. matrix rsq = J(5, 5, .)         // R-squared

. matrix se = J(5, 5, .)          // Residual std error

. matrix t_beta = J(5, 5, .)      // t-stats for beta

. matrix t_alpha = J(5, 5, .)     // t-stats for alpha

. 
. /*------------------------------------------------------------------------------
>     2. Run CAPM Regressions for Each Portfolio
> ------------------------------------------------------------------------------*/
. 
. di _newline(2) "=" * 70


=*70 invalid name
r(198);

end of do-file

r(198);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     03_capm_regressions.do
>     
>     Purpose: Replicate Fama-French (1993) Table 4
>              CAPM regressions for 25 portfolios
>              
>     Model: R(i,t) - RF(t) = alpha(i) + beta(i) * [RM(t) - RF(t)] + e(i,t)
>     
>     Input:  merged_data.dta
>     Output: CAPM regression results
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. * Load data
. use "$root/data/processed/merged_data.dta", clear

. 
. di ""


. di "======================================================================"
======================================================================

. di "CAPM REGRESSIONS - Replicating Table 4"
CAPM REGRESSIONS - Replicating Table 4

. di "======================================================================"
======================================================================

. di ""


. di "Model: Excess Return = alpha + beta * (Mkt-RF) + error"
Model: Excess Return = alpha + beta * (Mkt-RF) + error

. di ""


. di "Sample period: " %tm date[1] " to " %tm date[_N]
Sample period:  1926m7 to  2025m5

. di "Number of months: " _N
Number of months: 1187

. di "======================================================================"
======================================================================

. 
. /*------------------------------------------------------------------------------
>     1. Run CAPM Regressions for All 25 Portfolios
> ------------------------------------------------------------------------------*/
. 
. * Create matrices to store results
. matrix alpha_capm = J(5, 5, .)

. matrix beta_capm = J(5, 5, .)

. matrix tstat_alpha = J(5, 5, .)

. matrix tstat_beta = J(5, 5, .)

. matrix rsq_capm = J(5, 5, .)

. matrix se_capm = J(5, 5, .)

. 
. * Run regressions
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
  4.         
.         * Store results
.         matrix alpha_capm[`size', `bm'] = _b[_cons]
  5.         matrix beta_capm[`size', `bm'] = _b[mktrf]
  6.         matrix tstat_alpha[`size', `bm'] = _b[_cons] / _se[_cons]
  7.         matrix tstat_beta[`size', `bm'] = _b[mktrf] / _se[mktrf]
  8.         matrix rsq_capm[`size', `bm'] = e(r2)
  9.         matrix se_capm[`size', `bm'] = e(rmse)
 10.     }
 11. }

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*------------------------------------------------------------------------------
>     2. Display Beta Results
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 1: CAPM Betas"
Part 1: CAPM Betas

. di "======================================================================"
======================================================================

. di ""


. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "          (Growth)                               (Value)"
          (Growth)                               (Value)

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f beta_capm[`size',1] %8.3f beta_capm[`size',2] %8.3f beta_capm[`size',3] %8.3f beta_capm[`size',4] %8.3
> f beta_capm[`size',5]
  4. }
Small         1.601   1.393   1.359   1.265   1.361
Size2         1.270   1.232   1.200   1.216   1.377
Size3         1.245   1.132   1.120   1.171   1.357
Size4         1.088   1.091   1.103   1.162   1.391
Big           0.961   0.946   0.967   1.098   1.300

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. /*------------------------------------------------------------------------------
>     3. Display Alpha Results (KEY RESULT)
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 2: CAPM Alphas (Intercepts) - % per month"
Part 2: CAPM Alphas (Intercepts) - % per month

. di "======================================================================"
======================================================================

. di ""


. di "If CAPM works, all alphas should be close to zero."
If CAPM works, all alphas should be close to zero.

. di ""


. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f alpha_capm[`size',1] %8.3f alpha_capm[`size',2] %8.3f alpha_capm[`size',3] %8.3f alpha_capm[`size',4] 
> %8.3f alpha_capm[`size',5]
  4. }
Small        -0.545  -0.308   0.034   0.250   0.399
Size2        -0.236   0.074   0.127   0.194   0.277
Size3        -0.143   0.123   0.142   0.192   0.166
Size4        -0.018   0.025   0.081   0.165   0.071
Big           0.026  -0.002   0.040  -0.085   0.059

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. /*------------------------------------------------------------------------------
>     4. Display t-Statistics for Alphas
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 3: t-Statistics for Alphas"
Part 3: t-Statistics for Alphas

. di "======================================================================"
======================================================================

. di ""


. di "(|t| > 1.96 indicates significant at 5% level)"
(|t| > 1.96 indicates significant at 5% level)

. di ""


. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.2f tstat_alpha[`size',1] %8.2f tstat_alpha[`size',2] %8.2f tstat_alpha[`size',3] %8.2f tstat_alpha[`size'
> ,4] %8.2f tstat_alpha[`size',5]
  4. }
Small         -2.23   -1.70    0.23    1.77    2.42
Size2         -1.90    0.70    1.28    1.81    2.04
Size3         -1.53    1.74    1.93    2.15    1.34
Size4         -0.28    0.46    1.20    1.95    0.57
Big            0.58   -0.04    0.64   -1.00    0.42

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. * Count significant alphas
. local sig_count = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         if abs(tstat_alpha[`size', `bm']) > 1.96 {
  4.             local sig_count = `sig_count' + 1
  5.         }
  6.     }
  7. }

. di ""


. di "Number of significant alphas (|t| > 1.96): `sig_count' out of 25"
Number of significant alphas (|t| > 1.96): 4 out of 25

. di "(By chance at 5% level, we expect about 1.25)"
(By chance at 5% level, we expect about 1.25)

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. 
. /*------------------------------------------------------------------------------
>     5. Display R-squared Results
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 4: R-squared Values"
Part 4: R-squared Values

. di "======================================================================"
======================================================================

. di ""


. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f rsq_capm[`size',1] %8.3f rsq_capm[`size',2] %8.3f rsq_capm[`size',3] %8.3f rsq_capm[`size',4] %8.3f rs
> q_capm[`size',5]
  4. }
Small         0.511   0.589   0.667   0.660   0.623
Size2         0.718   0.767   0.782   0.757   0.713
Size3         0.811   0.862   0.849   0.807   0.743
Size4         0.873   0.905   0.867   0.821   0.747
Big           0.917   0.916   0.850   0.799   0.669

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. * Calculate average R-squared
. local rsq_sum = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local rsq_sum = `rsq_sum' + rsq_capm[`size', `bm']
  4.     }
  5. }

. local avg_rsq = `rsq_sum' / 25

. di ""


. di "Average R-squared: " %5.3f `avg_rsq'
Average R-squared: 0.769

. 
. /*------------------------------------------------------------------------------
>     6. Pattern Analysis
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 5: Pattern Analysis"
Part 5: Pattern Analysis

. di "======================================================================"
======================================================================

. di ""


. 
. * Average alpha by size
. di "Average Alpha by Size:"
Average Alpha by Size:

. forvalues size = 1/5 {
  2.     local rowsum = 0
  3.     forvalues bm = 1/5 {
  4.         local rowsum = `rowsum' + alpha_capm[`size', `bm']
  5.     }
  6.     local rowavg = `rowsum' / 5
  7.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big", "Size`size'"))
  8.     di "  `size_label': " %8.3f `rowavg' "% per month"
  9. }
  Small:   -0.034% per month
  Size2:    0.087% per month
  Size3:    0.096% per month
  Size4:    0.065% per month
  Big:    0.008% per month

. 
. di ""


. 
. * Average alpha by B/M
. di "Average Alpha by B/M:"
Average Alpha by B/M:

. forvalues bm = 1/5 {
  2.     local colsum = 0
  3.     forvalues size = 1/5 {
  4.         local colsum = `colsum' + alpha_capm[`size', `bm']
  5.     }
  6.     local colavg = `colsum' / 5
  7.     local bm_label = cond(`bm'==1, "Low BM", cond(`bm'==5, "High BM", "BM`bm'"))
  8.     di "  `bm_label': " %8.3f `colavg' "% per month"
  9. }
  Low BM:   -0.183% per month
  BM2:   -0.018% per month
  BM3:    0.085% per month
  BM4:    0.143% per month
  High BM:    0.195% per month

. 
. /*------------------------------------------------------------------------------
>     7. Detailed Regression Output for Corner Portfolios
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 6: Detailed Results for Corner Portfolios"
Part 6: Detailed Results for Corner Portfolios

. di "======================================================================"
======================================================================

. 
. di ""


. di "--- Small/Low BM (p11) ---"
--- Small/Low BM (p11) ---

. regress exret11 mktrf

      Source |       SS           df       MS      Number of obs   =     1,187
-------------+----------------------------------   F(1, 1185)      =   1237.95
       Model |   86097.443         1   86097.443   Prob > F        =    0.0000
    Residual |  82415.0777     1,185  69.5485888   R-squared       =    0.5109
-------------+----------------------------------   Adj R-squared   =    0.5105
       Total |  168512.521     1,186  142.084756   Root MSE        =    8.3396

------------------------------------------------------------------------------
     exret11 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       mktrf |   1.601372   .0455136    35.18   0.000     1.512076    1.690669
       _cons |  -.5445983   .2440523    -2.23   0.026    -1.023421   -.0657755
------------------------------------------------------------------------------

. 
. di ""


. di "--- Small/High BM (p15) ---"
--- Small/High BM (p15) ---

. regress exret15 mktrf

      Source |       SS           df       MS      Number of obs   =     1,187
-------------+----------------------------------   F(1, 1185)      =   1961.27
       Model |  62156.1995         1  62156.1995   Prob > F        =    0.0000
    Residual |  37554.7091     1,185  31.6917376   R-squared       =    0.6234
-------------+----------------------------------   Adj R-squared   =    0.6230
       Total |  99710.9086     1,186  84.0732788   Root MSE        =    5.6295

------------------------------------------------------------------------------
     exret15 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       mktrf |   1.360628   .0307235    44.29   0.000      1.30035    1.420907
       _cons |   .3993187   .1647448     2.42   0.016     .0760946    .7225427
------------------------------------------------------------------------------

. 
. di ""


. di "--- Big/Low BM (p51) ---"
--- Big/Low BM (p51) ---

. regress exret51 mktrf

      Source |       SS           df       MS      Number of obs   =     1,187
-------------+----------------------------------   F(1, 1185)      =  13019.15
       Model |  31020.1039         1  31020.1039   Prob > F        =    0.0000
    Residual |  2823.44192     1,185  2.38265141   R-squared       =    0.9166
-------------+----------------------------------   Adj R-squared   =    0.9165
       Total |  33843.5458     1,186  28.5358734   Root MSE        =    1.5436

------------------------------------------------------------------------------
     exret51 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       mktrf |   .9612113   .0084242   114.10   0.000     .9446833    .9777392
       _cons |   .0263765    .045172     0.58   0.559    -.0622494    .1150025
------------------------------------------------------------------------------

. 
. di ""


. di "--- Big/High BM (p55) ---"
--- Big/High BM (p55) ---

. regress exret55 mktrf

      Source |       SS           df       MS      Number of obs   =     1,187
-------------+----------------------------------   F(1, 1185)      =   2392.54
       Model |   56734.649         1   56734.649   Prob > F        =    0.0000
    Residual |  28100.0774     1,185  23.7131455   R-squared       =    0.6688
-------------+----------------------------------   Adj R-squared   =    0.6685
       Total |  84834.7264     1,186  71.5301234   Root MSE        =    4.8696

------------------------------------------------------------------------------
     exret55 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       mktrf |   1.299934   .0265761    48.91   0.000     1.247793    1.352076
       _cons |    .059301   .1425061     0.42   0.677    -.2202913    .3388933
------------------------------------------------------------------------------

. 
. /*------------------------------------------------------------------------------
>     8. Export Results
> ------------------------------------------------------------------------------*/
. 
. * Export alpha matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = alpha_capm[`size', 1] if size == `size'
  3.     replace bm2 = alpha_capm[`size', 2] if size == `size'
  4.     replace bm3 = alpha_capm[`size', 3] if size == `size'
  5.     replace bm4 = alpha_capm[`size', 4] if size == `size'
  6.     replace highbm = alpha_capm[`size', 5] if size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table4_capm_alphas.csv", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table4_capm_alphas.csv not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table4_capm_alphas.csv saved

. restore

. 
. * Export R-squared matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = rsq_capm[`size', 1] if size == `size'
  3.     replace bm2 = rsq_capm[`size', 2] if size == `size'
  4.     replace bm3 = rsq_capm[`size', 3] if size == `size'
  5.     replace bm4 = rsq_capm[`size', 4] if size == `size'
  6.     replace highbm = rsq_capm[`size', 5] if size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table4_capm_rsq.csv", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table4_capm_rsq.csv not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table4_capm_rsq.csv saved

. restore

. 
. /*------------------------------------------------------------------------------
>     9. Summary
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "CAPM REGRESSION SUMMARY"
CAPM REGRESSION SUMMARY

. di "======================================================================"
======================================================================

. di ""


. di "KEY FINDING: CAPM FAILS to explain the cross-section of returns!"
KEY FINDING: CAPM FAILS to explain the cross-section of returns!

. di ""


. di "Evidence:"
Evidence:

. di "1. `sig_count' out of 25 alphas are statistically significant"
1.  out of 25 alphas are statistically significant

. di "2. Alphas show systematic patterns:"
2. Alphas show systematic patterns:

. di "   - Small stocks have HIGHER alphas than big stocks"
   - Small stocks have HIGHER alphas than big stocks

. di "   - High B/M stocks have HIGHER alphas than low B/M stocks"
   - High B/M stocks have HIGHER alphas than low B/M stocks

. di "3. Average R-squared: " %5.3f `avg_rsq' " (market factor alone is incomplete)"
3. Average R-squared: 0.769 (market factor alone is incomplete)

. di ""


. di "This motivates the need for additional factors (SMB and HML)!"
This motivates the need for additional factors (SMB and HML)!

. di ""


. di "Output files:"
Output files:

. di "  - $root/output/tables/table4_capm_alphas.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table4_capm_alphas.csv

. di "  - $root/output/tables/table4_capm_rsq.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table4_capm_rsq.csv

. di "======================================================================"
======================================================================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     04_threefactor_regressions.do
>     
>     Purpose: Replicate Fama-French (1993) Table 6 - THE CORE RESULT
>              Three-factor regressions for 25 portfolios
>              
>     Model: R(i,t) - RF(t) = alpha(i) + b(i)*MktRF(t) + s(i)*SMB(t) + h(i)*HML(t) + e(i,t)
>     
>     Input:  merged_data.dta
>     Output: Three-factor regression results
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. * Load data
. use "$root/data/processed/merged_data.dta", clear

. 
. di ""


. di "======================================================================"
======================================================================

. di "THREE-FACTOR REGRESSIONS - Replicating Table 6 (CORE RESULT)"
THREE-FACTOR REGRESSIONS - Replicating Table 6 (CORE RESULT)

. di "======================================================================"
======================================================================

. di ""


. di "Model: Excess Return = alpha + b*MktRF + s*SMB + h*HML + error"
Model: Excess Return = alpha + b*MktRF + s*SMB + h*HML + error

. di ""


. di "Sample period: " %tm date[1] " to " %tm date[_N]
Sample period:  1926m7 to  2025m5

. di "Number of months: " _N
Number of months: 1187

. di "======================================================================"
======================================================================

. 
. /*------------------------------------------------------------------------------
>     1. Run Three-Factor Regressions for All 25 Portfolios
> ------------------------------------------------------------------------------*/
. 
. * Create matrices to store results
. matrix alpha_ff3 = J(5, 5, .)

. matrix b_mkt = J(5, 5, .)

. matrix s_smb = J(5, 5, .)

. matrix h_hml = J(5, 5, .)

. matrix tstat_alpha_ff3 = J(5, 5, .)

. matrix tstat_b = J(5, 5, .)

. matrix tstat_s = J(5, 5, .)

. matrix tstat_h = J(5, 5, .)

. matrix rsq_ff3 = J(5, 5, .)

. matrix se_ff3 = J(5, 5, .)

. 
. * Run regressions
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf smb hml
  4.         
.         * Store coefficients
.         matrix alpha_ff3[`size', `bm'] = _b[_cons]
  5.         matrix b_mkt[`size', `bm'] = _b[mktrf]
  6.         matrix s_smb[`size', `bm'] = _b[smb]
  7.         matrix h_hml[`size', `bm'] = _b[hml]
  8.         
.         * Store t-statistics
.         matrix tstat_alpha_ff3[`size', `bm'] = _b[_cons] / _se[_cons]
  9.         matrix tstat_b[`size', `bm'] = _b[mktrf] / _se[mktrf]
 10.         matrix tstat_s[`size', `bm'] = _b[smb] / _se[smb]
 11.         matrix tstat_h[`size', `bm'] = _b[hml] / _se[hml]
 12.         
.         * Store fit statistics
.         matrix rsq_ff3[`size', `bm'] = e(r2)
 13.         matrix se_ff3[`size', `bm'] = e(rmse)
 14.     }
 15. }

. 
. /*------------------------------------------------------------------------------
>     2. Display Market Beta Results
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 1: Market Betas (b)"
Part 1: Market Betas (b)

. di "======================================================================"
======================================================================

. di ""


. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f b_mkt[`size',1] %8.3f b_mkt[`size',2] %8.3f b_mkt[`size',3] %8.3f b_mkt[`size',4] %8.3f b_mkt[`size',5
> ]
  4. }
Small         1.267   1.070   1.048   0.942   0.980
Size2         1.086   1.022   0.990   0.969   1.066
Size3         1.125   1.018   0.985   0.995   1.113
Size4         1.075   1.029   1.010   1.035   1.186
Big           1.031   0.978   0.960   1.033   1.174

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. /*------------------------------------------------------------------------------
>     3. Display SMB Loadings (KEY - should decrease from Small to Big)
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 2: SMB Loadings (s) - Size Factor"
Part 2: SMB Loadings (s) - Size Factor

. di "======================================================================"
======================================================================

. di ""


. di "Expected: Decrease from Small (positive) to Big (negative)"
Expected: Decrease from Small (positive) to Big (negative)

. di ""


. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f s_smb[`size',1] %8.3f s_smb[`size',2] %8.3f s_smb[`size',3] %8.3f s_smb[`size',4] %8.3f s_smb[`size',5
> ]
  4. }
Small         1.476   1.531   1.239   1.233   1.287
Size2         1.151   1.006   0.831   0.828   0.925
Size3         0.811   0.560   0.451   0.477   0.589
Size4         0.338   0.242   0.209   0.213   0.319
Big          -0.149  -0.191  -0.232  -0.181  -0.141

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. * Calculate average SMB loading by size
. di ""


. di "Average SMB Loading by Size:"
Average SMB Loading by Size:

. forvalues size = 1/5 {
  2.     local rowsum = 0
  3.     forvalues bm = 1/5 {
  4.         local rowsum = `rowsum' + s_smb[`size', `bm']
  5.     }
  6.     local rowavg = `rowsum' / 5
  7.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big", "Size`size'"))
  8.     di "  `size_label': " %8.3f `rowavg'
  9. }
  Small:    1.353
  Size2:    0.948
  Size3:    0.577
  Size4:    0.264
  Big:   -0.179

. 
. /*------------------------------------------------------------------------------
>     4. Display HML Loadings (KEY - should increase from Low to High BM)
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 3: HML Loadings (h) - Value Factor"
Part 3: HML Loadings (h) - Value Factor

. di "======================================================================"
======================================================================

. di ""


. di "Expected: Increase from Low BM (negative) to High BM (positive)"
Expected: Increase from Low BM (negative) to High BM (positive)

. di ""


. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f h_hml[`size',1] %8.3f h_hml[`size',2] %8.3f h_hml[`size',3] %8.3f h_hml[`size',4] %8.3f h_hml[`size',5
> ]
  4. }
Small         0.354   0.206   0.495   0.575   0.889
Size2        -0.230   0.118   0.344   0.583   0.884
Size3        -0.220   0.046   0.321   0.561   0.864
Size4        -0.331   0.106   0.347   0.565   0.945
Big          -0.269   0.025   0.330   0.654   0.998

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. * Calculate average HML loading by B/M
. di ""


. di "Average HML Loading by B/M:"
Average HML Loading by B/M:

. forvalues bm = 1/5 {
  2.     local colsum = 0
  3.     forvalues size = 1/5 {
  4.         local colsum = `colsum' + h_hml[`size', `bm']
  5.     }
  6.     local colavg = `colsum' / 5
  7.     local bm_label = cond(`bm'==1, "Low BM", cond(`bm'==5, "High BM", "BM`bm'"))
  8.     di "  `bm_label': " %8.3f `colavg'
  9. }
  Low BM:   -0.139
  BM2:    0.100
  BM3:    0.367
  BM4:    0.587
  High BM:    0.916

. 
. /*------------------------------------------------------------------------------
>     5. Display Alpha Results (KEY - should be close to ZERO)
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 4: Three-Factor Alphas (% per month)"
Part 4: Three-Factor Alphas (% per month)

. di "======================================================================"
======================================================================

. di ""


. di "If three-factor model works, ALL alphas should be close to ZERO."
If three-factor model works, ALL alphas should be close to ZERO.

. di "(Compare with CAPM alphas which showed systematic patterns)"
(Compare with CAPM alphas which showed systematic patterns)

. di ""


. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f alpha_ff3[`size',1] %8.3f alpha_ff3[`size',2] %8.3f alpha_ff3[`size',3] %8.3f alpha_ff3[`size',4] %8.3
> f alpha_ff3[`size',5]
  4. }
Small        -0.680  -0.409  -0.127   0.070   0.141
Size2        -0.219   0.011   0.016   0.026   0.032
Size3        -0.117   0.093   0.049   0.040  -0.063
Size4         0.050  -0.008  -0.010   0.021  -0.168
Big           0.096  -0.001  -0.032  -0.237  -0.177

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. /*------------------------------------------------------------------------------
>     6. Display t-Statistics for Alphas
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 5: t-Statistics for Alphas"
Part 5: t-Statistics for Alphas

. di "======================================================================"
======================================================================

. di ""


. di "(|t| > 1.96 indicates significant at 5% level)"
(|t| > 1.96 indicates significant at 5% level)

. di ""


. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.2f tstat_alpha_ff3[`size',1] %8.2f tstat_alpha_ff3[`size',2] %8.2f tstat_alpha_ff3[`size',3] %8.2f tstat_
> alpha_ff3[`size',4] %8.2f tstat_alpha_ff3[`size',5]
  4. }
Small         -3.35   -3.43   -1.47    1.07    1.96
Size2         -3.12    0.20    0.29    0.53    0.58
Size3         -2.01    1.84    0.95    0.77   -0.92
Size4          1.05   -0.17   -0.19    0.36   -2.23
Big            2.92   -0.03   -0.62   -4.47   -1.77

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. * Count significant alphas
. local sig_count_ff3 = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         if abs(tstat_alpha_ff3[`size', `bm']) > 1.96 {
  4.             local sig_count_ff3 = `sig_count_ff3' + 1
  5.         }
  6.     }
  7. }

. di ""


. di "Number of significant alphas (|t| > 1.96): `sig_count_ff3' out of 25"
Number of significant alphas (|t| > 1.96): 7 out of 25

. di "(By chance at 5% level, we expect about 1.25)"
(By chance at 5% level, we expect about 1.25)

. 
. /*------------------------------------------------------------------------------
>     7. Display R-squared Results
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 6: R-squared Values"
Part 6: R-squared Values

. di "======================================================================"
======================================================================

. di ""


. di "            Low BM    BM2       BM3       BM4     High BM"
            Low BM    BM2       BM3       BM4     High BM

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f rsq_ff3[`size',1] %8.3f rsq_ff3[`size',2] %8.3f rsq_ff3[`size',3] %8.3f rsq_ff3[`size',4] %8.3f rsq_ff
> 3[`size',5]
  4. }
Small         0.663   0.823   0.889   0.929   0.929
Size2         0.910   0.934   0.934   0.952   0.952
Size3         0.927   0.930   0.927   0.934   0.924
Size4         0.931   0.923   0.916   0.915   0.910
Big           0.956   0.928   0.905   0.923   0.836

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. * Calculate average R-squared
. local rsq_sum_ff3 = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local rsq_sum_ff3 = `rsq_sum_ff3' + rsq_ff3[`size', `bm']
  4.     }
  5. }

. local avg_rsq_ff3 = `rsq_sum_ff3' / 25

. di ""


. di "Average R-squared: " %5.3f `avg_rsq_ff3'
Average R-squared: 0.908

. 
. /*------------------------------------------------------------------------------
>     8. Detailed Regression Output for Corner Portfolios
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 7: Detailed Results for Corner Portfolios"
Part 7: Detailed Results for Corner Portfolios

. di "======================================================================"
======================================================================

. 
. di ""


. di "--- Small/Low BM (p11) ---"
--- Small/Low BM (p11) ---

. regress exret11 mktrf smb hml

      Source |       SS           df       MS      Number of obs   =     1,187
-------------+----------------------------------   F(3, 1183)      =    776.17
       Model |  111742.146         3   37247.382   Prob > F        =    0.0000
    Residual |  56770.3748     1,183  47.9884825   R-squared       =    0.6631
-------------+----------------------------------   Adj R-squared   =    0.6623
       Total |  168512.521     1,186  142.084756   Root MSE        =    6.9274

------------------------------------------------------------------------------
     exret11 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       mktrf |   1.266567   .0407358    31.09   0.000     1.186645     1.34649
         smb |   1.476215   .0673316    21.92   0.000     1.344113    1.608318
         hml |   .3537924    .058144     6.08   0.000     .2397156    .4678692
       _cons |  -.6798432    .203216    -3.35   0.001    -1.078547   -.2811392
------------------------------------------------------------------------------

. 
. di ""


. di "--- Small/High BM (p15) ---"
--- Small/High BM (p15) ---

. regress exret15 mktrf smb hml

      Source |       SS           df       MS      Number of obs   =     1,187
-------------+----------------------------------   F(3, 1183)      =   5136.32
       Model |  92601.5602         3  30867.1867   Prob > F        =    0.0000
    Residual |  7109.34837     1,183  6.00959287   R-squared       =    0.9287
-------------+----------------------------------   Adj R-squared   =    0.9285
       Total |  99710.9086     1,186  84.0732788   Root MSE        =    2.4514

------------------------------------------------------------------------------
     exret15 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       mktrf |   .9799396   .0144155    67.98   0.000     .9516567    1.008222
         smb |   1.287319   .0238272    54.03   0.000     1.240571    1.334068
         hml |   .8894556   .0205759    43.23   0.000     .8490863     .929825
       _cons |   .1408692   .0719137     1.96   0.050    -.0002235    .2819619
------------------------------------------------------------------------------

. 
. di ""


. di "--- Big/Low BM (p51) ---"
--- Big/Low BM (p51) ---

. regress exret51 mktrf smb hml

      Source |       SS           df       MS      Number of obs   =     1,187
-------------+----------------------------------   F(3, 1183)      =   8506.11
       Model |  32344.1106         3  10781.3702   Prob > F        =    0.0000
    Residual |  1499.43518     1,183  1.26748536   R-squared       =    0.9557
-------------+----------------------------------   Adj R-squared   =    0.9556
       Total |  33843.5458     1,186  28.5358734   Root MSE        =    1.1258

------------------------------------------------------------------------------
     exret51 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       mktrf |   1.030738   .0066203   155.69   0.000     1.017749    1.043727
         smb |  -.1494581   .0109426   -13.66   0.000    -.1709273    -.127989
         hml |  -.2691066   .0094495   -28.48   0.000    -.2876462    -.250567
       _cons |   .0964944   .0330264     2.92   0.004     .0316976    .1612912
------------------------------------------------------------------------------

. 
. di ""


. di "--- Big/High BM (p55) ---"
--- Big/High BM (p55) ---

. regress exret55 mktrf smb hml

      Source |       SS           df       MS      Number of obs   =     1,187
-------------+----------------------------------   F(3, 1183)      =   2014.17
       Model |  70945.1126         3  23648.3709   Prob > F        =    0.0000
    Residual |  13889.6138     1,183  11.7410091   R-squared       =    0.8363
-------------+----------------------------------   Adj R-squared   =    0.8359
       Total |  84834.7264     1,186  71.5301234   Root MSE        =    3.4265

------------------------------------------------------------------------------
     exret55 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       mktrf |   1.174329   .0201493    58.28   0.000     1.134797    1.213862
         smb |     -.1413   .0333045    -4.24   0.000    -.2066425   -.0759574
         hml |   .9983735     .02876    34.71   0.000     .9419472      1.0548
       _cons |  -.1774208   .1005176    -1.77   0.078    -.3746334    .0197918
------------------------------------------------------------------------------

. 
. /*------------------------------------------------------------------------------
>     9. Compare CAPM vs Three-Factor Model
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Part 8: CAPM vs Three-Factor Model Comparison"
Part 8: CAPM vs Three-Factor Model Comparison

. di "======================================================================"
======================================================================

. di ""


. 
. * Reload CAPM results for comparison
. matrix alpha_capm = J(5, 5, .)

. matrix rsq_capm = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
  4.         matrix alpha_capm[`size', `bm'] = _b[_cons]
  5.         matrix rsq_capm[`size', `bm'] = e(r2)
  6.     }
  7. }

. 
. * Calculate average R-squared for CAPM
. local rsq_sum_capm = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local rsq_sum_capm = `rsq_sum_capm' + rsq_capm[`size', `bm']
  4.     }
  5. }

. local avg_rsq_capm = `rsq_sum_capm' / 25

. 
. * Calculate sum of squared alphas
. local ssa_capm = 0

. local ssa_ff3 = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local ssa_capm = `ssa_capm' + (alpha_capm[`size', `bm'])^2
  4.         local ssa_ff3 = `ssa_ff3' + (alpha_ff3[`size', `bm'])^2
  5.     }
  6. }

. 
. di "                              CAPM      Three-Factor"
                              CAPM      Three-Factor

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. di "Average R-squared:         " %7.3f `avg_rsq_capm' "      " %7.3f `avg_rsq_ff3'
Average R-squared:           0.769        0.908

. di "Sum of Squared Alphas:     " %7.3f `ssa_capm' "      " %7.3f `ssa_ff3'
Sum of Squared Alphas:       0.980        0.880

. di "Significant Alphas:            4            `sig_count_ff3'"
Significant Alphas:            4            7

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. di ""


. di "Improvement in R-squared: " %5.1f (`avg_rsq_ff3' - `avg_rsq_capm')*100 " percentage points"
Improvement in R-squared:  13.9 percentage points

. di "Reduction in SSA:         " %5.1f (1 - `ssa_ff3'/`ssa_capm')*100 "%"
Reduction in SSA:          10.1%

. 
. /*------------------------------------------------------------------------------
>     10. Export Results
> ------------------------------------------------------------------------------*/
. 
. * Export alpha matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = alpha_ff3[`size', 1] if size == `size'
  3.     replace bm2 = alpha_ff3[`size', 2] if size == `size'
  4.     replace bm3 = alpha_ff3[`size', 3] if size == `size'
  5.     replace bm4 = alpha_ff3[`size', 4] if size == `size'
  6.     replace highbm = alpha_ff3[`size', 5] if size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_ff3_alphas.csv", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_ff3_alphas.csv not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_ff3_alphas.csv saved

. restore

. 
. * Export SMB loadings
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = s_smb[`size', 1] if size == `size'
  3.     replace bm2 = s_smb[`size', 2] if size == `size'
  4.     replace bm3 = s_smb[`size', 3] if size == `size'
  5.     replace bm4 = s_smb[`size', 4] if size == `size'
  6.     replace highbm = s_smb[`size', 5] if size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_smb_loadings.csv", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_smb_loadings.csv not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_smb_loadings.csv saved

. restore

. 
. * Export HML loadings
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = h_hml[`size', 1] if size == `size'
  3.     replace bm2 = h_hml[`size', 2] if size == `size'
  4.     replace bm3 = h_hml[`size', 3] if size == `size'
  5.     replace bm4 = h_hml[`size', 4] if size == `size'
  6.     replace highbm = h_hml[`size', 5] if size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_hml_loadings.csv", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_hml_loadings.csv not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_hml_loadings.csv saved

. restore

. 
. * Export R-squared
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = rsq_ff3[`size', 1] if size == `size'
  3.     replace bm2 = rsq_ff3[`size', 2] if size == `size'
  4.     replace bm3 = rsq_ff3[`size', 3] if size == `size'
  5.     replace bm4 = rsq_ff3[`size', 4] if size == `size'
  6.     replace highbm = rsq_ff3[`size', 5] if size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_ff3_rsq.csv", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_ff3_rsq.csv not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_ff3_rsq.csv saved

. restore

. 
. /*------------------------------------------------------------------------------
>     11. Final Summary
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "THREE-FACTOR MODEL SUMMARY - KEY FINDINGS"
THREE-FACTOR MODEL SUMMARY - KEY FINDINGS

. di "======================================================================"
======================================================================

. di ""


. di "1. SMB LOADINGS:"
1. SMB LOADINGS:

. di "   - Small stocks: HIGH positive loadings (~1.4)"
   - Small stocks: HIGH positive loadings (~1.4)

. di "   - Big stocks: LOW or negative loadings (~-0.1)"
   - Big stocks: LOW or negative loadings (~-0.1)

. di "   -> SMB captures SIZE effect"
   -> SMB captures SIZE effect

. di ""


. di "2. HML LOADINGS:"
2. HML LOADINGS:

. di "   - Low B/M (Growth): NEGATIVE loadings"
   - Low B/M (Growth): NEGATIVE loadings

. di "   - High B/M (Value): POSITIVE loadings"
   - High B/M (Value): POSITIVE loadings

. di "   -> HML captures VALUE effect"
   -> HML captures VALUE effect

. di ""


. di "3. ALPHAS:"
3. ALPHAS:

. di "   - `sig_count_ff3' significant (vs 4 in CAPM)"
   - 7 significant (vs 4 in CAPM)

. di "   - No systematic pattern (unlike CAPM)"
   - No systematic pattern (unlike CAPM)

. di "   -> Three-factor model WORKS!"
   -> Three-factor model WORKS!

. di ""


. di "4. R-SQUARED:"
4. R-SQUARED:

. di "   - Average: " %5.3f `avg_rsq_ff3' " (vs " %5.3f `avg_rsq_capm' " for CAPM)"
   - Average: 0.908 (vs 0.769 for CAPM)

. di "   -> Three factors explain returns better"
   -> Three factors explain returns better

. di ""


. di "CONCLUSION: Fama-French three-factor model successfully explains"
CONCLUSION: Fama-French three-factor model successfully explains

. di "            the cross-section of stock returns!"
            the cross-section of stock returns!

. di ""


. di "Output files:"
Output files:

. di "  - $root/output/tables/table6_ff3_alphas.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_ff3_alphas.csv

. di "  - $root/output/tables/table6_smb_loadings.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_smb_loadings.csv

. di "  - $root/output/tables/table6_hml_loadings.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_hml_loadings.csv

. di "  - $root/output/tables/table6_ff3_rsq.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table6_ff3_rsq.csv

. di "======================================================================"
======================================================================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     05_grs_test.do
>     
>     Purpose: Replicate Fama-French (1993) Table 9c
>              GRS Test (Gibbons, Ross, Shanken 1989)
>              
>     Test: H0: All 25 intercepts (alphas) are jointly equal to zero
>     
>     GRS F-statistic:
>     F = (T/N) * ((T-N-K)/(T-K-1)) * (alpha' * Sigma^-1 * alpha) / (1 + mu' * Omega^-1 * mu)
>     
>     where:
>     T = number of time periods
>     N = number of test assets (25 portfolios)
>     K = number of factors
>     alpha = vector of intercepts
>     Sigma = residual covariance matrix
>     mu = vector of factor means
>     Omega = factor covariance matrix
>     
>     Input:  merged_data.dta
>     Output: GRS test results
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. * Load data
. use "$root/data/processed/merged_data.dta", clear

. 
. di ""


. di "======================================================================"
======================================================================

. di "GRS TEST - Replicating Table 9c"
GRS TEST - Replicating Table 9c

. di "======================================================================"
======================================================================

. di ""


. di "Gibbons, Ross, and Shanken (1989) Test"
Gibbons, Ross, and Shanken (1989) Test

. di "H0: All portfolio alphas are jointly equal to zero"
H0: All portfolio alphas are jointly equal to zero

. di ""


. di "Sample period: " %tm date[1] " to " %tm date[_N]
Sample period:  1926m7 to  2025m5

. di "Number of months (T): " _N
Number of months (T): 1187

. di "======================================================================"
======================================================================

. 
. local T = _N

. 
. /*------------------------------------------------------------------------------
>     1. Prepare Data for GRS Test
> ------------------------------------------------------------------------------*/
. 
. * Create list of excess return variables
. local exret_vars ""

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local exret_vars "`exret_vars' exret`size'`bm'"
  4.     }
  5. }

. 
. di ""


. di "Number of test portfolios (N): 25"
Number of test portfolios (N): 25

. di "Portfolios: `exret_vars'"
Portfolios:  exret11 exret12 exret13 exret14 exret15 exret21 exret22 exret23 exret24 exret25 exret31 exret32 exret33 exret34 exret35 exret41 exr
> et42 exret43 exret44 exret45 exret51 exret52 exret53 exret54 exret55

. 
. /*------------------------------------------------------------------------------
>     2. GRS Test for CAPM (1 Factor)
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Test 1: CAPM (Market Factor Only)"
Test 1: CAPM (Market Factor Only)

. di "======================================================================"
======================================================================

. di ""


. 
. * Run multivariate regression
. quietly mvreg `exret_vars' = mktrf

. 
. * Store number of factors
. local K_capm = 1

. local N = 25

. 
. * Get alphas (intercepts)
. matrix alpha_capm = J(25, 1, .)

. local i = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         matrix alpha_capm[`i', 1] = _b[exret`size'`bm':_cons]
  4.         local i = `i' + 1
  5.     }
  6. }

. 
. * Get residual covariance matrix
. estat vce

Covariance matrix of coefficients of mvreg model

             | exret11                | exret12                | exret13                | exret14                | exret15                
        e(V) |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret11      |                        |                        |                        |                        |                        
       mktrf |  .00207149             |                        |                        |                        |                        
       _cons | -.00141723   .05956152 |                        |                        |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret12      |                        |                        |                        |                        |                        
       mktrf |  .00061183  -.00041859 |  .00114322             |                        |                        |                        
       _cons | -.00041859   .01759183 | -.00078215   .03287097 |                        |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret13      |                        |                        |                        |                        |                        
       mktrf |  .00063804  -.00043652 |  .00059707   -.0004085 |  .00077717             |                        |                        
       _cons | -.00043652   .01834551 |  -.0004085   .01716767 | -.00053171   .02234597 |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret14      |                        |                        |                        |                        |                        
       mktrf |  .00057454  -.00039308 |  .00065726  -.00044968 |  .00057444  -.00039301 |   .0006944             |                        
       _cons | -.00039308   .01651966 | -.00044968   .01889831 | -.00039301   .01651697 | -.00047508   .01996597 |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret15      |                        |                        |                        |                        |                        
       mktrf |  .00073432  -.00050239 |  .00067982  -.00046511 |  .00066141  -.00045251 |  .00068187  -.00046651 |  .00094393             
       _cons | -.00050239   .02111384 | -.00046511    .0195469 | -.00045251   .01901762 | -.00046651   .01960573 |  -.0006458   .02714085 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret21      |                        |                        |                        |                        |                        
       mktrf |  .00049487  -.00033857 |  .00049652   -.0003397 |  .00033339  -.00022809 |  .00035045  -.00023977 |  .00033696  -.00023054 
       _cons | -.00033857   .01422899 |  -.0003397   .01427639 | -.00022809   .00958601 | -.00023977    .0100766 | -.00023054   .00968871 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret22      |                        |                        |                        |                        |                        
       mktrf |  .00033679  -.00023042 |  .00045668  -.00031244 |  .00036906   -.0002525 |  .00038094  -.00026062 |    .000391  -.00026751 
       _cons | -.00023042   .00968382 | -.00031244   .01313096 |  -.0002525   .01061165 | -.00026062   .01095307 | -.00026751   .01124233 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret23      |                        |                        |                        |                        |                        
       mktrf |  .00034601  -.00023673 |  .00039267  -.00026865 |  .00035856  -.00024531 |  .00037538  -.00025682 |  .00039538   -.0002705 
       _cons | -.00023673   .00994882 | -.00026865    .0112905 | -.00024531   .01030963 | -.00025682   .01079319 |  -.0002705   .01136837 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret24      |                        |                        |                        |                        |                        
       mktrf |  .00039198  -.00026817 |  .00040343  -.00027601 |  .00040042  -.00027395 |  .00042463  -.00029051 |  .00047248  -.00032326 
       _cons | -.00026817   .01127047 | -.00027601   .01159991 | -.00027395   .01151322 | -.00029051   .01220931 | -.00032326   .01358532 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret25      |                        |                        |                        |                        |                        
       mktrf |  .00058155  -.00039787 |  .00044565  -.00030489 |  .00047701  -.00032635 |  .00049068  -.00033571 |  .00063642  -.00043541 
       _cons | -.00039787   .01672121 | -.00030489   .01281363 | -.00032635   .01371553 | -.00033571   .01410857 | -.00043541    .0182989 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret31      |                        |                        |                        |                        |                        
       mktrf |  .00033021  -.00022592 |  .00034041   -.0002329 |  .00025025  -.00017121 |  .00023002  -.00015737 |  .00020706  -.00014167 
       _cons | -.00022592   .00949462 |  -.0002329   .00978781 | -.00017121   .00719533 | -.00015737   .00661379 | -.00014167   .00595371 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret32      |                        |                        |                        |                        |                        
       mktrf |  .00018861  -.00012904 |  .00020273   -.0001387 |  .00018236  -.00012476 |  .00018139   -.0001241 |  .00017966  -.00012292 
       _cons | -.00012904   .00542313 |  -.0001387   .00582915 | -.00012476   .00524332 |  -.0001241   .00521549 | -.00012292   .00516586 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret33      |                        |                        |                        |                        |                        
       mktrf |  .00017116   -.0001171 |   .0001892  -.00012944 |  .00021546  -.00014741 |  .00020712   -.0001417 |  .00023836  -.00016307 
       _cons |  -.0001171   .00492138 | -.00012944   .00544011 | -.00014741   .00619507 |  -.0001417   .00595526 | -.00016307   .00685343 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret34      |                        |                        |                        |                        |                        
       mktrf |  .00021473  -.00014691 |  .00026047   -.0001782 |  .00025672  -.00017563 |  .00028786  -.00019695 |  .00033443  -.00022881 
       _cons | -.00014691   .00617418 |  -.0001782   .00748922 | -.00017563   .00738134 | -.00019695   .00827695 | -.00022881   .00961593 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret35      |                        |                        |                        |                        |                        
       mktrf |  .00043083  -.00029476 |  .00029672  -.00020301 |   .0003731  -.00025526 |  .00036509  -.00024978 |  .00050344  -.00034443 
       _cons | -.00029476   .01238779 | -.00020301   .00853171 | -.00025526   .01072762 | -.00024978   .01049729 | -.00034443   .01447528 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret41      |                        |                        |                        |                        |                        
       mktrf |  .00009299  -.00006362 |  .00007764  -.00005312 |  .00002287  -.00001564 |  .00001518  -.00001038 | -.00001586   .00001085 
       _cons | -.00006362   .00267383 | -.00005312   .00223246 | -.00001564   .00065749 | -.00001038   .00043636 |  .00001085  -.00045609 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret42      |                        |                        |                        |                        |                        
       mktrf |  .00004126  -.00002823 |  .00009161  -.00006267 |  .00010576  -.00007236 |  .00009292  -.00006358 |  .00010144   -.0000694 
       _cons | -.00002823   .00118627 | -.00006267   .00263396 | -.00007236   .00304105 | -.00006358   .00267187 |  -.0000694   .00291661 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret43      |                        |                        |                        |                        |                        
       mktrf |  .00005885  -.00004026 |   .0001251  -.00008559 |  .00014001  -.00009579 |  .00014504  -.00009923 |  .00017701   -.0001211 
       _cons | -.00004026   .00169199 | -.00008559    .0035971 | -.00009579   .00402581 | -.00009923   .00417037 |  -.0001211   .00508944 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret44      |                        |                        |                        |                        |                        
       mktrf |  .00020694  -.00014158 |  .00011833  -.00008096 |  .00017265  -.00011812 |  .00019391  -.00013266 |  .00024958  -.00017075 
       _cons | -.00014158    .0059501 | -.00008096   .00340235 | -.00011812   .00496432 | -.00013266   .00557542 | -.00017075   .00717616 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret45      |                        |                        |                        |                        |                        
       mktrf |  .00026806   -.0001834 |  .00023581  -.00016133 |  .00029523  -.00020199 |   .0003145  -.00021517 |  .00041877   -.0002865 
       _cons |  -.0001834   .00770761 | -.00016133   .00678029 | -.00020199   .00848887 | -.00021517   .00904292 |  -.0002865   .01204076 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret51      |                        |                        |                        |                        |                        
       mktrf | -.00008349   .00005712 | -.00008099   .00005541 | -.00008864   .00006064 | -.00009821   .00006719 | -.00012325   .00008432 
       _cons |  .00005712   -.0024006 |  .00005541   -.0023287 |  .00006064  -.00254868 |  .00006719  -.00282379 |  .00008432  -.00354386 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret52      |                        |                        |                        |                        |                        
       mktrf | -.00008087   .00005533 |  -.0000821   .00005617 | -.00005756   .00003938 | -.00005551   .00003798 | -.00005638   .00003857 
       _cons |  .00005533  -.00232514 |  .00005617  -.00236052 |  .00003938  -.00165515 |  .00003798  -.00159605 |  .00003857  -.00162097 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret53      |                        |                        |                        |                        |                        
       mktrf | -.00002167   .00001483 | -.00004507   .00003084 | -.00001244   8.511e-06 |  1.293e-06  -8.845e-07 |  .00002405  -.00001646 
       _cons |  .00001483  -.00062308 |  .00003084  -.00129589 |  8.511e-06  -.00035771 | -8.845e-07   .00003717 | -.00001646   .00069156 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret54      |                        |                        |                        |                        |                        
       mktrf |  .00002134   -.0000146 |  .00001742  -.00001192 |  .00007773  -.00005318 |  .00009185  -.00006284 |  .00014763    -.000101 
       _cons |  -.0000146   .00061352 | -.00001192    .0005009 | -.00005318   .00223508 | -.00006284   .00264084 |   -.000101   .00424476 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret55      |                        |                        |                        |                        |                        
       mktrf |  .00028642  -.00019596 |  .00002092  -.00001431 |  .00019851  -.00013581 |  .00016709  -.00011431 |  .00028251  -.00019328 
       _cons | -.00019596   .00823557 | -.00001431    .0006015 | -.00013581   .00570764 | -.00011431   .00480425 | -.00019328   .00812288 

             | exret21                | exret22                | exret23                | exret24                | exret25                
        e(V) |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret21      |                        |                        |                        |                        |                        
       mktrf |  .00053346             |                        |                        |                        |                        
       _cons | -.00036497   .01533861 |                        |                        |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret22      |                        |                        |                        |                        |                        
       mktrf |  .00032203  -.00022032 |  .00038892             |                        |                        |                        
       _cons | -.00022032    .0092593 | -.00026609   .01118267 |                        |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret23      |                        |                        |                        |                        |                        
       mktrf |  .00024172  -.00016537 |  .00027349  -.00018711 |  .00033861             |                        |                        
       _cons | -.00016537   .00695011 | -.00018711   .00786352 | -.00023166     .009736 |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret24      |                        |                        |                        |                        |                        
       mktrf |   .0002205  -.00015086 |  .00027255  -.00018647 |   .0002968  -.00020306 |  .00040092             |                        
       _cons | -.00015086   .00633995 | -.00018647   .00783652 | -.00020306   .00853377 |  -.0002743   .01152774 |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret25      |                        |                        |                        |                        |                        
       mktrf |  .00022033  -.00015074 |  .00028312   -.0001937 |  .00031274  -.00021396 |  .00039164  -.00026794 |   .0006432             
       _cons | -.00015074    .0063352 |  -.0001937   .00814061 | -.00021396   .00899208 | -.00026794   .01126069 | -.00044005   .01849387 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret31      |                        |                        |                        |                        |                        
       mktrf |  .00027085  -.00018531 |  .00021912  -.00014991 |  .00016571  -.00011338 |  .00014754  -.00010094 |  .00015074  -.00010313 
       _cons | -.00018531   .00778778 | -.00014991   .00630022 | -.00011338   .00476478 | -.00010094    .0042421 | -.00010313    .0043343 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret32      |                        |                        |                        |                        |                        
       mktrf |  .00016882   -.0001155 |  .00017268  -.00011814 |  .00015282  -.00010455 |  .00014894   -.0001019 |  .00016009  -.00010953 
       _cons |  -.0001155   .00485413 | -.00011814   .00496499 | -.00010455   .00439404 |  -.0001019   .00428246 | -.00010953   .00460308 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret33      |                        |                        |                        |                        |                        
       mktrf |   .0001097  -.00007505 |  .00015799  -.00010809 |  .00018518   -.0001267 |  .00019987  -.00013675 |  .00021467  -.00014687 
       _cons | -.00007505   .00315427 | -.00010809   .00454279 |  -.0001267   .00532461 | -.00013675     .005747 | -.00014687   .00617235 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret34      |                        |                        |                        |                        |                        
       mktrf |   .0001163  -.00007957 |  .00018698  -.00012793 |  .00021579  -.00014763 |  .00026361  -.00018035 |  .00029768  -.00020366 
       _cons | -.00007957     .003344 | -.00012793   .00537634 | -.00014763    .0062045 | -.00018035   .00757959 | -.00020366   .00855913 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret35      |                        |                        |                        |                        |                        
       mktrf |  .00013616  -.00009316 |  .00021226  -.00014522 |  .00025941  -.00017748 |  .00031823  -.00021772 |  .00044066  -.00030148 
       _cons | -.00009316   .00391513 | -.00014522   .00610315 | -.00017748    .0074589 | -.00021772   .00915019 | -.00030148   .01267026 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret41      |                        |                        |                        |                        |                        
       mktrf |  .00013895  -.00009506 |  .00007272  -.00004975 |  .00002244  -.00001535 |  1.363e-06  -9.326e-07 | -.00001198   8.199e-06 
       _cons | -.00009506    .0039951 | -.00004975   .00209098 | -.00001535   .00064531 | -9.326e-07   .00003919 |  8.199e-06  -.00034458 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret42      |                        |                        |                        |                        |                        
       mktrf |  .00006437  -.00004404 |   .0000943  -.00006452 |  .00009315  -.00006373 |  .00009631  -.00006589 |  .00009626  -.00006586 
       _cons | -.00004404   .00185074 | -.00006452    .0027115 | -.00006373   .00267837 | -.00006589   .00276917 | -.00006586   .00276781 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret43      |                        |                        |                        |                        |                        
       mktrf |  .00004397  -.00003008 |   .0001029   -.0000704 |  .00012267  -.00008393 |  .00014103  -.00009648 |   .0001677  -.00011473 
       _cons | -.00003008    .0012643 |  -.0000704   .00295862 | -.00008393    .0035271 | -.00009648    .0040549 | -.00011473    .0048219 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret44      |                        |                        |                        |                        |                        
       mktrf |  .00004928  -.00003372 |  .00010081  -.00006897 |    .000136  -.00009304 |  .00019214  -.00013145 |   .0002407  -.00016468 
       _cons | -.00003372   .00141693 | -.00006897   .00289871 | -.00009304    .0039103 | -.00013145   .00552452 | -.00016468    .0069208 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret45      |                        |                        |                        |                        |                        
       mktrf |  .00007321  -.00005009 |  .00016683  -.00011414 |   .0002272  -.00015544 |  .00029228  -.00019996 |  .00039679  -.00027147 
       _cons | -.00005009    .0021051 | -.00011414   .00479685 | -.00015544   .00653262 | -.00019996   .00840379 | -.00027147   .01140876 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret51      |                        |                        |                        |                        |                        
       mktrf | -.00003608   .00002468 | -.00005758    .0000394 | -.00006563    .0000449 | -.00009008   .00006163 | -.00011664    .0000798 
       _cons |  .00002468  -.00103736 |   .0000394  -.00165571 |   .0000449  -.00188719 |  .00006163  -.00259015 |   .0000798   -.0033538 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret52      |                        |                        |                        |                        |                        
       mktrf | -.00005877   .00004021 |  -.0000426   .00002914 |  -.0000293   .00002004 | -.00002938    .0000201 | -.00003524   .00002411 
       _cons |  .00004021  -.00168987 |  .00002914  -.00122477 |  .00002004   -.0008424 |   .0000201  -.00084462 |  .00002411  -.00101323 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret53      |                        |                        |                        |                        |                        
       mktrf |  -.0000819   .00005603 | -.00002953    .0000202 |  2.501e-06  -1.711e-06 |  .00003976  -.00002721 |   .0000407  -.00002784 
       _cons |  .00005603  -.00235473 |   .0000202    -.000849 | -1.711e-06   .00007191 | -.00002721   .00114335 | -.00002784    .0011702 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret54      |                        |                        |                        |                        |                        
       mktrf | -.00006328   .00004329 |  .00001446  -9.894e-06 |  .00006765  -.00004629 |  .00011961  -.00008183 |  .00015738  -.00010767 
       _cons |  .00004329  -.00181944 | -9.894e-06   .00041579 | -.00004629   .00194527 | -.00008183   .00343907 | -.00010767   .00452519 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret55      |                        |                        |                        |                        |                        
       mktrf | -.00004296   .00002939 |   .0000139  -9.511e-06 |  .00008959  -.00006129 |  .00017306   -.0001184 |   .0002992   -.0002047 
       _cons |  .00002939  -.00123536 | -9.511e-06   .00039972 | -.00006129   .00257594 |  -.0001184   .00497597 |  -.0002047   .00860298 

             | exret31                | exret32                | exret33                | exret34                | exret35                
        e(V) |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret31      |                        |                        |                        |                        |                        
       mktrf |  .00030423             |                        |                        |                        |                        
       _cons | -.00020814    .0087476 |                        |                        |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret32      |                        |                        |                        |                        |                        
       mktrf |  .00012308   -.0000842 |  .00017322             |                        |                        |                        
       _cons |  -.0000842   .00353883 | -.00011851   .00498054 |                        |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret33      |                        |                        |                        |                        |                        
       mktrf |  .00008313  -.00005687 |  .00010994  -.00007522 |  .00018773             |                        |                        
       _cons | -.00005687   .00239015 | -.00007522   .00316115 | -.00012843   .00539767 |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret34      |                        |                        |                        |                        |                        
       mktrf |  .00007354  -.00005031 |  .00011316  -.00007742 |  .00016093  -.00011011 |  .00027667             |                        
       _cons | -.00005031   .00211437 | -.00007742   .00325357 | -.00011011   .00462735 | -.00018929   .00795517 |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret35      |                        |                        |                        |                        |                        
       mktrf |  .00007652  -.00005235 |  .00011975  -.00008193 |  .00019398  -.00013272 |  .00025829  -.00017671 |  .00053727             
       _cons | -.00005235   .00220008 | -.00008193    .0034431 | -.00013272   .00557761 | -.00017671   .00742662 | -.00036758   .01544817 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret41      |                        |                        |                        |                        |                        
       mktrf |  .00011477  -.00007852 |  .00006409  -.00004385 |  4.151e-06  -2.840e-06 | -.00001455   9.955e-06 | -.00004181    .0000286 
       _cons | -.00007852   .00330007 | -.00004385   .00184271 | -2.840e-06   .00011936 |  9.955e-06  -.00041836 |   .0000286  -.00120213 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret42      |                        |                        |                        |                        |                        
       mktrf |  .00005365   -.0000367 |   .0000755  -.00005166 |  .00008162  -.00005584 |   .0000854  -.00005842 |   .0000845  -.00005781 
       _cons |  -.0000367   .00154257 | -.00005166   .00217093 | -.00005584   .00234669 | -.00005842   .00245539 | -.00005781   .00242952 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret43      |                        |                        |                        |                        |                        
       mktrf |  .00003482  -.00002382 |  .00007311  -.00005002 |  .00010624  -.00007268 |  .00014588  -.00009981 |  .00015671  -.00010721 
       _cons | -.00002382   .00100109 | -.00005002   .00210221 | -.00007268   .00305463 | -.00009981   .00419453 | -.00010721   .00450579 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret44      |                        |                        |                        |                        |                        
       mktrf |  .00002093  -.00001432 |  .00007156  -.00004896 |  .00011389  -.00007792 |  .00018322  -.00012535 |  .00024117    -.000165 
       _cons | -.00001432   .00060166 | -.00004896   .00205751 | -.00007792   .00327471 | -.00012535   .00526815 |   -.000165   .00693429 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret45      |                        |                        |                        |                        |                        
       mktrf |  .00003681  -.00002518 |  .00009027  -.00006176 |  .00016833  -.00011516 |   .0002603  -.00017808 |  .00038305  -.00026207 
       _cons | -.00002518   .00105841 | -.00006176   .00259545 | -.00011516   .00483999 | -.00017808    .0074843 | -.00026207   .01101394 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret51      |                        |                        |                        |                        |                        
       mktrf |  -.0000167   .00001143 | -.00003832   .00002622 |  -.0000556   .00003804 | -.00007741   .00005296 | -.00010322   .00007062 
       _cons |  .00001143  -.00048026 |  .00002622  -.00110191 |  .00003804  -.00159858 |  .00005296  -.00222572 |  .00007062  -.00296791 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret52      |                        |                        |                        |                        |                        
       mktrf | -.00004496   .00003076 | -.00001551   .00001061 | -.00001176   8.046e-06 | -.00001192   8.153e-06 | -.00002132   .00001458 
       _cons |  .00003076  -.00129278 |  .00001061  -.00044597 |  8.046e-06  -.00033813 |  8.153e-06  -.00034265 |  .00001458  -.00061294 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret53      |                        |                        |                        |                        |                        
       mktrf | -.00006226    .0000426 | -.00001523   .00001042 |  .00002696  -.00001844 |  .00005509  -.00003769 |  .00006483  -.00004436 
       _cons |   .0000426  -.00179019 |  .00001042  -.00043802 | -.00001844   .00077505 | -.00003769   .00158387 | -.00004436   .00186418 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret54      |                        |                        |                        |                        |                        
       mktrf | -.00006494   .00004443 |  2.648e-06  -1.812e-06 |  .00007482  -.00005119 |  .00012538  -.00008578 |  .00018456  -.00012627 
       _cons |  .00004443   -.0018671 | -1.812e-06   .00007614 | -.00005119   .00215139 | -.00008578   .00360497 | -.00012627   .00530677 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret55      |                        |                        |                        |                        |                        
       mktrf | -.00006096   .00004171 |  .00001649  -.00001128 |   .0001025  -.00007012 |  .00015758  -.00010781 |   .0003175  -.00021722 
       _cons |  .00004171  -.00175287 | -.00001128   .00047409 | -.00007012   .00294705 | -.00010781   .00453094 | -.00021722   .00912895 

             | exret41                | exret42                | exret43                | exret44                | exret45                
        e(V) |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret41      |                        |                        |                        |                        |                        
       mktrf |  .00014499             |                        |                        |                        |                        
       _cons |  -.0000992   .00416896 |                        |                        |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret42      |                        |                        |                        |                        |                        
       mktrf |  .00002597  -.00001777 |  .00010581             |                        |                        |                        
       _cons | -.00001777   .00074663 | -.00007239   .00304235 |                        |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret43      |                        |                        |                        |                        |                        
       mktrf | -.00001402   9.591e-06 |  .00007153  -.00004894 |  .00015695             |                        |                        
       _cons |  9.591e-06  -.00040307 | -.00004894   .00205658 | -.00010738   .00451264 |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret44      |                        |                        |                        |                        |                        
       mktrf | -.00003149   .00002154 |  .00005231  -.00003579 |  .00011568  -.00007914 |  .00024788             |                        
       _cons |  .00002154  -.00090529 | -.00003579   .00150417 | -.00007914   .00332613 | -.00016959   .00712722 |                        
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret45      |                        |                        |                        |                        |                        
       mktrf | -.00005958   .00004077 |   .0000734  -.00005022 |  .00015975  -.00010929 |  .00024358  -.00016665 |  .00055295             
       _cons |  .00004077  -.00171322 | -.00005022   .00211059 | -.00010929   .00459323 | -.00016665    .0070038 | -.00037831    .0158991 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret51      |                        |                        |                        |                        |                        
       mktrf |  8.110e-06  -5.549e-06 | -.00003031   .00002073 | -.00004974   .00003403 | -.00007089    .0000485 | -.00010536   .00007208 
       _cons | -5.549e-06    .0002332 |  .00002073   -.0008714 |  .00003403  -.00143006 |   .0000485  -.00203842 |  .00007208  -.00302947 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret52      |                        |                        |                        |                        |                        
       mktrf | -.00001948   .00001333 |  2.761e-06  -1.889e-06 |  3.282e-06  -2.245e-06 |  9.085e-07  -6.216e-07 | -9.118e-06   6.238e-06 
       _cons |  .00001333  -.00056022 | -1.889e-06   .00007938 | -2.245e-06   .00009437 | -6.216e-07   .00002612 |  6.238e-06  -.00026216 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret53      |                        |                        |                        |                        |                        
       mktrf | -.00005907   .00004041 |  .00001308  -8.949e-06 |  .00004367  -.00002988 |  .00006524  -.00004464 |  .00008745  -.00005983 
       _cons |  .00004041   -.0016983 | -8.949e-06    .0003761 | -.00002988   .00125555 | -.00004464   .00187596 | -.00005983   .00251454 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret54      |                        |                        |                        |                        |                        
       mktrf | -.00008917     .000061 |  .00002445  -.00001673 |  .00008578  -.00005868 |  .00013367  -.00009145 |  .00020687  -.00014153 
       _cons |    .000061  -.00256382 | -.00001673   .00070305 | -.00005868    .0024663 | -.00009145   .00384333 | -.00014153     .005948 
-------------+------------------------+------------------------+------------------------+------------------------+------------------------
exret55      |                        |                        |                        |                        |                        
       mktrf | -.00009909   .00006779 |  .00002178   -.0000149 |  .00009454  -.00006468 |  .00020146  -.00013783 |  .00034601  -.00023673 
       _cons |  .00006779    -.002849 |  -.0000149   .00062632 | -.00006468   .00271841 | -.00013783   .00579269 | -.00023673   .00994894 

             | exret51                | exret52                | exret53                | exret54                | exret55               
        e(V) |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons |      mktrf       _cons 
-------------+------------------------+------------------------+------------------------+------------------------+-----------------------
exret51      |                        |                        |                        |                        |                       
       mktrf |  .00007097             |                        |                        |                        |                        
       _cons | -.00004855   .00204051 |                        |                        |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+-----------------------
exret52      |                        |                        |                        |                        |                       
       mktrf | -.00001154   7.892e-06 |  .00006909             |                        |                        |                        
       _cons |  7.892e-06  -.00033168 | -.00004727   .00198663 |                        |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+-----------------------
exret53      |                        |                        |                        |                        |                       
       mktrf | -.00004594   .00003143 |  .00002456   -.0000168 |  .00013925             |                        |                        
       _cons |  .00003143  -.00132094 |  -.0000168   .00070604 | -.00009527    .0040038 |                        |                        
-------------+------------------------+------------------------+------------------------+------------------------+-----------------------
exret54      |                        |                        |                        |                        |                       
       mktrf | -.00006793   .00004647 |  .00001523  -.00001042 |  .00010408  -.00007121 |  .00025515             |                        
       _cons |  .00004647  -.00195313 | -.00001042   .00043791 | -.00007121   .00299251 | -.00017456   .00733631 |                        
-------------+------------------------+------------------------+------------------------+------------------------+-----------------------
exret55      |                        |                        |                        |                        |                       
       mktrf |   -.000086   .00005884 | -1.623e-06   1.111e-06 |  .00008694  -.00005948 |  .00020608  -.00014099 |  .00070629             
       _cons |  .00005884  -.00247278 |  1.111e-06  -.00004667 | -.00005948   .00249973 | -.00014099   .00592533 | -.00048322   .02030797 

. matrix Sigma_capm = e(Sigma)

. 
. * Calculate factor moments
. quietly summarize mktrf

. local mu_mktrf = r(mean)

. local var_mktrf = r(Var)

. 
. * Calculate GRS statistic manually
. * alpha' * Sigma^-1 * alpha
. matrix Sigma_capm_inv = invsym(Sigma_capm)

. matrix quad_form = alpha_capm' * Sigma_capm_inv * alpha_capm

. local alpha_sigma_alpha = quad_form[1,1]

. 
. * 1 + mu' * Omega^-1 * mu (for single factor, this is 1 + mu^2/var)
. local sharpe_sq = (`mu_mktrf'^2) / `var_mktrf'

. local denom = 1 + `sharpe_sq'

. 
. * GRS F-statistic
. local num_df = `N'

. local den_df = `T' - `N' - `K_capm'

. local grs_capm = (`T' / `N') * (`den_df' / (`T' - `K_capm' - 1)) * (`alpha_sigma_alpha' / `denom')

. 
. * P-value
. local pval_capm = 1 - F(`num_df', `den_df', `grs_capm')

. 
. di "GRS F-statistic: " %10.4f `grs_capm'
GRS F-statistic:     3.3375

. di "Degrees of freedom: (`num_df', `den_df')"
Degrees of freedom: (25, 1161)

. di "P-value: " %10.6f `pval_capm'
P-value:   0.000000

. di ""


. if `pval_capm' < 0.05 {
.     di "Result: REJECT H0 at 5% level"
Result: REJECT H0 at 5% level
.     di "        CAPM alphas are jointly significantly different from zero"
        CAPM alphas are jointly significantly different from zero
. }

. else {
.     di "Result: FAIL TO REJECT H0 at 5% level"
. }

. 
. * Alternative: Use Stata's test command after mvreg
. di ""


. di "--- Alternative calculation using Stata's test command ---"
--- Alternative calculation using Stata's test command ---

. quietly mvreg `exret_vars' = mktrf

. 
. * Test all intercepts = 0
. local test_expr ""

. local first = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         if `first' {
  4.             local test_expr "[exret`size'`bm']_cons = 0"
  5.             local first = 0
  6.         }
  7.         else {
  8.             local test_expr "`test_expr', [exret`size'`bm']_cons = 0"
  9.         }
 10.     }
 11. }

. test `test_expr'
weights not allowed
r(101);

end of do-file

r(101);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     05_grs_test.do (FIXED)
>     
>     Purpose: Replicate Fama-French (1993) Table 9c
>              GRS Test (Gibbons, Ross, Shanken 1989)
>              
>     Test: H0: All 25 intercepts (alphas) are jointly equal to zero
>     
>     Input:  merged_data.dta
>     Output: GRS test results
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. * Load data
. use "$root/data/processed/merged_data.dta", clear

. 
. di ""


. di "======================================================================"
======================================================================

. di "GRS TEST - Replicating Table 9c"
GRS TEST - Replicating Table 9c

. di "======================================================================"
======================================================================

. di ""


. di "Gibbons, Ross, and Shanken (1989) Test"
Gibbons, Ross, and Shanken (1989) Test

. di "H0: All portfolio alphas are jointly equal to zero"
H0: All portfolio alphas are jointly equal to zero

. di ""


. di "Sample period: " %tm date[1] " to " %tm date[_N]
Sample period:  1926m7 to  2025m5

. di "Number of months (T): " _N
Number of months (T): 1187

. di "======================================================================"
======================================================================

. 
. local T = _N

. local N = 25

. 
. /*------------------------------------------------------------------------------
>     1. GRS Test for CAPM (1 Factor)
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Test 1: CAPM (Market Factor Only)"
Test 1: CAPM (Market Factor Only)

. di "======================================================================"
======================================================================

. di ""


. 
. local K_capm = 1

. 
. * Run individual regressions and store alphas and residuals
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
  4.         quietly predict resid_capm_`size'`bm', residuals
  5.         local alpha_capm_`size'`bm' = _b[_cons]
  6.         local se_alpha_capm_`size'`bm' = _se[_cons]
  7.     }
  8. }

. 
. * Create alpha vector
. matrix alpha_capm = J(25, 1, .)

. local i = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         matrix alpha_capm[`i', 1] = `alpha_capm_`size'`bm''
  4.         local i = `i' + 1
  5.     }
  6. }

. 
. * Calculate residual covariance matrix
. local resid_vars ""

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local resid_vars "`resid_vars' resid_capm_`size'`bm'"
  4.     }
  5. }

. 
. quietly correlate `resid_vars', covariance

. matrix Sigma_capm = r(C)

. 
. * Factor mean and variance
. quietly summarize mktrf

. local mu_mktrf = r(mean)

. local var_mktrf = r(Var)

. 
. * Calculate GRS statistic
. * GRS = (T/N) * ((T-N-K)/(T-K-1)) * (alpha' * Sigma^-1 * alpha) / (1 + mu'*Omega^-1*mu)
. 
. matrix Sigma_capm_inv = invsym(Sigma_capm)

. matrix quad_form = alpha_capm' * Sigma_capm_inv * alpha_capm

. local alpha_sigma_alpha = quad_form[1,1]

. 
. * For single factor: 1 + mu^2/var
. local sharpe_sq = (`mu_mktrf'^2) / `var_mktrf'

. local denom = 1 + `sharpe_sq'

. 
. * GRS F-statistic
. local num_df = `N'

. local den_df = `T' - `N' - `K_capm'

. local grs_capm = (`T' / `N') * (`den_df' / (`T' - `K_capm' - 1)) * (`alpha_sigma_alpha' / `denom')

. 
. * P-value
. local pval_capm = Ftail(`num_df', `den_df', `grs_capm')

. 
. di "Results:"
Results:

. di "  GRS F-statistic: " %10.4f `grs_capm'
  GRS F-statistic:     3.3403

. di "  Degrees of freedom: (" `num_df' ", " `den_df' ")"
  Degrees of freedom: (25, 1161)

. di "  P-value: " %10.6f `pval_capm'
  P-value:   0.000000

. di ""


. if `pval_capm' < 0.05 {
.     di "  ==> REJECT H0 at 5% level"
  ==> REJECT H0 at 5% level
.     di "      CAPM alphas are jointly significantly different from zero"
      CAPM alphas are jointly significantly different from zero
. }

. else {
.     di "  ==> FAIL TO REJECT H0 at 5% level"
. }

. 
. * Clean up CAPM residuals
. drop resid_capm_*

. 
. /*------------------------------------------------------------------------------
>     2. GRS Test for Three-Factor Model
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Test 2: Fama-French Three-Factor Model"
Test 2: Fama-French Three-Factor Model

. di "======================================================================"
======================================================================

. di ""


. 
. local K_ff3 = 3

. 
. * Run individual regressions and store alphas and residuals
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf smb hml
  4.         quietly predict resid_ff3_`size'`bm', residuals
  5.         local alpha_ff3_`size'`bm' = _b[_cons]
  6.     }
  7. }

. 
. * Create alpha vector
. matrix alpha_ff3 = J(25, 1, .)

. local i = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         matrix alpha_ff3[`i', 1] = `alpha_ff3_`size'`bm''
  4.         local i = `i' + 1
  5.     }
  6. }

. 
. * Calculate residual covariance matrix
. local resid_vars ""

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local resid_vars "`resid_vars' resid_ff3_`size'`bm'"
  4.     }
  5. }

. 
. quietly correlate `resid_vars', covariance

. matrix Sigma_ff3 = r(C)

. 
. * Factor means
. quietly summarize mktrf

. local mu1 = r(mean)

. quietly summarize smb

. local mu2 = r(mean)

. quietly summarize hml

. local mu3 = r(mean)

. 
. matrix mu_factors = (`mu1' \ `mu2' \ `mu3')

. 
. * Factor covariance matrix
. quietly correlate mktrf smb hml, covariance

. matrix Omega = r(C)

. 
. * Calculate GRS statistic
. matrix Sigma_ff3_inv = invsym(Sigma_ff3)

. matrix quad_form_ff3 = alpha_ff3' * Sigma_ff3_inv * alpha_ff3

. local alpha_sigma_alpha_ff3 = quad_form_ff3[1,1]

. 
. * mu' * Omega^-1 * mu
. matrix Omega_inv = invsym(Omega)

. matrix sharpe_quad = mu_factors' * Omega_inv * mu_factors

. local sharpe_sq_ff3 = sharpe_quad[1,1]

. local denom_ff3 = 1 + `sharpe_sq_ff3'

. 
. * GRS F-statistic
. local den_df_ff3 = `T' - `N' - `K_ff3'

. local grs_ff3 = (`T' / `N') * (`den_df_ff3' / (`T' - `K_ff3' - 1)) * (`alpha_sigma_alpha_ff3' / `denom_ff3')

. 
. * P-value
. local pval_ff3 = Ftail(`num_df', `den_df_ff3', `grs_ff3')

. 
. di "Results:"
Results:

. di "  GRS F-statistic: " %10.4f `grs_ff3'
  GRS F-statistic:     3.3140

. di "  Degrees of freedom: (" `num_df' ", " `den_df_ff3' ")"
  Degrees of freedom: (25, 1159)

. di "  P-value: " %10.6f `pval_ff3'
  P-value:   0.000000

. di ""


. if `pval_ff3' < 0.05 {
.     di "  ==> REJECT H0 at 5% level"
  ==> REJECT H0 at 5% level
.     di "      Some pricing errors remain in the three-factor model"
      Some pricing errors remain in the three-factor model
. }

. else {
.     di "  ==> FAIL TO REJECT H0 at 5% level"
.     di "      Three-factor model adequately prices the 25 portfolios"
. }

. 
. * Clean up FF3 residuals
. drop resid_ff3_*

. 
. /*------------------------------------------------------------------------------
>     3. Additional Statistics
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Additional Diagnostics"
Additional Diagnostics

. di "======================================================================"
======================================================================

. di ""


. 
. * Average absolute alpha
. local sum_abs_alpha_capm = 0

. local sum_abs_alpha_ff3 = 0

. forvalues i = 1/25 {
  2.     local sum_abs_alpha_capm = `sum_abs_alpha_capm' + abs(alpha_capm[`i', 1])
  3.     local sum_abs_alpha_ff3 = `sum_abs_alpha_ff3' + abs(alpha_ff3[`i', 1])
  4. }

. local avg_abs_alpha_capm = `sum_abs_alpha_capm' / 25

. local avg_abs_alpha_ff3 = `sum_abs_alpha_ff3' / 25

. 
. * Sum of squared alphas
. local ssa_capm = 0

. local ssa_ff3 = 0

. forvalues i = 1/25 {
  2.     local ssa_capm = `ssa_capm' + (alpha_capm[`i', 1])^2
  3.     local ssa_ff3 = `ssa_ff3' + (alpha_ff3[`i', 1])^2
  4. }

. 
. di "                                    CAPM      Three-Factor"
                                    CAPM      Three-Factor

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. di "Average |alpha| (% per month):   " %8.4f `avg_abs_alpha_capm' "     " %8.4f `avg_abs_alpha_ff3'
Average |alpha| (% per month):     0.1514       0.1158

. di "Sum of Squared Alphas:           " %8.4f `ssa_capm' "     " %8.4f `ssa_ff3'
Sum of Squared Alphas:             0.9797       0.8805

. di "GRS F-statistic:                 " %8.4f `grs_capm' "     " %8.4f `grs_ff3'
GRS F-statistic:                   3.3403       3.3140

. di "GRS p-value:                     " %8.6f `pval_capm' "   " %8.6f `pval_ff3'
GRS p-value:                     0.000000   0.000000

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. 
. /*------------------------------------------------------------------------------
>     4. Improvement Metrics
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "Model Improvement Metrics"
Model Improvement Metrics

. di "======================================================================"
======================================================================

. di ""


. 
. local grs_reduction = (1 - `grs_ff3'/`grs_capm') * 100

. local ssa_reduction = (1 - `ssa_ff3'/`ssa_capm') * 100

. local alpha_reduction = (1 - `avg_abs_alpha_ff3'/`avg_abs_alpha_capm') * 100

. 
. di "Reduction in GRS F-statistic: " %5.1f `grs_reduction' "%"
Reduction in GRS F-statistic:   0.8%

. di "Reduction in Sum of Squared Alphas: " %5.1f `ssa_reduction' "%"
Reduction in Sum of Squared Alphas:  10.1%

. di "Reduction in Average |alpha|: " %5.1f `alpha_reduction' "%"
Reduction in Average |alpha|:  23.5%

. 
. /*------------------------------------------------------------------------------
>     5. Export Results
> ------------------------------------------------------------------------------*/
. 
. preserve

. clear

. set obs 2
Number of observations (_N) was 0, now 2.

. gen str20 model = ""
(2 missing values generated)

. gen grs_fstat = .
(2 missing values generated)

. gen df1 = .
(2 missing values generated)

. gen df2 = .
(2 missing values generated)

. gen pvalue = .
(2 missing values generated)

. gen avg_abs_alpha = .
(2 missing values generated)

. gen ssa = .
(2 missing values generated)

. 
. replace model = "CAPM" in 1
(1 real change made)

. replace grs_fstat = `grs_capm' in 1
(1 real change made)

. replace df1 = `num_df' in 1
(1 real change made)

. replace df2 = `den_df' in 1
(1 real change made)

. replace pvalue = `pval_capm' in 1
(1 real change made)

. replace avg_abs_alpha = `avg_abs_alpha_capm' in 1
(1 real change made)

. replace ssa = `ssa_capm' in 1
(1 real change made)

. 
. replace model = "Three-Factor" in 2
(1 real change made)

. replace grs_fstat = `grs_ff3' in 2
(1 real change made)

. replace df1 = `num_df' in 2
(1 real change made)

. replace df2 = `den_df_ff3' in 2
(1 real change made)

. replace pvalue = `pval_ff3' in 2
(1 real change made)

. replace avg_abs_alpha = `avg_abs_alpha_ff3' in 2
(1 real change made)

. replace ssa = `ssa_ff3' in 2
(1 real change made)

. 
. export delimited "$root/output/tables/table9c_grs_test.csv", replace
(file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table9c_grs_test.csv not found)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table9c_grs_test.csv saved

. restore

. 
. /*------------------------------------------------------------------------------
>     6. Summary
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "GRS TEST SUMMARY"
GRS TEST SUMMARY

. di "======================================================================"
======================================================================

. di ""


. di "The GRS test examines whether all 25 portfolio alphas are jointly zero."
The GRS test examines whether all 25 portfolio alphas are jointly zero.

. di ""


. di "--------------------------------------------------------------"
--------------------------------------------------------------

. di "Model             GRS F-stat    p-value      Conclusion"
Model             GRS F-stat    p-value      Conclusion

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. di "CAPM              " %8.2f `grs_capm' "     " %8.6f `pval_capm' "   " cond(`pval_capm'<0.05, "REJECT", "NOT REJECT")
CAPM                  3.34     0.000000   REJECT

. di "Three-Factor      " %8.2f `grs_ff3' "     " %8.6f `pval_ff3' "   " cond(`pval_ff3'<0.05, "REJECT", "NOT REJECT")
Three-Factor          3.31     0.000000   REJECT

. di "--------------------------------------------------------------"
--------------------------------------------------------------

. di ""


. di "Key Finding:"
Key Finding:

. di "  - GRS F-statistic reduced by " %4.1f `grs_reduction' "% (from " %5.2f `grs_capm' " to " %5.2f `grs_ff3' ")"
  - GRS F-statistic reduced by  0.8% (from  3.34 to  3.31)

. di "  - Three-factor model substantially improves upon CAPM"
  - Three-factor model substantially improves upon CAPM

. di ""


. di "Output: $root/output/tables/table9c_grs_test.csv"
Output: /Users/pei-chin/Research/FamaFrench_1993_Replication/output/tables/table9c_grs_test.csv

. di "======================================================================"
======================================================================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000gn/T//SD59607.000000"

. /*==============================================================================
>     06_figures.do
>     
>     Purpose: Create visualizations for Fama-French (1993) replication
>     
>     Figures:
>     1. Mean returns by Size and B/M
>     2. SMB loadings pattern
>     3. HML loadings pattern
>     4. CAPM vs Three-Factor alphas
>     5. R-squared comparison
>     6. Factor cumulative returns
>     
>     Input:  merged_data.dta
>     Output: PNG figures
> ==============================================================================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench_1993_Replication"

. 
. * Create output directory
. cap mkdir "$root/output"

. cap mkdir "$root/output/figures"

. 
. * Set graph scheme
. set scheme s2color

. 
. * Load data
. use "$root/data/processed/merged_data.dta", clear

. 
. di ""


. di "======================================================================"
======================================================================

. di "CREATING FIGURES"
CREATING FIGURES

. di "======================================================================"
======================================================================

. 
. /*------------------------------------------------------------------------------
>     1. Run Regressions to Get Coefficients
> ------------------------------------------------------------------------------*/
. 
. * Store results in matrices
. matrix mean_ret = J(5, 5, .)

. matrix alpha_capm = J(5, 5, .)

. matrix alpha_ff3 = J(5, 5, .)

. matrix rsq_capm = J(5, 5, .)

. matrix rsq_ff3 = J(5, 5, .)

. matrix s_smb = J(5, 5, .)

. matrix h_hml = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         * Mean returns
.         quietly summarize exret`size'`bm'
  4.         matrix mean_ret[`size', `bm'] = r(mean)
  5.         
.         * CAPM
.         quietly regress exret`size'`bm' mktrf
  6.         matrix alpha_capm[`size', `bm'] = _b[_cons]
  7.         matrix rsq_capm[`size', `bm'] = e(r2)
  8.         
.         * Three-factor
.         quietly regress exret`size'`bm' mktrf smb hml
  9.         matrix alpha_ff3[`size', `bm'] = _b[_cons]
 10.         matrix rsq_ff3[`size', `bm'] = e(r2)
 11.         matrix s_smb[`size', `bm'] = _b[smb]
 12.         matrix h_hml[`size', `bm'] = _b[hml]
 13.     }
 14. }

. 
. /*------------------------------------------------------------------------------
>     Figure 1: Mean Excess Returns by Size
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "Creating Figure 1: Mean Returns by Size..."
Creating Figure 1: Mean Returns by Size...

. 
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen mean_return = .
(5 missing values generated)

. 
. * Calculate average return for each size quintile
. forvalues s = 1/5 {
  2.     local sum = 0
  3.     forvalues b = 1/5 {
  4.         local sum = `sum' + mean_ret[`s', `b']
  5.     }
  6.     replace mean_return = `sum'/5 if size == `s'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. label define size_lbl 1 "Small" 2 "2" 3 "3" 4 "4" 5 "Big"

. label values size size_lbl

. 
. twoway (bar mean_return size, barwidth(0.7) color(navy)) ///
>     (scatter mean_return size, msymbol(none) mlabel(mean_return) mlabformat(%4.2f) mlabposition(12) mlabcolor(black)), ///
>     title("Average Monthly Excess Returns by Size Quintile") ///
>     subtitle("Size Effect: Small stocks earn higher returns") ///
>     ytitle("Mean Excess Return (% per month)") ///
>     xtitle("Size Quintile") ///
>     xlabel(1 "Small" 2 "2" 3 "3" 4 "4" 5 "Big") ///
>     ylabel(0(0.2)1.0) ///
>     legend(off) ///
>     note("Sample: 1926m7 - 2025m5")

. 
. graph export "$root/output/figures/fig1_returns_by_size.png", replace width(1200)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/figures/fig1_returns_by_size.png saved as PNG format

. restore

. 
. /*------------------------------------------------------------------------------
>     Figure 2: Mean Excess Returns by B/M
> ------------------------------------------------------------------------------*/
. 
. di "Creating Figure 2: Mean Returns by B/M..."
Creating Figure 2: Mean Returns by B/M...

. 
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen bm = _n

. gen mean_return = .
(5 missing values generated)

. 
. * Calculate average return for each B/M quintile
. forvalues b = 1/5 {
  2.     local sum = 0
  3.     forvalues s = 1/5 {
  4.         local sum = `sum' + mean_ret[`s', `b']
  5.     }
  6.     replace mean_return = `sum'/5 if bm == `b'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (bar mean_return bm, barwidth(0.7) color(maroon)) ///
>     (scatter mean_return bm, msymbol(none) mlabel(mean_return) mlabformat(%4.2f) mlabposition(12) mlabcolor(black)), ///
>     title("Average Monthly Excess Returns by Book-to-Market Quintile") ///
>     subtitle("Value Effect: High B/M stocks earn higher returns") ///
>     ytitle("Mean Excess Return (% per month)") ///
>     xtitle("Book-to-Market Quintile") ///
>     xlabel(1 "Low (Growth)" 2 "2" 3 "3" 4 "4" 5 "High (Value)") ///
>     ylabel(0(0.2)1.2) ///
>     legend(off) ///
>     note("Sample: 1926m7 - 2025m5")

. 
. graph export "$root/output/figures/fig2_returns_by_bm.png", replace width(1200)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/figures/fig2_returns_by_bm.png saved as PNG format

. restore

. 
. /*------------------------------------------------------------------------------
>     Figure 3: SMB Loadings by Size
> ------------------------------------------------------------------------------*/
. 
. di "Creating Figure 3: SMB Loadings by Size..."
Creating Figure 3: SMB Loadings by Size...

. 
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen smb_loading = .
(5 missing values generated)

. 
. * Calculate average SMB loading for each size quintile
. forvalues s = 1/5 {
  2.     local sum = 0
  3.     forvalues b = 1/5 {
  4.         local sum = `sum' + s_smb[`s', `b']
  5.     }
  6.     replace smb_loading = `sum'/5 if size == `s'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (bar smb_loading size, barwidth(0.7) color(forest_green)) ///
>     (scatter smb_loading size, msymbol(none) mlabel(smb_loading) mlabformat(%4.2f) mlabposition(12) mlabcolor(black)), ///
>     title("SMB Factor Loadings by Size Quintile") ///
>     subtitle("Small stocks load positively, Big stocks load negatively on SMB") ///
>     ytitle("SMB Loading (s)") ///
>     xtitle("Size Quintile") ///
>     xlabel(1 "Small" 2 "2" 3 "3" 4 "4" 5 "Big") ///
>     ylabel(-0.5(0.5)1.5) ///
>     yline(0, lcolor(black) lpattern(dash)) ///
>     legend(off) ///
>     note("From three-factor regressions: R - RF = a + b*MktRF + s*SMB + h*HML")

. 
. graph export "$root/output/figures/fig3_smb_loadings.png", replace width(1200)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/figures/fig3_smb_loadings.png saved as PNG format

. restore

. 
. /*------------------------------------------------------------------------------
>     Figure 4: HML Loadings by B/M
> ------------------------------------------------------------------------------*/
. 
. di "Creating Figure 4: HML Loadings by B/M..."
Creating Figure 4: HML Loadings by B/M...

. 
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen bm = _n

. gen hml_loading = .
(5 missing values generated)

. 
. * Calculate average HML loading for each B/M quintile
. forvalues b = 1/5 {
  2.     local sum = 0
  3.     forvalues s = 1/5 {
  4.         local sum = `sum' + h_hml[`s', `b']
  5.     }
  6.     replace hml_loading = `sum'/5 if bm == `b'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (bar hml_loading bm, barwidth(0.7) color(dkorange)) ///
>     (scatter hml_loading bm, msymbol(none) mlabel(hml_loading) mlabformat(%4.2f) mlabposition(12) mlabcolor(black)), ///
>     title("HML Factor Loadings by Book-to-Market Quintile") ///
>     subtitle("Growth stocks load negatively, Value stocks load positively on HML") ///
>     ytitle("HML Loading (h)") ///
>     xtitle("Book-to-Market Quintile") ///
>     xlabel(1 "Low (Growth)" 2 "2" 3 "3" 4 "4" 5 "High (Value)") ///
>     ylabel(-0.5(0.5)1.0) ///
>     yline(0, lcolor(black) lpattern(dash)) ///
>     legend(off) ///
>     note("From three-factor regressions: R - RF = a + b*MktRF + s*SMB + h*HML")

. 
. graph export "$root/output/figures/fig4_hml_loadings.png", replace width(1200)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/figures/fig4_hml_loadings.png saved as PNG format

. restore

. 
. /*------------------------------------------------------------------------------
>     Figure 5: CAPM vs Three-Factor Alphas Comparison
> ------------------------------------------------------------------------------*/
. 
. di "Creating Figure 5: Alpha Comparison..."
Creating Figure 5: Alpha Comparison...

. 
. preserve

. clear

. set obs 25
Number of observations (_N) was 0, now 25.

. gen portfolio = _n

. gen alpha_capm_val = .
(25 missing values generated)

. gen alpha_ff3_val = .
(25 missing values generated)

. 
. local i = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         replace alpha_capm_val = alpha_capm[`size', `bm'] if portfolio == `i'
  4.         replace alpha_ff3_val = alpha_ff3[`size', `bm'] if portfolio == `i'
  5.         local i = `i' + 1
  6.     }
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. * Scatter plot
. twoway (scatter alpha_ff3_val alpha_capm_val, msymbol(circle) mcolor(navy) msize(medium)) ///
>     (function y=x, range(-0.8 0.5) lcolor(red) lpattern(dash)) ///
>     (function y=0, range(-0.8 0.5) lcolor(gray) lpattern(dot)), ///
>     title("CAPM vs Three-Factor Model Alphas") ///
>     subtitle("Three-factor alphas are closer to zero") ///
>     ytitle("Three-Factor Alpha (% per month)") ///
>     xtitle("CAPM Alpha (% per month)") ///
>     ylabel(-0.8(0.2)0.4) ///
>     xlabel(-0.8(0.2)0.6) ///
>     legend(order(1 "25 Portfolios" 2 "45-degree line") position(5) ring(0)) ///
>     note("Points below 45-degree line indicate FF3 alpha < CAPM alpha (in absolute value)")

. 
. graph export "$root/output/figures/fig5_alpha_comparison.png", replace width(1200)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/figures/fig5_alpha_comparison.png saved as PNG format

. restore

. 
. /*------------------------------------------------------------------------------
>     Figure 6: R-squared Comparison
> ------------------------------------------------------------------------------*/
. 
. di "Creating Figure 6: R-squared Comparison..."
Creating Figure 6: R-squared Comparison...

. 
. preserve

. clear

. set obs 25
Number of observations (_N) was 0, now 25.

. gen portfolio = _n

. gen rsq_capm_val = .
(25 missing values generated)

. gen rsq_ff3_val = .
(25 missing values generated)

. gen portfolio_name = ""
(25 missing values generated)

. 
. local i = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         replace rsq_capm_val = rsq_capm[`size', `bm'] if portfolio == `i'
  4.         replace rsq_ff3_val = rsq_ff3[`size', `bm'] if portfolio == `i'
  5.         local size_label = cond(`size'==1, "S", cond(`size'==5, "B", "`size'"))
  6.         local bm_label = cond(`bm'==1, "L", cond(`bm'==5, "H", "`bm'"))
  7.         replace portfolio_name = "`size_label'`bm_label'" if portfolio == `i'
  8.         local i = `i' + 1
  9.     }
 10. }
(1 real change made)
(1 real change made)
variable portfolio_name was str1 now str2
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. * Calculate averages
. quietly summarize rsq_capm_val

. local avg_rsq_capm = r(mean)

. quietly summarize rsq_ff3_val

. local avg_rsq_ff3 = r(mean)

. 
. * Bar chart for average R-squared
. clear

. set obs 2
Number of observations (_N) was 0, now 2.

. gen model = _n

. gen avg_rsq = .
(2 missing values generated)

. gen model_name = ""
(2 missing values generated)

. 
. replace model_name = "CAPM" if model == 1
variable model_name was str1 now str4
(1 real change made)

. replace avg_rsq = `avg_rsq_capm' if model == 1
(1 real change made)

. replace model_name = "Three-Factor" if model == 2
variable model_name was str4 now str12
(1 real change made)

. replace avg_rsq = `avg_rsq_ff3' if model == 2
(1 real change made)

. 
. twoway (bar avg_rsq model, barwidth(0.5) color(navy maroon)) ///
>     (scatter avg_rsq model, msymbol(none) mlabel(avg_rsq) mlabformat(%4.3f) mlabposition(12) mlabcolor(black)), ///
>     title("Average R-squared: CAPM vs Three-Factor Model") ///
>     subtitle("Three-factor model explains substantially more variation") ///
>     ytitle("Average R-squared") ///
>     xtitle("") ///
>     xlabel(1 "CAPM" 2 "Three-Factor") ///
>     ylabel(0(0.2)1.0) ///
>     legend(off) ///
>     note("Average across 25 Size-B/M portfolios")

. 
. graph export "$root/output/figures/fig6_rsq_comparison.png", replace width(1200)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/figures/fig6_rsq_comparison.png saved as PNG format

. restore

. 
. /*------------------------------------------------------------------------------
>     Figure 7: Cumulative Factor Returns
> ------------------------------------------------------------------------------*/
. 
. di "Creating Figure 7: Cumulative Factor Returns..."
Creating Figure 7: Cumulative Factor Returns...

. 
. use "$root/data/processed/merged_data.dta", clear

. 
. * Calculate cumulative returns (log scale approximation)
. gen cum_mktrf = sum(mktrf/100)

. gen cum_smb = sum(smb/100)

. gen cum_hml = sum(hml/100)

. 
. * Convert to percentage growth
. replace cum_mktrf = (exp(cum_mktrf) - 1) * 100
(1,187 real changes made)

. replace cum_smb = (exp(cum_smb) - 1) * 100
(1,187 real changes made)

. replace cum_hml = (exp(cum_hml) - 1) * 100
(1,187 real changes made)

. 
. twoway (line cum_mktrf date, lcolor(navy) lwidth(medium)) ///
>     (line cum_smb date, lcolor(forest_green) lwidth(medium)) ///
>     (line cum_hml date, lcolor(maroon) lwidth(medium)), ///
>     title("Cumulative Factor Returns (1926-2025)") ///
>     subtitle("Log-scale cumulative returns") ///
>     ytitle("Cumulative Return (%)") ///
>     xtitle("Date") ///
>     legend(order(1 "Market (Mkt-RF)" 2 "Size (SMB)" 3 "Value (HML)") position(11) ring(0) cols(1)) ///
>     note("Starting value = 0% in July 1926")

. 
. graph export "$root/output/figures/fig7_cumulative_returns.png", replace width(1200)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/figures/fig7_cumulative_returns.png saved as PNG format

. 
. /*------------------------------------------------------------------------------
>     Figure 8: Heatmap of Mean Returns (5x5)
> ------------------------------------------------------------------------------*/
. 
. di "Creating Figure 8: Mean Returns Heatmap..."
Creating Figure 8: Mean Returns Heatmap...

. 
. preserve

. clear

. set obs 25
Number of observations (_N) was 0, now 25.

. gen size = .
(25 missing values generated)

. gen bm = .
(25 missing values generated)

. gen mean_return = .
(25 missing values generated)

. 
. local i = 1

. forvalues s = 1/5 {
  2.     forvalues b = 1/5 {
  3.         replace size = `s' in `i'
  4.         replace bm = `b' in `i'
  5.         replace mean_return = mean_ret[`s', `b'] in `i'
  6.         local i = `i' + 1
  7.     }
  8. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. * Create heatmap using scatter with marker size
. twoway (scatter size bm [w=mean_return], msymbol(square) msize(*3) mcolor(navy%70)), ///
>     title("Mean Excess Returns: 5x5 Size-B/M Portfolios") ///
>     subtitle("Marker size proportional to return magnitude") ///
>     ytitle("Size (1=Small, 5=Big)") ///
>     xtitle("Book-to-Market (1=Low, 5=High)") ///
>     ylabel(1 "Small" 2 "2" 3 "3" 4 "4" 5 "Big", angle(0)) ///
>     xlabel(1 "Low" 2 "2" 3 "3" 4 "4" 5 "High") ///
>     legend(off) ///
>     note("Returns increase from Big/Low (bottom-left) to Small/High (top-right)")
(analytic weights assumed)
(analytic weights assumed)
(analytic weights assumed)

. 
. graph export "$root/output/figures/fig8_returns_heatmap.png", replace width(1200)
file /Users/pei-chin/Research/FamaFrench_1993_Replication/output/figures/fig8_returns_heatmap.png saved as PNG format

. restore

. 
. /*------------------------------------------------------------------------------
>     Summary
> ------------------------------------------------------------------------------*/
. 
. di ""


. di "======================================================================"
======================================================================

. di "FIGURES CREATED SUCCESSFULLY!"
FIGURES CREATED SUCCESSFULLY!

. di "======================================================================"
======================================================================

. di ""


. di "Output files saved to: $root/output/figures/"
Output files saved to: /Users/pei-chin/Research/FamaFrench_1993_Replication/output/figures/

. di ""


. di "  fig1_returns_by_size.png     - Size effect visualization"
  fig1_returns_by_size.png     - Size effect visualization

. di "  fig2_returns_by_bm.png       - Value effect visualization"
  fig2_returns_by_bm.png       - Value effect visualization

. di "  fig3_smb_loadings.png        - SMB factor loadings by size"
  fig3_smb_loadings.png        - SMB factor loadings by size

. di "  fig4_hml_loadings.png        - HML factor loadings by B/M"
  fig4_hml_loadings.png        - HML factor loadings by B/M

. di "  fig5_alpha_comparison.png    - CAPM vs FF3 alphas scatter"
  fig5_alpha_comparison.png    - CAPM vs FF3 alphas scatter

. di "  fig6_rsq_comparison.png      - R-squared comparison"
  fig6_rsq_comparison.png      - R-squared comparison

. di "  fig7_cumulative_returns.png  - Factor cumulative returns"
  fig7_cumulative_returns.png  - Factor cumulative returns

. di "  fig8_returns_heatmap.png     - 5x5 returns heatmap"
  fig8_returns_heatmap.png     - 5x5 returns heatmap

. di ""


. di "======================================================================"
======================================================================

. 
end of do-file

. clear all

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     00_check_data_structure.do 
>     
>     Purpose: Quick diagnostic check of CSV file 
> structure before importing
>     
>     NOTE: Run this first to see what we're deali
> ng with!
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. // Setting up the main project folder path
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. /*----------------------------------------------
> --------------------------------
>     Part 1: Checking the 25 Portfolios File
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "NOW CHECKING: 25_Portfolios_5x5.csv"
NOW CHECKING: 25_Portfolios_5x5.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
. // Import everything as strings first - easier t
> o see what's going on
. import delimited "$root/data/raw/25_Portfolios_5
> x5.csv", clear stringcols(_all) varnames(nonames
> )
(encoding automatically selected: ISO-8859-1)
(26 vars, 8,895 obs)

. 
. // Let's see what variables we got
. describe, short

Contains data
 Observations:         8,895                  
    Variables:            26                  
Sorted by: 
     Note: Dataset has changed since last saved.

. 
. // Display the first bunch of rows so we can eye
> ball the structure
. di ""


. di "Here are the first 20 rows:"
Here are the first 20 rows:

. list v1 v2 v3 v4 v5 in 1/20, clean noobs

                                                  
>                                                 
>                              v1           v2    
>       v3          v4          v5  
                                                  
>                           This file was created 
> using the 202511 CRSP database.                 
>                                   
                                              It c
> ontains value- and equal-weighted returns for po
> rtfolios formed on ME and BEME.                 
>                                   
    The portfolios are constructed at the end of J
> une.  BEME is book value at the last fiscal year
>  end of the prior calendar year                 
>                                   
                                                  
>                         divided by ME at the end
>  of December of the prior year.                 
>                                   
                                                  
>                                    Annual return
> s are from January to December.                 
>                                   
                                                  
>                                   Missing data a
> re indicated by -99.99 or -999.                 
>                                   
                                                  
>                       The break points include u
> tilities and include financials                 
>                                   
                                                  
>                      The  portfolios  include ut
> ilities and include financials.                 
>                                   
                                                  
>                                       Average Va
> lue Weighted Returns -- Monthly                 
>                                   
                                                  
>                                                 
>                                   SMALL LoBM    
>  ME1 BM2     ME1 BM3     ME1 BM4  
                                                  
>                                                 
>                          192607       5.8276    
>  -1.7006      0.5118     -2.1477  
                                                  
>                                                 
>                          192608      -2.0206    
>  -8.0282      1.3968      2.1483  
                                                  
>                                                 
>                          192609      -4.8291    
>  -2.6806     -4.3417     -3.2683  
                                                  
>                                                 
>                          192610      -9.3633    
>  -3.5519     -3.5024      3.4413  
                                                  
>                                                 
>                          192611       5.5888    
>   4.1877      2.4384     -4.4495  
                                                  
>                                                 
>                          192612      14.9644    
>  -1.4263      0.0084      3.3801  
                                                  
>                                                 
>                          192701       1.0954    
>  -8.1352     -4.8280      3.0498  
                                                  
>                                                 
>                          192702       2.8672    
>  -0.4922      8.5078      5.2580  
                                                  
>                                                 
>                          192703       5.8224    
>  -0.0730     -5.8769     -3.9186  
                                                  
>                                                 
>                          192704       7.8274    
>   4.7880      4.3995      3.3905  

. 
. // Just checking how many rows total
. di ""


. di "Total number of rows: " _N
Total number of rows: 8895

. 
. /*----------------------------------------------
> --------------------------------
>     Part 2: Now Let's Check the Factors File
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "NOW CHECKING: F-F_Research_Data_Factors.csv"
NOW CHECKING: F-F_Research_Data_Factors.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
. // Same approach - import as strings to see the 
> raw data
. import delimited "$root/data/raw/F-F_Research_Da
> ta_Factors.csv", clear stringcols(_all) varnames
> (nonames)
(encoding automatically selected: ISO-8859-1)
(5 vars, 1,293 obs)

. 
. // Show me the first 20 rows again
. di ""


. di "First 20 rows look like this:"
First 20 rows look like this:

. list v1 v2 v3 v4 v5 in 1/20, clean noobs

                                                  
>                                            v1   
>                                                 
>                       v2        v3        v4    
>     v5  
                                          This fil
> e was created using the 202507 CRSP database.   
>                                                 
>                                                 
>         
    The 1-month TBill rate data until 202405 are f
> rom Ibbotson Associates. Starting from 202406   
>  the 1-month TBill rate is from ICE BofA US 1-Mo
> nth Treasury Bill Index.                        
>         
                                                  
>                                                 
>                                                 
>                   Mkt-RF       SMB       HML    
>     RF  
                                                  
>                                        192607   
>                                                 
>                     2.89     -2.55     -2.39    
>   0.22  
                                                  
>                                        192608   
>                                                 
>                     2.64     -1.14      3.81    
>   0.25  
                                                  
>                                        192609   
>                                                 
>                     0.38     -1.36      0.05    
>   0.23  
                                                  
>                                        192610   
>                                                 
>                    -3.27     -0.14      0.82    
>   0.32  
                                                  
>                                        192611   
>                                                 
>                     2.54     -0.11     -0.61    
>   0.31  
                                                  
>                                        192612   
>                                                 
>                     2.62     -0.07      0.06    
>   0.28  
                                                  
>                                        192701   
>                                                 
>                    -0.05     -0.32      4.58    
>   0.25  
                                                  
>                                        192702   
>                                                 
>                     4.17      0.07      2.72    
>   0.26  
                                                  
>                                        192703   
>                                                 
>                     0.14     -1.77     -2.38    
>   0.30  
                                                  
>                                        192704   
>                                                 
>                     0.47      0.39      0.65    
>   0.25  
                                                  
>                                        192705   
>                                                 
>                     5.45      1.55      4.80    
>   0.30  
                                                  
>                                        192706   
>                                                 
>                    -2.38      0.51     -1.72    
>   0.26  
                                                  
>                                        192707   
>                                                 
>                     7.26     -3.27     -1.13    
>   0.30  
                                                  
>                                        192708   
>                                                 
>                     1.99     -0.77     -3.85    
>   0.28  
                                                  
>                                        192709   
>                                                 
>                     4.77     -3.60     -0.57    
>   0.21  
                                                  
>                                        192710   
>                                                 
>                    -4.29      2.03     -4.47    
>   0.25  
                                                  
>                                        192711   
>                                                 
>                     6.52      2.78     -0.08    
>   0.21  

. 
. // Total row count
. di ""


. di "Total number of rows: " _N
Total number of rows: 1293

. 
. /*----------------------------------------------
> --------------------------------
>     Part 3: What to Do Next
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "WHAT I NEED TO DO NEXT:"
WHAT I NEED TO DO NEXT:

. di "============================================
> =========================="
==================================================
> ====================

. di "1. Check the output above and figure out:"
1. Check the output above and figure out:

. di "   - Where are the actual column headers?"
   - Where are the actual column headers?

. di "   - What row does the real data start on?"
   - What row does the real data start on?

. di ""


. di "2. Once know that, fix the import script"
2. Once know that, fix the import script

. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     01_data_preparation_v4.do
>     
>     Purpose: Import and prep the data for Fama-F
> rench (1993) replication
>     
>     Note: The 25 Portfolios file from Ken French
>  has multiple sections in it:
>     - Value-weighted returns (this is what we ne
> ed)
>     - Equal-weighted returns
>     - Other stuff
>     We're just grabbing the first section (value
> -weighted).
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. // Main project directory
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. // Make sure we have the folders we need
. cap mkdir "$root/data"

. cap mkdir "$root/data/processed"

. 
. /*----------------------------------------------
> --------------------------------
>     Step 1: Import the 25 Portfolios (Value-Weig
> hted Section Only)
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Step 1: Loading 25 Portfolios data..."
Step 1: Loading 25 Portfolios data...

. di "============================================
> =========================="
==================================================
> ====================

. 
. // First let's see what the file structure looks
>  like
. import delimited "$root/data/raw/25_Portfolios_5
> x5.csv", clear stringcols(_all) varnames(nonames
> )
(encoding automatically selected: ISO-8859-1)
(26 vars, 8,895 obs)

. 
. // Try to find rows that are section headers (th
> ey have text instead of numbers)
. // Look for words like "Equal" or "Annual" - tho
> se mark new sections
. gen rownum = _n

. gen is_header = regexm(v1, "[A-Za-z]")

. gen is_date = regexm(v1, "^[0-9]{6}$")

. 
. // Show me which rows might be section breaks
. di "These rows might be section headers:"
These rows might be section headers:

. list rownum v1 v2 if is_header == 1 & rownum > 1
> 0 in 1/50

. 
. // Find where the first section ends
. summarize rownum if is_header == 1 & rownum > 15

    Variable |        Obs        Mean    Std. dev.
>        Min        Max
-------------+------------------------------------
> ---------------------
      rownum |         24    5809.125    2121.418 
>       1204       8895

. local section_end = r(min) - 1

. 
. di ""


. di "First data section looks like it ends at row
> : `section_end'"
First data section looks like it ends at row: 1203

. 
. // OK now let's import just the value-weighted p
> art
. clear

. import delimited "$root/data/raw/25_Portfolios_5
> x5.csv", clear rowrange(11:`section_end') varnam
> es(10)
(encoding automatically selected: ISO-8859-1)
(26 vars, 1,190 obs)

. 
. // Rename the first variable to yyyymm for date
. ds
thebreakpo~n  v10           v19
v2            v11           v20
v3            v12           v21
v4            v13           v22
v5            v14           v23
v6            v15           v24
v7            v16           v25
v8            v17           v26
v9            v18

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. // Clean up the date variable
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced a
> s long
(3 missing values generated)

. drop if yyyymm == .
(3 observations deleted)

. drop if yyyymm < 100000  // Remove weird values
(0 observations deleted)

. 
. // Check if we have any duplicate dates (shouldn
> 't happen but let's verify)
. duplicates report yyyymm

Duplicates in terms of yyyymm

--------------------------------------
   Copies | Observations       Surplus
----------+---------------------------
        1 |         1187             0
--------------------------------------

. duplicates list yyyymm if yyyymm != .

Duplicates in terms of yyyymm

(0 observations are duplicates)

. 
. // Now rename the 25 portfolio columns
. ds yyyymm, not
v2   v5   v8   v11  v14  v17  v20  v23  v26
v3   v6   v9   v12  v15  v18  v21  v24
v4   v7   v10  v13  v16  v19  v22  v25

. local portvars `r(varlist)'

. local nvars : word count `portvars'

. di "Number of portfolio variables found: `nvars'
> "
Number of portfolio variables found: 25

. 
. // Loop through and rename as p11, p12, ... p55
. local i = 1

. foreach var of local portvars {
  2.     local size = ceil(`i'/5)
  3.     local bm = `i' - (`size'-1)*5
  4.     rename `var' p`size'`bm'
  5.     local i = `i' + 1
  6. }

. 
. // Convert to numeric and clean
. foreach var of varlist p* {
  2.     cap destring `var', replace force
  3. }

. 
. // Get rid of obvious missing value codes
. foreach var of varlist p* {
  2.     replace `var' = . if `var' < -90
  3. }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. // Create proper date variables for Stata
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. sort date

. 
. // Make sure dates are unique
. isid date

. di "Portfolio data loaded: " _N " observations (
> unique by date)"
Portfolio data loaded: 1187 observations (unique b
> y date)

. di "Date range goes from: " yyyymm[1] " to " yyy
> ymm[_N]
Date range goes from: 192607 to 202505

. 
. // Save this temporarily
. save "$root/data/processed/portfolios_temp.dta",
>  replace
(file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/data/processed/portfolios_temp.dt
    > a not found)
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/data/processed/portfolios_temp.dt
    > a saved

. 
. /*----------------------------------------------
> --------------------------------
>     Step 2: Import Fama-French Factor Data
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Step 2: Loading Fama-French Factors..."
Step 2: Loading Fama-French Factors...

. di "============================================
> =========================="
==================================================
> ====================

. 
. clear

. import delimited "$root/data/raw/F-F_Research_Da
> ta_Factors.csv", clear rowrange(5) varnames(4)
(encoding automatically selected: ISO-8859-1)
(5 vars, 1,290 obs)

. 
. // Rename first variable to date
. ds
v1     mktrf  smb    hml    rf

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. // Clean the date variable
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced a
> s long
(3 missing values generated)

. drop if yyyymm == .
(3 observations deleted)

. drop if yyyymm < 100000
(98 observations deleted)

. drop if yyyymm > 209912  // Keep it reasonable
(0 observations deleted)

. 
. // Convert factor variables to numeric
. foreach var in mktrf smb hml rf {
  2.     cap destring `var', replace force
  3.     cap replace `var' = . if `var' < -90  // 
> Remove missing codes
  4. }

. 
. // Make Stata date variables
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. keep date yyyymm year month mktrf smb hml rf

. sort date

. 
. // Check for duplicate dates here too
. duplicates report date

Duplicates in terms of date

--------------------------------------
   Copies | Observations       Surplus
----------+---------------------------
        1 |         1189             0
--------------------------------------

. bysort date: keep if _n == 1  // Just keep first
>  if duplicates exist
(0 observations deleted)

. 
. di "Factor data loaded: " _N " observations"
Factor data loaded: 1189 observations

. 
. /*----------------------------------------------
> --------------------------------
>     Step 3: Merge the Two Datasets Together
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Step 3: Merging the datasets..."
Step 3: Merging the datasets...

. di "============================================
> =========================="
==================================================
> ====================

. 
. merge 1:1 date using "$root/data/processed/portf
> olios_temp.dta", nogen keep(match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             1,187  
    -----------------------------------------

. sort date

. 
. di "Merged dataset has: " _N " observations"
Merged dataset has: 1187 observations

. di "Date range: " %tm date[1] " to " %tm date[_N
> ]
Date range:  1926m7 to  2025m5

. 
. // Clean up temporary file
. cap erase "$root/data/processed/portfolios_temp.
> dta"

. 
. /*----------------------------------------------
> --------------------------------
>     Step 4: Calculate Excess Returns for Portfol
> ios
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Step 4: Calculating excess returns..."
Step 4: Calculating excess returns...

. di "============================================
> =========================="
==================================================
> ====================

. 
. // Create excess return = portfolio return - ris
> k free rate
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         gen exret`size'`bm' = p`size'`bm' - r
> f
  4.     }
  5. }

. 
. di "Created 25 excess return variables"
Created 25 excess return variables

. 
. /*----------------------------------------------
> --------------------------------
>     Step 5: Save the Final Clean Dataset
> ------------------------------------------------
> ------------------------------*/
. 
. order date yyyymm year month mktrf smb hml rf p*
>  exret*

. compress
  variable date was float now int
  variable year was float now int
  variable month was float now byte
  (8,309 bytes saved)

. save "$root/data/processed/merged_data.dta", rep
> lace
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/data/processed/merged_data.dta
    saved

. 
. /*----------------------------------------------
> --------------------------------
>     Step 6: Print Summary Info
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "DATA PREP DONE!"
DATA PREP DONE!

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Saved to: $root/data/processed/merged_data.d
> ta"
Saved to: /Users/pei-chin/Research/FamaFrench_1993
> _Replication/data/processed/merged_data.dta

. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Total months: " _N
Total months: 1187

. di ""


. di "Factor Summary Stats:"
Factor Summary Stats:

. summarize mktrf smb hml rf

    Variable |        Obs        Mean    Std. dev.
>        Min        Max
-------------+------------------------------------
> ---------------------
       mktrf |      1,187    .6841618    5.320598 
>     -28.74      38.81
         smb |      1,187    .1637742    3.158712 
>     -17.41      35.96
         hml |      1,187    .3463606     3.55905 
>     -13.83      35.52
          rf |      1,187     .269604    .2495654 
>       -.06       1.35

. 
. di ""


. di "Portfolio Excess Returns (just the corners):
> "
Portfolio Excess Returns (just the corners):

. summarize exret11 exret15 exret51 exret55

    Variable |        Obs        Mean    Std. dev.
>        Min        Max
-------------+------------------------------------
> ---------------------
     exret11 |      1,187    .5509995    11.91993 
>    -49.503   147.8201
     exret15 |      1,187    1.330208    9.169148 
>   -33.0903    99.4873
     exret51 |      1,187    .6840005    5.341898 
>   -28.4828    32.3293
     exret55 |      1,187    .9486664    8.457548 
>   -45.5856    98.0192

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     02_summary_statistics.do
>     
>     Purpose: Generate summary stats (trying to r
> eplicate parts of Table 2)
>     
>     Table 2 in FF1993 has:
>     - Mean returns and standard deviations
>     - Autocorrelations
>     - Correlations among factors
> ================================================
> ==============================*/
. 
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. /*----------------------------------------------
> --------------------------------
>     Part 1: Summary Stats for the 25 Portfolios 
> (Table 2a style)
> ------------------------------------------------
> ------------------------------*/
. 
. // Set up matrices to store our results
. matrix means = J(5, 5, .)

. matrix sds = J(5, 5, .)

. matrix tstats = J(5, 5, .)

. 
. // Loop through each portfolio and calculate mea
> n, sd, t-stat
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly summarize exret`size'`bm'
  4.         local mean = r(mean)
  5.         local sd = r(sd)
  6.         local n = r(N)
  7.         local tstat = `mean' / (`sd' / sqrt(`
> n'))
  8.         
.         matrix means[`size', `bm'] = `mean'
  9.         matrix sds[`size', `bm'] = `sd'
 10.         matrix tstats[`size', `bm'] = `tstat'
 11.     }
 12. }

. 
. // Add labels to make the output readable
. matrix colnames means = "Low" "2" "3" "4" "High"

. matrix rownames means = "Small" "2" "3" "4" "Big
> "

. matrix colnames sds = "Low" "2" "3" "4" "High"

. matrix rownames sds = "Small" "2" "3" "4" "Big"

. matrix colnames tstats = "Low" "2" "3" "4" "High
> "

. matrix rownames tstats = "Small" "2" "3" "4" "Bi
> g"

. 
. // Show the results
. di _newline(2) "=" * 70


=*70 invalid name
r(198);

end of do-file

r(198);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. display _newline(2) _dup(70) "="


==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     02_summary_statistics.do
>     
>     Purpose: Generate summary stats (trying to r
> eplicate parts of Table 2)
>     
>     Table 2 in FF1993 has:
>     - Mean returns and standard deviations
>     - Autocorrelations
>     - Correlations among factors
> ================================================
> ==============================*/
. 
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. /*----------------------------------------------
> --------------------------------
>     Part 1: Summary Stats for the 25 Portfolios 
> (Table 2a style)
> ------------------------------------------------
> ------------------------------*/
. 
. // Set up matrices to store our results
. matrix means = J(5, 5, .)

. matrix sds = J(5, 5, .)

. matrix tstats = J(5, 5, .)

. 
. // Loop through each portfolio and calculate mea
> n, sd, t-stat
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly summarize exret`size'`bm'
  4.         local mean = r(mean)
  5.         local sd = r(sd)
  6.         local n = r(N)
  7.         local tstat = `mean' / (`sd' / sqrt(`
> n'))
  8.         
.         matrix means[`size', `bm'] = `mean'
  9.         matrix sds[`size', `bm'] = `sd'
 10.         matrix tstats[`size', `bm'] = `tstat'
 11.     }
 12. }

. 
. // Add labels to make the output readable
. matrix colnames means = "Low" "2" "3" "4" "High"

. matrix rownames means = "Small" "2" "3" "4" "Big
> "

. matrix colnames sds = "Low" "2" "3" "4" "High"

. matrix rownames sds = "Small" "2" "3" "4" "Big"

. matrix colnames tstats = "Low" "2" "3" "4" "High
> "

. matrix rownames tstats = "Small" "2" "3" "4" "Bi
> g"

. 
. // Show the results
. 
. di _newline(2) "=" * 70


=*70 invalid name
r(198);

end of do-file

r(198);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     02_summary_statistics.do
>     
>     Purpose: Generate summary stats (trying to r
> eplicate parts of Table 2)
>     
>     Table 2 in FF1993 has:
>     - Mean returns and standard deviations
>     - Autocorrelations
>     - Correlations among factors
> ================================================
> ==============================*/
. 
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. /*----------------------------------------------
> --------------------------------
>     Part 1: Summary Stats for the 25 Portfolios 
> (Table 2a style)
> ------------------------------------------------
> ------------------------------*/
. 
. // Set up matrices to store our results
. matrix means = J(5, 5, .)

. matrix sds = J(5, 5, .)

. matrix tstats = J(5, 5, .)

. 
. // Loop through each portfolio and calculate mea
> n, sd, t-stat
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly summarize exret`size'`bm'
  4.         local mean = r(mean)
  5.         local sd = r(sd)
  6.         local n = r(N)
  7.         local tstat = `mean' / (`sd' / sqrt(`
> n'))
  8.         
.         matrix means[`size', `bm'] = `mean'
  9.         matrix sds[`size', `bm'] = `sd'
 10.         matrix tstats[`size', `bm'] = `tstat'
 11.     }
 12. }

. 
. // Add labels to make the output readable
. matrix colnames means = "Low" "2" "3" "4" "High"

. matrix rownames means = "Small" "2" "3" "4" "Big
> "

. matrix colnames sds = "Low" "2" "3" "4" "High"

. matrix rownames sds = "Small" "2" "3" "4" "Big"

. matrix colnames tstats = "Low" "2" "3" "4" "High
> "

. matrix rownames tstats = "Small" "2" "3" "4" "Bi
> g"

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. // Show the results
. di _newline(2) _dup(70) "="


==================================================
> ====================

. di "TABLE 2a: Mean Monthly Excess Returns (in pe
> rcent)"
TABLE 2a: Mean Monthly Excess Returns (in percent)

. di "25 Portfolios Formed on Size and Book-to-Mar
> ket"
25 Portfolios Formed on Size and Book-to-Market

. di _dup(70) "="
==================================================
> ====================

. 
. matrix list means, format(%6.2f)

means[5,5]
        Low     2     3     4  High
Small  0.55  0.64  0.96  1.12  1.33
    2  0.63  0.92  0.95  1.03  1.22
    3  0.71  0.90  0.91  0.99  1.09
    4  0.73  0.77  0.84  0.96  1.02
  Big  0.68  0.65  0.70  0.67  0.95

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. di _newline(2) "=" * 70


=*70 invalid name
r(198);

end of do-file

r(198);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     02_summary_statistics.do
>     
>     Purpose: Generate summary stats (trying to r
> eplicate parts of Table 2)
>     
>     Table 2 in FF1993 has:
>     - Mean returns and standard deviations
>     - Autocorrelations
>     - Correlations among factors
> ================================================
> ==============================*/
. 
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. /*----------------------------------------------
> --------------------------------
>     Part 1: Summary Stats for the 25 Portfolios 
> (Table 2a style)
> ------------------------------------------------
> ------------------------------*/
. 
. // Set up matrices to store our results
. matrix means = J(5, 5, .)

. matrix sds = J(5, 5, .)

. matrix tstats = J(5, 5, .)

. 
. // Loop through each portfolio and calculate mea
> n, sd, t-stat
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly summarize exret`size'`bm'
  4.         local mean = r(mean)
  5.         local sd = r(sd)
  6.         local n = r(N)
  7.         local tstat = `mean' / (`sd' / sqrt(`
> n'))
  8.         
.         matrix means[`size', `bm'] = `mean'
  9.         matrix sds[`size', `bm'] = `sd'
 10.         matrix tstats[`size', `bm'] = `tstat'
 11.     }
 12. }

. 
. // Add labels to make the output readable
. matrix colnames means = "Low" "2" "3" "4" "High"

. matrix rownames means = "Small" "2" "3" "4" "Big
> "

. matrix colnames sds = "Low" "2" "3" "4" "High"

. matrix rownames sds = "Small" "2" "3" "4" "Big"

. matrix colnames tstats = "Low" "2" "3" "4" "High
> "

. matrix rownames tstats = "Small" "2" "3" "4" "Bi
> g"

. 
. 
. 
. // Show the results
. di _newline(2) _dup(70) "="


==================================================
> ====================

. di "TABLE 2a: Mean Monthly Excess Returns (in pe
> rcent)"
TABLE 2a: Mean Monthly Excess Returns (in percent)

. di "25 Portfolios Formed on Size and Book-to-Mar
> ket"
25 Portfolios Formed on Size and Book-to-Market

. di _dup(70) "="
==================================================
> ====================

. 
. matrix list means, format(%6.2f)

means[5,5]
        Low     2     3     4  High
Small  0.55  0.64  0.96  1.12  1.33
    2  0.63  0.92  0.95  1.03  1.22
    3  0.71  0.90  0.91  0.99  1.09
    4  0.73  0.77  0.84  0.96  1.02
  Big  0.68  0.65  0.70  0.67  0.95

. 
. 
. di _newline(2) _dup(70) "="


==================================================
> ====================

. di "Standard Deviations of Monthly Excess Return
> s"
Standard Deviations of Monthly Excess Returns

. di _dup(70) "="
==================================================
> ====================

. matrix list sds, format(%6.2f)

sds[5,5]
         Low      2      3      4   High
Small  11.92   9.66   8.85   8.28   9.17
    2   7.97   7.48   7.22   7.44   8.68
    3   7.35   6.49   6.47   6.94   8.38
    4   6.20   6.10   6.30   6.82   8.56
  Big   5.34   5.26   5.58   6.53   8.46

. 
. di _newline(2) _dup(70) "="


==================================================
> ====================

. di "t-statistics for Mean Returns"
t-statistics for Mean Returns

. di _dup(70) "="
==================================================
> ====================

. matrix list tstats, format(%6.2f)

tstats[5,5]
        Low     2     3     4  High
Small  1.59  2.30  3.75  4.64  5.00
    2  2.74  4.22  4.52  4.75  4.84
    3  3.32  4.77  4.84  4.93  4.50
    4  4.04  4.36  4.57  4.85  4.12
  Big  4.41  4.23  4.33  3.51  3.86

. 
. /*----------------------------------------------
> --------------------------------
>     Part 2: Summary Stats for the Factors (Table
>  2b style)
> ------------------------------------------------
> ------------------------------*/
. 
. di _newline(2) _dup(70) "="


==================================================
> ====================

. di "TABLE 2b: Summary Statistics for Explanatory
>  Variables"
TABLE 2b: Summary Statistics for Explanatory Varia
> bles

. di _dup(70) "="
==================================================
> ====================

. 
. // Quick summary of all factors
. summarize mktrf smb hml rf

    Variable |        Obs        Mean    Std. dev.
>        Min        Max
-------------+------------------------------------
> ---------------------
       mktrf |      1,187    .6841618    5.320598 
>     -28.74      38.81
         smb |      1,187    .1637742    3.158712 
>     -17.41      35.96
         hml |      1,187    .3463606     3.55905 
>     -13.83      35.52
          rf |      1,187     .269604    .2495654 
>       -.06       1.35

. 
. // Now let's make a nicer table
. di _newline "Detailed Factor Statistics:"

Detailed Factor Statistics:

. di _dup(60) "-"
--------------------------------------------------
> ----------

. 
. foreach var in mktrf smb hml rf {
  2.     quietly summarize `var'
  3.     local mean = r(mean)
  4.     local sd = r(sd)
  5.     local n = r(N)
  6.     local tstat = `mean' / (`sd' / sqrt(`n'))
  7.     
.     di "`var':"
  8.     di "  Mean     = " %8.4f `mean'
  9.     di "  Std Dev  = " %8.4f `sd'
 10.     di "  t-stat   = " %8.2f `tstat'
 11.     di ""
 12. }
mktrf:
  Mean     =   0.6842
  Std Dev  =   5.3206
  t-stat   =     4.43

smb:
  Mean     =   0.1638
  Std Dev  =   3.1587
  t-stat   =     1.79

hml:
  Mean     =   0.3464
  Std Dev  =   3.5591
  t-stat   =     3.35

rf:
  Mean     =   0.2696
  Std Dev  =   0.2496
  t-stat   =    37.22


. 
. /*----------------------------------------------
> --------------------------------
>     Part 3: Autocorrelations (from Table 2)
> ------------------------------------------------
> ------------------------------*/
. 
. di _newline(2) _dup(70) "="


==================================================
> ====================

. di "Autocorrelations of Factors"
Autocorrelations of Factors

. di _dup(70) "="
==================================================
> ====================

. 
. // Check autocorrelation for each factor
. foreach var in mktrf smb hml rf {
  2.     di _newline "`var':"
  3.     corrgram `var', lags(12) noplot
  4. }

mktrf:
time variable not set, use tsset varname ...
r(111);

end of do-file

r(111);

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     02_summary_statistics.do
>     
>     Purpose: Replicate Fama-French (1993) Table 
> 2
>              Summary statistics for 25 portfolio
> s and factors
>     
>     Input:  merged_data.dta
>     Output: Summary statistics tables
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. * Create output directory
. cap mkdir "$root/output"

. cap mkdir "$root/output/tables"

. 
. * Load data
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "SUMMARY STATISTICS - Replicating Table 2"
SUMMARY STATISTICS - Replicating Table 2

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Number of months: " _N
Number of months: 1187

. di "============================================
> =========================="
==================================================
> ====================

. 
. /*----------------------------------------------
> --------------------------------
>     1. Factor Summary Statistics
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 1: Factor Summary Statistics"
Part 1: Factor Summary Statistics

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. * Calculate statistics for each factor
. foreach var in mktrf smb hml rf {
  2.     quietly summarize `var'
  3.     local mean_`var' = r(mean)
  4.     local sd_`var' = r(sd)
  5.     local n_`var' = r(N)
  6.     local tstat_`var' = `mean_`var'' / (`sd_`
> var'' / sqrt(`n_`var''))
  7. }

. 
. di "Factor         Mean     Std Dev    t-stat   
>   N"
Factor         Mean     Std Dev    t-stat     N

. di "--------------------------------------------
> ----------"
--------------------------------------------------
> ----

. di "Mkt-RF      " %8.3f `mean_mktrf' "   " %8.3f
>  `sd_mktrf' "   " %6.2f `tstat_mktrf' "   " `n_m
> ktrf'
Mkt-RF         0.684      5.321     4.43   1187

. di "SMB         " %8.3f `mean_smb' "   " %8.3f `
> sd_smb' "   " %6.2f `tstat_smb' "   " `n_smb'
SMB            0.164      3.159     1.79   1187

. di "HML         " %8.3f `mean_hml' "   " %8.3f `
> sd_hml' "   " %6.2f `tstat_hml' "   " `n_hml'
HML            0.346      3.559     3.35   1187

. di "RF          " %8.3f `mean_rf' "   " %8.3f `s
> d_rf' "   " %6.2f `tstat_rf' "   " `n_rf'
RF             0.270      0.250    37.22   1187

. di "--------------------------------------------
> ----------"
--------------------------------------------------
> ----

. 
. /*----------------------------------------------
> --------------------------------
>     2. Portfolio Mean Excess Returns (5x5 Matrix
> )
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 2: Mean Excess Returns (% per month)"
Part 2: Mean Excess Returns (% per month)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Rows = Size (1=Small to 5=Big)"
Rows = Size (1=Small to 5=Big)

. di "Cols = Book-to-Market (1=Low/Growth to 5=Hig
> h/Value)"
Cols = Book-to-Market (1=Low/Growth to 5=High/Valu
> e)

. di ""


. 
. * Create matrix for mean returns
. matrix mean_ret = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly summarize exret`size'`bm'
  4.         matrix mean_ret[`size', `bm'] = r(mea
> n)
  5.     }
  6. }

. 
. * Display matrix
. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "          (Growth)                          
>      (Value)"
          (Growth)                               (
> Value)

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f mean_ret
> [`size',1] %8.3f mean_ret[`size',2] %8.3f mean_r
> et[`size',3] %8.3f mean_ret[`size',4] %8.3f mean
> _ret[`size',5]
  4. }
Small         0.551   0.645   0.964   1.116   1.33
> 0
Size2         0.633   0.917   0.948   1.026   1.21
> 9
Size3         0.708   0.897   0.908   0.993   1.09
> 5
Size4         0.726   0.772   0.835   0.960   1.02
> 3
Big           0.684   0.645   0.702   0.666   0.94
> 9

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. * Calculate row and column averages
. di ""


. di "Average by Size (across all B/M):"
Average by Size (across all B/M):

. forvalues size = 1/5 {
  2.     local rowsum = 0
  3.     forvalues bm = 1/5 {
  4.         local rowsum = `rowsum' + mean_ret[`s
> ize', `bm']
  5.     }
  6.     local rowavg = `rowsum' / 5
  7.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big", "Size`size'"))
  8.     di "  `size_label': " %8.3f `rowavg'
  9. }
  Small:    0.921
  Size2:    0.949
  Size3:    0.920
  Size4:    0.863
  Big:    0.729

. 
. di ""


. di "Average by B/M (across all Size):"
Average by B/M (across all Size):

. forvalues bm = 1/5 {
  2.     local colsum = 0
  3.     forvalues size = 1/5 {
  4.         local colsum = `colsum' + mean_ret[`s
> ize', `bm']
  5.     }
  6.     local colavg = `colsum' / 5
  7.     local bm_label = cond(`bm'==1, "Low BM", 
> cond(`bm'==5, "High BM", "BM`bm'"))
  8.     di "  `bm_label': " %8.3f `colavg'
  9. }
  Low BM:    0.661
  BM2:    0.775
  BM3:    0.871
  BM4:    0.952
  High BM:    1.123

. 
. /*----------------------------------------------
> --------------------------------
>     3. Portfolio Standard Deviations (5x5 Matrix
> )
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 3: Standard Deviations of Excess Return
> s (% per month)"
Part 3: Standard Deviations of Excess Returns (% p
> er month)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. matrix sd_ret = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly summarize exret`size'`bm'
  4.         matrix sd_ret[`size', `bm'] = r(sd)
  5.     }
  6. }

. 
. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f sd_ret[`
> size',1] %8.3f sd_ret[`size',2] %8.3f sd_ret[`si
> ze',3] %8.3f sd_ret[`size',4] %8.3f sd_ret[`size
> ',5]
  4. }
Small        11.920   9.657   8.852   8.281   9.16
> 9
Size2         7.972   7.482   7.221   7.436   8.67
> 5
Size3         7.355   6.486   6.466   6.937   8.37
> 5
Size4         6.197   6.104   6.301   6.822   8.56
> 3
Big           5.342   5.257   5.580   6.533   8.45
> 8

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     4. t-Statistics for Mean Returns
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 4: t-Statistics for Mean Excess Returns
> "
Part 4: t-Statistics for Mean Excess Returns

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "(Testing H0: mean = 0)"
(Testing H0: mean = 0)

. di ""


. 
. matrix tstat_ret = J(5, 5, .)

. local T = _N

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local tstat = mean_ret[`size', `bm'] 
> / (sd_ret[`size', `bm'] / sqrt(`T'))
  4.         matrix tstat_ret[`size', `bm'] = `tst
> at'
  5.     }
  6. }

. 
. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.2f tstat_re
> t[`size',1] %8.2f tstat_ret[`size',2] %8.2f tsta
> t_ret[`size',3] %8.2f tstat_ret[`size',4] %8.2f 
> tstat_ret[`size',5]
  4. }
Small          1.59    2.30    3.75    4.64    5.0
> 0
Size2          2.74    4.22    4.52    4.75    4.8
> 4
Size3          3.32    4.77    4.84    4.93    4.5
> 0
Size4          4.04    4.36    4.57    4.85    4.1
> 2
Big            4.41    4.23    4.33    3.51    3.8
> 6

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     5. Size and Value Spreads
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 5: Size and Value Spreads"
Part 5: Size and Value Spreads

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. * SMB-like spread: Average Small - Average Big
. local small_avg = (mean_ret[1,1] + mean_ret[1,2]
>  + mean_ret[1,3] + mean_ret[1,4] + mean_ret[1,5]
> ) / 5

. local big_avg = (mean_ret[5,1] + mean_ret[5,2] +
>  mean_ret[5,3] + mean_ret[5,4] + mean_ret[5,5]) 
> / 5

. local size_spread = `small_avg' - `big_avg'

. 
. di "Size Spread (Small - Big):"
Size Spread (Small - Big):

. di "  Average Small portfolio return: " %8.3f `s
> mall_avg'
  Average Small portfolio return:    0.921

. di "  Average Big portfolio return:   " %8.3f `b
> ig_avg'
  Average Big portfolio return:      0.729

. di "  Size spread:                    " %8.3f `s
> ize_spread'
  Size spread:                       0.192

. 
. di ""


. 
. * HML-like spread: Average High BM - Average Low
>  BM
. local highbm_avg = (mean_ret[1,5] + mean_ret[2,5
> ] + mean_ret[3,5] + mean_ret[4,5] + mean_ret[5,5
> ]) / 5

. local lowbm_avg = (mean_ret[1,1] + mean_ret[2,1]
>  + mean_ret[3,1] + mean_ret[4,1] + mean_ret[5,1]
> ) / 5

. local value_spread = `highbm_avg' - `lowbm_avg'

. 
. di "Value Spread (High B/M - Low B/M):"
Value Spread (High B/M - Low B/M):

. di "  Average High B/M portfolio return: " %8.3f
>  `highbm_avg'
  Average High B/M portfolio return:    1.123

. di "  Average Low B/M portfolio return:  " %8.3f
>  `lowbm_avg'
  Average Low B/M portfolio return:     0.661

. di "  Value spread:                      " %8.3f
>  `value_spread'
  Value spread:                         0.463

. 
. /*----------------------------------------------
> --------------------------------
>     6. Factor Correlations
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 6: Factor Correlations"
Part 6: Factor Correlations

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. correlate mktrf smb hml
(obs=1,187)

             |    mktrf      smb      hml
-------------+---------------------------
       mktrf |   1.0000
         smb |   0.3204   1.0000
         hml |   0.2283   0.1250   1.0000


. 
. /*----------------------------------------------
> --------------------------------
>     7. Export Results to CSV
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Exporting results to CSV..."
Exporting results to CSV...

. di "============================================
> =========================="
==================================================
> ====================

. 
. * Export mean returns matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = mean_ret[`size', 1] if si
> ze == `size'
  3.     replace bm2 = mean_ret[`size', 2] if size
>  == `size'
  4.     replace bm3 = mean_ret[`size', 3] if size
>  == `size'
  5.     replace bm4 = mean_ret[`size', 4] if size
>  == `size'
  6.     replace highbm = mean_ret[`size', 5] if s
> ize == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. label define size_lbl 1 "Small" 2 "Size2" 3 "Siz
> e3" 4 "Size4" 5 "Big"

. label values size size_lbl

. 
. export delimited "$root/output/tables/table2_mea
> n_returns.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table2_mean_returns.csv sa
> ved

. restore

. 
. * Export standard deviations matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = sd_ret[`size', 1] if size
>  == `size'
  3.     replace bm2 = sd_ret[`size', 2] if size =
> = `size'
  4.     replace bm3 = sd_ret[`size', 3] if size =
> = `size'
  5.     replace bm4 = sd_ret[`size', 4] if size =
> = `size'
  6.     replace highbm = sd_ret[`size', 5] if siz
> e == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table2_std
> _dev.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table2_std_dev.csv saved

. restore

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "SUMMARY STATISTICS COMPLETE!"
SUMMARY STATISTICS COMPLETE!

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Key Findings:"
Key Findings:

. di "1. Size Effect: Small stocks earn " %5.3f `s
> ize_spread' "% more per month than big stocks"
1. Size Effect: Small stocks earn 0.192% more per 
> month than big stocks

. di "2. Value Effect: High B/M stocks earn " %5.3
> f `value_spread' "% more per month than low B/M"
2. Value Effect: High B/M stocks earn 0.463% more 
> per month than low B/M

. di ""


. di "Output files:"
Output files:

. di "  - $root/output/tables/table2_mean_returns.
> csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table2_mean_returns.csv

. di "  - $root/output/tables/table2_std_dev.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table2_std_dev.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     02_summary_statistics.do
>     
>     Purpose: Replicate Fama-French (1993) Table 
> 2
>              Summary statistics for 25 portfolio
> s and factors
>     
>     Input:  merged_data.dta
>     Output: Summary statistics tables
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. * Create output directory
. cap mkdir "$root/output"

. cap mkdir "$root/output/tables"

. 
. * Load data
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "SUMMARY STATISTICS - Replicating Table 2"
SUMMARY STATISTICS - Replicating Table 2

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Number of months: " _N
Number of months: 1187

. di "============================================
> =========================="
==================================================
> ====================

. 
. /*----------------------------------------------
> --------------------------------
>     1. Factor Summary Statistics
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 1: Factor Summary Statistics"
Part 1: Factor Summary Statistics

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. * Calculate statistics for each factor
. * Note: Going through the basic factors first
. foreach var in mktrf smb hml rf {
  2.     qui sum `var'  // shortened quietly for r
> eadability
  3.     local mean_`var' = r(mean)
  4.     local sd_`var' = r(sd)
  5.     local n_`var' = r(N)
  6.     local tstat_`var' = `mean_`var'' / (`sd_`
> var'' / sqrt(`n_`var''))
  7. }

. 
. di "Factor         Mean     Std Dev    t-stat   
>   N"
Factor         Mean     Std Dev    t-stat     N

. di "--------------------------------------------
> ----------"
--------------------------------------------------
> ----

. di "Mkt-RF      " %8.3f `mean_mktrf' "   " %8.3f
>  `sd_mktrf' "   " %6.2f `tstat_mktrf' "   " `n_m
> ktrf'
Mkt-RF         0.684      5.321     4.43   1187

. di "SMB         " %8.3f `mean_smb' "   " %8.3f `
> sd_smb' "   " %6.2f `tstat_smb' "   " `n_smb'
SMB            0.164      3.159     1.79   1187

. di "HML         " %8.3f `mean_hml' "   " %8.3f `
> sd_hml' "   " %6.2f `tstat_hml' "   " `n_hml'
HML            0.346      3.559     3.35   1187

. di "RF          " %8.3f `mean_rf' "   " %8.3f `s
> d_rf' "   " %6.2f `tstat_rf' "   " `n_rf'
RF             0.270      0.250    37.22   1187

. di "--------------------------------------------
> ----------"
--------------------------------------------------
> ----

. 
. /*----------------------------------------------
> --------------------------------
>     2. Portfolio Mean Excess Returns (5x5 Matrix
> )
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 2: Mean Excess Returns (% per month)"
Part 2: Mean Excess Returns (% per month)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Rows = Size (1=Small to 5=Big)"
Rows = Size (1=Small to 5=Big)

. di "Cols = Book-to-Market (1=Low/Growth to 5=Hig
> h/Value)"
Cols = Book-to-Market (1=Low/Growth to 5=High/Valu
> e)

. di ""


. 
. * Create matrix for mean returns
. matrix mean_ret = J(5, 5, .)

. 
. // Loop through all portfolio combinations
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         qui sum exret`size'`bm'
  4.         matrix mean_ret[`size', `bm'] = r(mea
> n)
  5.     }
  6. }

. 
. * Display matrix nicely formatted
. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "          (Growth)                          
>      (Value)"
          (Growth)                               (
> Value)

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     // Create size labels - probably could cl
> ean this up but works for now
.     if `size'==1 {
  3.         local size_label = "Small"
  4.     }
  5.     else if `size'==5 {
  6.         local size_label = "Big  "
  7.     }
  8.     else {
  9.         local size_label = "Size`size'"
 10.     }
 11.     di "`size_label'" _col(12) %8.3f mean_ret
> [`size',1] %8.3f mean_ret[`size',2] %8.3f mean_r
> et[`size',3] %8.3f mean_ret[`size',4] %8.3f mean
> _ret[`size',5]
 12. }
Small         0.551   0.645   0.964   1.116   1.33
> 0
Size2         0.633   0.917   0.948   1.026   1.21
> 9
Size3         0.708   0.897   0.908   0.993   1.09
> 5
Size4         0.726   0.772   0.835   0.960   1.02
> 3
Big           0.684   0.645   0.702   0.666   0.94
> 9

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. * Calculate row and column averages - let's see 
> patterns
. di ""


. di "Average by Size (across all B/M):"
Average by Size (across all B/M):

. forvalues size = 1/5 {
  2.     local rowsum = 0
  3.     forvalues bm = 1/5 {
  4.         local rowsum = `rowsum' + mean_ret[`s
> ize', `bm']
  5.     }
  6.     local rowavg = `rowsum' / 5
  7.     if `size'==1 {
  8.         local size_label = "Small"
  9.     }
 10.     else if `size'==5 {
 11.         local size_label = "Big"
 12.     }
 13.     else {
 14.         local size_label = "Size`size'"
 15.     }
 16.     di "  `size_label': " %8.3f `rowavg'
 17. }
  Small:    0.921
  Size2:    0.949
  Size3:    0.920
  Size4:    0.863
  Big:    0.729

. 
. di ""


. di "Average by B/M (across all Size):"
Average by B/M (across all Size):

. forvalues bm = 1/5 {
  2.     local colsum = 0
  3.     forvalues size = 1/5 {
  4.         local colsum = `colsum' + mean_ret[`s
> ize', `bm']
  5.     }
  6.     local colavg = `colsum' / 5
  7.     if `bm'==1 {
  8.         local bm_label = "Low BM"
  9.     }
 10.     else if `bm'==5 {
 11.         local bm_label = "High BM"
 12.     }
 13.     else {
 14.         local bm_label = "BM`bm'"
 15.     }
 16.     di "  `bm_label': " %8.3f `colavg'
 17. }
  Low BM:    0.661
  BM2:    0.775
  BM3:    0.871
  BM4:    0.952
  High BM:    1.123

. 
. /*----------------------------------------------
> --------------------------------
>     3. Portfolio Standard Deviations (5x5 Matrix
> )
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 3: Standard Deviations of Excess Return
> s (% per month)"
Part 3: Standard Deviations of Excess Returns (% p
> er month)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. matrix sd_ret = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         qui sum exret`size'`bm'
  4.         matrix sd_ret[`size', `bm'] = r(sd)
  5.     }
  6. }

. 
. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     if `size'==1 {
  3.         local size_label = "Small"
  4.     }
  5.     else if `size'==5 {
  6.         local size_label = "Big  "
  7.     }
  8.     else {
  9.         local size_label = "Size`size'"
 10.     }
 11.     di "`size_label'" _col(12) %8.3f sd_ret[`
> size',1] %8.3f sd_ret[`size',2] %8.3f sd_ret[`si
> ze',3] %8.3f sd_ret[`size',4] %8.3f sd_ret[`size
> ',5]
 12. }
Small        11.920   9.657   8.852   8.281   9.16
> 9
Size2         7.972   7.482   7.221   7.436   8.67
> 5
Size3         7.355   6.486   6.466   6.937   8.37
> 5
Size4         6.197   6.104   6.301   6.822   8.56
> 3
Big           5.342   5.257   5.580   6.533   8.45
> 8

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     4. t-Statistics for Mean Returns
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 4: t-Statistics for Mean Excess Returns
> "
Part 4: t-Statistics for Mean Excess Returns

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "(Testing H0: mean = 0)"
(Testing H0: mean = 0)

. di ""


. 
. matrix tstat_ret = J(5, 5, .)

. local T = _N  // Total number of observations

. 
. // Computing t-stats for each portfolio
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local tstat = mean_ret[`size', `bm'] 
> / (sd_ret[`size', `bm'] / sqrt(`T'))
  4.         matrix tstat_ret[`size', `bm'] = `tst
> at'
  5.     }
  6. }

. 
. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     if `size'==1 {
  3.         local size_label = "Small"
  4.     }
  5.     else if `size'==5 {
  6.         local size_label = "Big  "
  7.     }
  8.     else {
  9.         local size_label = "Size`size'"
 10.     }
 11.     di "`size_label'" _col(12) %8.2f tstat_re
> t[`size',1] %8.2f tstat_ret[`size',2] %8.2f tsta
> t_ret[`size',3] %8.2f tstat_ret[`size',4] %8.2f 
> tstat_ret[`size',5]
 12. }
Small          1.59    2.30    3.75    4.64    5.0
> 0
Size2          2.74    4.22    4.52    4.75    4.8
> 4
Size3          3.32    4.77    4.84    4.93    4.5
> 0
Size4          4.04    4.36    4.57    4.85    4.1
> 2
Big            4.41    4.23    4.33    3.51    3.8
> 6

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     5. Size and Value Spreads
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 5: Size and Value Spreads"
Part 5: Size and Value Spreads

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. * SMB-like spread: Average Small - Average Big
. * Calculate average for small stocks (size quint
> ile 1)
. local small_avg = (mean_ret[1,1] + mean_ret[1,2]
>  + mean_ret[1,3] + mean_ret[1,4] + mean_ret[1,5]
> ) / 5

. * Calculate average for big stocks (size quintil
> e 5)
. local big_avg = (mean_ret[5,1] + mean_ret[5,2] +
>  mean_ret[5,3] + mean_ret[5,4] + mean_ret[5,5]) 
> / 5

. local size_spread = `small_avg' - `big_avg'

. 
. di "Size Spread (Small - Big):"
Size Spread (Small - Big):

. di "  Average Small portfolio return: " %8.3f `s
> mall_avg'
  Average Small portfolio return:    0.921

. di "  Average Big portfolio return:   " %8.3f `b
> ig_avg'
  Average Big portfolio return:      0.729

. di "  Size spread:                    " %8.3f `s
> ize_spread'
  Size spread:                       0.192

. 
. di ""


. 
. * HML-like spread: Average High BM - Average Low
>  BM
. local highbm_avg = (mean_ret[1,5] + mean_ret[2,5
> ] + mean_ret[3,5] + mean_ret[4,5] + mean_ret[5,5
> ]) / 5

. local lowbm_avg = (mean_ret[1,1] + mean_ret[2,1]
>  + mean_ret[3,1] + mean_ret[4,1] + mean_ret[5,1]
> ) / 5

. local value_spread = `highbm_avg' - `lowbm_avg'

. 
. di "Value Spread (High B/M - Low B/M):"
Value Spread (High B/M - Low B/M):

. di "  Average High B/M portfolio return: " %8.3f
>  `highbm_avg'
  Average High B/M portfolio return:    1.123

. di "  Average Low B/M portfolio return:  " %8.3f
>  `lowbm_avg'
  Average Low B/M portfolio return:     0.661

. di "  Value spread:                      " %8.3f
>  `value_spread'
  Value spread:                         0.463

. 
. /*----------------------------------------------
> --------------------------------
>     6. Factor Correlations
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 6: Factor Correlations"
Part 6: Factor Correlations

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. // Check how factors correlate with each other
. corr mktrf smb hml
(obs=1,187)

             |    mktrf      smb      hml
-------------+---------------------------
       mktrf |   1.0000
         smb |   0.3204   1.0000
         hml |   0.2283   0.1250   1.0000


. 
. /*----------------------------------------------
> --------------------------------
>     7. Export Results to CSV
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Exporting results to CSV..."
Exporting results to CSV...

. di "============================================
> =========================="
==================================================
> ====================

. 
. * Export mean returns matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. // Fill in the values from our matrix
. forvalues size = 1/5 {
  2.     replace lowbm = mean_ret[`size', 1] if si
> ze == `size'
  3.     replace bm2 = mean_ret[`size', 2] if size
>  == `size'
  4.     replace bm3 = mean_ret[`size', 3] if size
>  == `size'
  5.     replace bm4 = mean_ret[`size', 4] if size
>  == `size'
  6.     replace highbm = mean_ret[`size', 5] if s
> ize == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. label define size_lbl 1 "Small" 2 "Size2" 3 "Siz
> e3" 4 "Size4" 5 "Big"

. label values size size_lbl

. 
. export delimited "$root/output/tables/table2_mea
> n_returns.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table2_mean_returns.csv sa
> ved

. restore

. 
. * Export standard deviations matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = sd_ret[`size', 1] if size
>  == `size'
  3.     replace bm2 = sd_ret[`size', 2] if size =
> = `size'
  4.     replace bm3 = sd_ret[`size', 3] if size =
> = `size'
  5.     replace bm4 = sd_ret[`size', 4] if size =
> = `size'
  6.     replace highbm = sd_ret[`size', 5] if siz
> e == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table2_std
> _dev.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table2_std_dev.csv saved

. restore

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "SUMMARY STATISTICS COMPLETE!"
SUMMARY STATISTICS COMPLETE!

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Key Findings:"
Key Findings:

. di "1. Size Effect: Small stocks earn " %5.3f `s
> ize_spread' "% more per month than big stocks"
1. Size Effect: Small stocks earn 0.192% more per 
> month than big stocks

. di "2. Value Effect: High B/M stocks earn " %5.3
> f `value_spread' "% more per month than low B/M"
2. Value Effect: High B/M stocks earn 0.463% more 
> per month than low B/M

. di ""


. di "Output files:"
Output files:

. di "  - $root/output/tables/table2_mean_returns.
> csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table2_mean_returns.csv

. di "  - $root/output/tables/table2_std_dev.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table2_std_dev.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     03_capm_regressions.do
>     
>     Purpose: Replicate Fama-French (1993) Table 
> 4
>              Running CAPM regressions for the 25
>  portfolios
>              
>     Model: R(i,t) - RF(t) = alpha(i) + beta(i) *
>  [RM(t) - RF(t)] + e(i,t)
>     
>     Input:  merged_data.dta
>     Output: CAPM regression results
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. // Load the merged data
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "CAPM REGRESSIONS - Replicating Table 4"
CAPM REGRESSIONS - Replicating Table 4

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Model: Excess Return = alpha + beta * (Mkt-R
> F) + error"
Model: Excess Return = alpha + beta * (Mkt-RF) + e
> rror

. di ""


. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Number of months: " _N
Number of months: 1187

. di "============================================
> =========================="
==================================================
> ====================

. 
. /*----------------------------------------------
> --------------------------------
>     Step 1: Run CAPM Regressions for All 25 Port
> folios
> ------------------------------------------------
> ------------------------------*/
. 
. // Set up matrices to store our results
. matrix alpha_capm = J(5, 5, .)

. matrix beta_capm = J(5, 5, .)

. matrix tstat_alpha = J(5, 5, .)

. matrix tstat_beta = J(5, 5, .)

. matrix rsq_capm = J(5, 5, .)

. matrix se_capm = J(5, 5, .)

. 
. // Run the regressions and store results
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
  4.         
.         // Store the coefficients and stats
.         matrix alpha_capm[`size', `bm'] = _b[_co
> ns]
  5.         matrix beta_capm[`size', `bm'] = _b[m
> ktrf]
  6.         matrix tstat_alpha[`size', `bm'] = _b
> [_cons] / _se[_cons]
  7.         matrix tstat_beta[`size', `bm'] = _b[
> mktrf] / _se[mktrf]
  8.         matrix rsq_capm[`size', `bm'] = e(r2)
  9.         matrix se_capm[`size', `bm'] = e(rmse
> )
 10.     }
 11. }

. 
. /*----------------------------------------------
> --------------------------------
>     Step 2: Show Beta Results
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 1: CAPM Betas"
Part 1: CAPM Betas

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "          (Growth)                          
>      (Value)"
          (Growth)                               (
> Value)

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f beta_cap
> m[`size',1] %8.3f beta_capm[`size',2] %8.3f beta
> _capm[`size',3] %8.3f beta_capm[`size',4] %8.3f 
> beta_capm[`size',5]
  4. }
Small         1.601   1.393   1.359   1.265   1.36
> 1
Size2         1.270   1.232   1.200   1.216   1.37
> 7
Size3         1.245   1.132   1.120   1.171   1.35
> 7
Size4         1.088   1.091   1.103   1.162   1.39
> 1
Big           0.961   0.946   0.967   1.098   1.30
> 0

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 3: Show Alpha Results (This is the key 
> part!)
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 2: CAPM Alphas (Intercepts) - % per mon
> th"
Part 2: CAPM Alphas (Intercepts) - % per month

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "If CAPM works, all alphas should be close to
>  zero."
If CAPM works, all alphas should be close to zero.

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f alpha_ca
> pm[`size',1] %8.3f alpha_capm[`size',2] %8.3f al
> pha_capm[`size',3] %8.3f alpha_capm[`size',4] %8
> .3f alpha_capm[`size',5]
  4. }
Small        -0.545  -0.308   0.034   0.250   0.39
> 9
Size2        -0.236   0.074   0.127   0.194   0.27
> 7
Size3        -0.143   0.123   0.142   0.192   0.16
> 6
Size4        -0.018   0.025   0.081   0.165   0.07
> 1
Big           0.026  -0.002   0.040  -0.085   0.05
> 9

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 4: t-Statistics for the Alphas
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 3: t-Statistics for Alphas"
Part 3: t-Statistics for Alphas

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "(|t| > 1.96 means significant at 5% level)"
(|t| > 1.96 means significant at 5% level)

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.2f tstat_al
> pha[`size',1] %8.2f tstat_alpha[`size',2] %8.2f 
> tstat_alpha[`size',3] %8.2f tstat_alpha[`size',4
> ] %8.2f tstat_alpha[`size',5]
  4. }
Small         -2.23   -1.70    0.23    1.77    2.4
> 2
Size2         -1.90    0.70    1.28    1.81    2.0
> 4
Size3         -1.53    1.74    1.93    2.15    1.3
> 4
Size4         -0.28    0.46    1.20    1.95    0.5
> 7
Big            0.58   -0.04    0.64   -1.00    0.4
> 2

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Count how many alphas are statistically signi
> ficant
. local sig_count = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         if abs(tstat_alpha[`size', `bm']) > 1
> .96 {
  4.             local sig_count = `sig_count' + 1
  5.         }
  6.     }
  7. }

. di ""


. di "Number of significant alphas (|t| > 1.96): `
> sig_count' out of 25"
Number of significant alphas (|t| > 1.96): 4 out o
> f 25

. di "(By pure chance at 5% level, we'd expect abo
> ut 1.25)"
(By pure chance at 5% level, we'd expect about 1.2
> 5)

. 
. /*----------------------------------------------
> --------------------------------
>     Step 5: R-squared Values
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 4: R-squared Values"
Part 4: R-squared Values

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f rsq_capm
> [`size',1] %8.3f rsq_capm[`size',2] %8.3f rsq_ca
> pm[`size',3] %8.3f rsq_capm[`size',4] %8.3f rsq_
> capm[`size',5]
  4. }
Small         0.511   0.589   0.667   0.660   0.62
> 3
Size2         0.718   0.767   0.782   0.757   0.71
> 3
Size3         0.811   0.862   0.849   0.807   0.74
> 3
Size4         0.873   0.905   0.867   0.821   0.74
> 7
Big           0.917   0.916   0.850   0.799   0.66
> 9

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Calculate average R-squared across all portfo
> lios
. local rsq_sum = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local rsq_sum = `rsq_sum' + rsq_capm[
> `size', `bm']
  4.     }
  5. }

. local avg_rsq = `rsq_sum' / 25

. di ""


. di "Average R-squared: " %5.3f `avg_rsq'
Average R-squared: 0.769

. 
. /*----------------------------------------------
> --------------------------------
>     Step 6: Look for Patterns in the Alphas
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 5: Pattern Analysis"
Part 5: Pattern Analysis

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. // Average alpha by size quintile
. di "Average Alpha by Size:"
Average Alpha by Size:

. forvalues size = 1/5 {
  2.     local rowsum = 0
  3.     forvalues bm = 1/5 {
  4.         local rowsum = `rowsum' + alpha_capm[
> `size', `bm']
  5.     }
  6.     local rowavg = `rowsum' / 5
  7.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big", "Size`size'"))
  8.     di "  `size_label': " %8.3f `rowavg' "% p
> er month"
  9. }
  Small:   -0.034% per month
  Size2:    0.087% per month
  Size3:    0.096% per month
  Size4:    0.065% per month
  Big:    0.008% per month

. 
. di ""


. 
. // Average alpha by B/M quintile
. di "Average Alpha by B/M:"
Average Alpha by B/M:

. forvalues bm = 1/5 {
  2.     local colsum = 0
  3.     forvalues size = 1/5 {
  4.         local colsum = `colsum' + alpha_capm[
> `size', `bm']
  5.     }
  6.     local colavg = `colsum' / 5
  7.     local bm_label = cond(`bm'==1, "Low BM", 
> cond(`bm'==5, "High BM", "BM`bm'"))
  8.     di "  `bm_label': " %8.3f `colavg' "% per
>  month"
  9. }
  Low BM:   -0.183% per month
  BM2:   -0.018% per month
  BM3:    0.085% per month
  BM4:    0.143% per month
  High BM:    0.195% per month

. 
. /*----------------------------------------------
> --------------------------------
>     Step 7: Detailed Output for the Corner Portf
> olios
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 6: Detailed Results for Corner Portfoli
> os"
Part 6: Detailed Results for Corner Portfolios

. di "============================================
> =========================="
==================================================
> ====================

. 
. di ""


. di "--- Small/Low BM (p11) ---"
--- Small/Low BM (p11) ---

. regress exret11 mktrf

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(1, 1185)      =   1237.95
       Model |   86097.443         1   86097.443  
>  Prob > F        =    0.0000
    Residual |  82415.0777     1,185  69.5485888  
>  R-squared       =    0.5109
-------------+----------------------------------  
>  Adj R-squared   =    0.5105
       Total |  168512.521     1,186  142.084756  
>  Root MSE        =    8.3396

--------------------------------------------------
> ----------------------------
     exret11 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.601372   .0455136    35.18   0.
> 000                                             
>         1.512076                                
>                     1.690669
       _cons |  -.5445983   .2440523    -2.23   0.
> 026                                             
>        -1.023421                                
>                    -.0657755
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Small/High BM (p15) ---"
--- Small/High BM (p15) ---

. regress exret15 mktrf

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(1, 1185)      =   1961.27
       Model |  62156.1995         1  62156.1995  
>  Prob > F        =    0.0000
    Residual |  37554.7091     1,185  31.6917376  
>  R-squared       =    0.6234
-------------+----------------------------------  
>  Adj R-squared   =    0.6230
       Total |  99710.9086     1,186  84.0732788  
>  Root MSE        =    5.6295

--------------------------------------------------
> ----------------------------
     exret15 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.360628   .0307235    44.29   0.
> 000                                             
>          1.30035                                
>                     1.420907
       _cons |   .3993187   .1647448     2.42   0.
> 016                                             
>         .0760946                                
>                     .7225427
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Big/Low BM (p51) ---"
--- Big/Low BM (p51) ---

. regress exret51 mktrf

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(1, 1185)      =  13019.15
       Model |  31020.1039         1  31020.1039  
>  Prob > F        =    0.0000
    Residual |  2823.44192     1,185  2.38265141  
>  R-squared       =    0.9166
-------------+----------------------------------  
>  Adj R-squared   =    0.9165
       Total |  33843.5458     1,186  28.5358734  
>  Root MSE        =    1.5436

--------------------------------------------------
> ----------------------------
     exret51 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   .9612113   .0084242   114.10   0.
> 000                                             
>         .9446833                                
>                     .9777392
       _cons |   .0263765    .045172     0.58   0.
> 559                                             
>        -.0622494                                
>                     .1150025
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Big/High BM (p55) ---"
--- Big/High BM (p55) ---

. regress exret55 mktrf

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(1, 1185)      =   2392.54
       Model |   56734.649         1   56734.649  
>  Prob > F        =    0.0000
    Residual |  28100.0774     1,185  23.7131455  
>  R-squared       =    0.6688
-------------+----------------------------------  
>  Adj R-squared   =    0.6685
       Total |  84834.7264     1,186  71.5301234  
>  Root MSE        =    4.8696

--------------------------------------------------
> ----------------------------
     exret55 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.299934   .0265761    48.91   0.
> 000                                             
>         1.247793                                
>                     1.352076
       _cons |    .059301   .1425061     0.42   0.
> 677                                             
>        -.2202913                                
>                     .3388933
--------------------------------------------------
> ----------------------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 8: Export the Results
> ------------------------------------------------
> ------------------------------*/
. 
. // Export alpha matrix to CSV
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = alpha_capm[`size', 1] if 
> size == `size'
  3.     replace bm2 = alpha_capm[`size', 2] if si
> ze == `size'
  4.     replace bm3 = alpha_capm[`size', 3] if si
> ze == `size'
  5.     replace bm4 = alpha_capm[`size', 4] if si
> ze == `size'
  6.     replace highbm = alpha_capm[`size', 5] if
>  size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table4_cap
> m_alphas.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table4_capm_alphas.csv sav
> ed

. restore

. 
. // Export R-squared matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = rsq_capm[`size', 1] if si
> ze == `size'
  3.     replace bm2 = rsq_capm[`size', 2] if size
>  == `size'
  4.     replace bm3 = rsq_capm[`size', 3] if size
>  == `size'
  5.     replace bm4 = rsq_capm[`size', 4] if size
>  == `size'
  6.     replace highbm = rsq_capm[`size', 5] if s
> ize == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table4_cap
> m_rsq.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table4_capm_rsq.csv saved

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Step 9: Summary of Findings
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "CAPM REGRESSION SUMMARY"
CAPM REGRESSION SUMMARY

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "KEY FINDING: CAPM FAILS to explain the cross
> -section of returns!"
KEY FINDING: CAPM FAILS to explain the cross-secti
> on of returns!

. di ""


. di "Evidence:"
Evidence:

. di "1. `sig_count' out of 25 alphas are statisti
> cally significant"
1. 4 out of 25 alphas are statistically significan
> t

. di "2. Alphas show systematic patterns:"
2. Alphas show systematic patterns:

. di "   - Small stocks have HIGHER alphas than bi
> g stocks"
   - Small stocks have HIGHER alphas than big stoc
> ks

. di "   - High B/M stocks have HIGHER alphas than
>  low B/M stocks"
   - High B/M stocks have HIGHER alphas than low B
> /M stocks

. di "3. Average R-squared: " %5.3f `avg_rsq' " (m
> arket factor alone isn't enough)"
3. Average R-squared: 0.769 (market factor alone i
> sn't enough)

. di ""


. di "This is why we need additional factors (SMB 
> and HML)!"
This is why we need additional factors (SMB and HM
> L)!

. di ""


. di "Output files saved:"
Output files saved:

. di "  - $root/output/tables/table4_capm_alphas.c
> sv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table4_capm_alphas.csv

. di "  - $root/output/tables/table4_capm_rsq.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table4_capm_rsq.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     04_threefactor_regressions.do
>     
>     Purpose: Replicate Fama-French (1993) Table 
> 6 - THE MAIN RESULT
>              Three-factor regressions for the 25
>  portfolios
>              
>     Model: R(i,t) - RF(t) = alpha(i) + b(i)*MktR
> F(t) + s(i)*SMB(t) + h(i)*HML(t) + e(i,t)
>     
>     Input:  merged_data.dta
>     Output: Three-factor regression results
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. // Load the data
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "THREE-FACTOR REGRESSIONS - Replicating Table
>  6 (THE CORE RESULT)"
THREE-FACTOR REGRESSIONS - Replicating Table 6 (TH
> E CORE RESULT)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Model: Excess Return = alpha + b*MktRF + s*S
> MB + h*HML + error"
Model: Excess Return = alpha + b*MktRF + s*SMB + h
> *HML + error

. di ""


. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Number of months: " _N
Number of months: 1187

. di "============================================
> =========================="
==================================================
> ====================

. 
. /*----------------------------------------------
> --------------------------------
>     Step 1: Run Three-Factor Regressions for All
>  25 Portfolios
> ------------------------------------------------
> ------------------------------*/
. 
. // Set up matrices to hold results
. matrix alpha_ff3 = J(5, 5, .)

. matrix b_mkt = J(5, 5, .)

. matrix s_smb = J(5, 5, .)

. matrix h_hml = J(5, 5, .)

. matrix tstat_alpha_ff3 = J(5, 5, .)

. matrix tstat_b = J(5, 5, .)

. matrix tstat_s = J(5, 5, .)

. matrix tstat_h = J(5, 5, .)

. matrix rsq_ff3 = J(5, 5, .)

. matrix se_ff3 = J(5, 5, .)

. 
. // Run the regressions
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
>  smb hml
  4.         
.         // Store the coefficients
.         matrix alpha_ff3[`size', `bm'] = _b[_con
> s]
  5.         matrix b_mkt[`size', `bm'] = _b[mktrf
> ]
  6.         matrix s_smb[`size', `bm'] = _b[smb]
  7.         matrix h_hml[`size', `bm'] = _b[hml]
  8.         
.         // Store t-stats
.         matrix tstat_alpha_ff3[`size', `bm'] = _
> b[_cons] / _se[_cons]
  9.         matrix tstat_b[`size', `bm'] = _b[mkt
> rf] / _se[mktrf]
 10.         matrix tstat_s[`size', `bm'] = _b[smb
> ] / _se[smb]
 11.         matrix tstat_h[`size', `bm'] = _b[hml
> ] / _se[hml]
 12.         
.         // Store fit stats
.         matrix rsq_ff3[`size', `bm'] = e(r2)
 13.         matrix se_ff3[`size', `bm'] = e(rmse)
 14.     }
 15. }

. 
. /*----------------------------------------------
> --------------------------------
>     Step 2: Show Market Beta Results
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 1: Market Betas (b)"
Part 1: Market Betas (b)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f b_mkt[`s
> ize',1] %8.3f b_mkt[`size',2] %8.3f b_mkt[`size'
> ,3] %8.3f b_mkt[`size',4] %8.3f b_mkt[`size',5]
  4. }
Small         1.267   1.070   1.048   0.942   0.98
> 0
Size2         1.086   1.022   0.990   0.969   1.06
> 6
Size3         1.125   1.018   0.985   0.995   1.11
> 3
Size4         1.075   1.029   1.010   1.035   1.18
> 6
Big           1.031   0.978   0.960   1.033   1.17
> 4

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 3: SMB Loadings (KEY - should go down f
> rom Small to Big)
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 2: SMB Loadings (s) - Size Factor"
Part 2: SMB Loadings (s) - Size Factor

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Expected: Should decrease from Small (positi
> ve) to Big (negative)"
Expected: Should decrease from Small (positive) to
>  Big (negative)

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f s_smb[`s
> ize',1] %8.3f s_smb[`size',2] %8.3f s_smb[`size'
> ,3] %8.3f s_smb[`size',4] %8.3f s_smb[`size',5]
  4. }
Small         1.476   1.531   1.239   1.233   1.28
> 7
Size2         1.151   1.006   0.831   0.828   0.92
> 5
Size3         0.811   0.560   0.451   0.477   0.58
> 9
Size4         0.338   0.242   0.209   0.213   0.31
> 9
Big          -0.149  -0.191  -0.232  -0.181  -0.14
> 1

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Calculate average SMB loading for each size q
> uintile
. di ""


. di "Average SMB Loading by Size:"
Average SMB Loading by Size:

. forvalues size = 1/5 {
  2.     local rowsum = 0
  3.     forvalues bm = 1/5 {
  4.         local rowsum = `rowsum' + s_smb[`size
> ', `bm']
  5.     }
  6.     local rowavg = `rowsum' / 5
  7.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big", "Size`size'"))
  8.     di "  `size_label': " %8.3f `rowavg'
  9. }
  Small:    1.353
  Size2:    0.948
  Size3:    0.577
  Size4:    0.264
  Big:   -0.179

. 
. /*----------------------------------------------
> --------------------------------
>     Step 4: HML Loadings (KEY - should go up fro
> m Low to High BM)
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 3: HML Loadings (h) - Value Factor"
Part 3: HML Loadings (h) - Value Factor

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Expected: Should increase from Low BM (negat
> ive) to High BM (positive)"
Expected: Should increase from Low BM (negative) t
> o High BM (positive)

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f h_hml[`s
> ize',1] %8.3f h_hml[`size',2] %8.3f h_hml[`size'
> ,3] %8.3f h_hml[`size',4] %8.3f h_hml[`size',5]
  4. }
Small         0.354   0.206   0.495   0.575   0.88
> 9
Size2        -0.230   0.118   0.344   0.583   0.88
> 4
Size3        -0.220   0.046   0.321   0.561   0.86
> 4
Size4        -0.331   0.106   0.347   0.565   0.94
> 5
Big          -0.269   0.025   0.330   0.654   0.99
> 8

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Average HML loading for each B/M quintile
. di ""


. di "Average HML Loading by B/M:"
Average HML Loading by B/M:

. forvalues bm = 1/5 {
  2.     local colsum = 0
  3.     forvalues size = 1/5 {
  4.         local colsum = `colsum' + h_hml[`size
> ', `bm']
  5.     }
  6.     local colavg = `colsum' / 5
  7.     local bm_label = cond(`bm'==1, "Low BM", 
> cond(`bm'==5, "High BM", "BM`bm'"))
  8.     di "  `bm_label': " %8.3f `colavg'
  9. }
  Low BM:   -0.139
  BM2:    0.100
  BM3:    0.367
  BM4:    0.587
  High BM:    0.916

. 
. /*----------------------------------------------
> --------------------------------
>     Step 5: Alpha Results (KEY - these should be
>  near ZERO)
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 4: Three-Factor Alphas (% per month)"
Part 4: Three-Factor Alphas (% per month)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "If the three-factor model works, ALL alphas 
> should be close to ZERO."
If the three-factor model works, ALL alphas should
>  be close to ZERO.

. di "(Remember CAPM alphas showed systematic patt
> erns)"
(Remember CAPM alphas showed systematic patterns)

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f alpha_ff
> 3[`size',1] %8.3f alpha_ff3[`size',2] %8.3f alph
> a_ff3[`size',3] %8.3f alpha_ff3[`size',4] %8.3f 
> alpha_ff3[`size',5]
  4. }
Small        -0.680  -0.409  -0.127   0.070   0.14
> 1
Size2        -0.219   0.011   0.016   0.026   0.03
> 2
Size3        -0.117   0.093   0.049   0.040  -0.06
> 3
Size4         0.050  -0.008  -0.010   0.021  -0.16
> 8
Big           0.096  -0.001  -0.032  -0.237  -0.17
> 7

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 6: t-Statistics for Alphas
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 5: t-Statistics for Alphas"
Part 5: t-Statistics for Alphas

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "(|t| > 1.96 means significant at 5% level)"
(|t| > 1.96 means significant at 5% level)

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.2f tstat_al
> pha_ff3[`size',1] %8.2f tstat_alpha_ff3[`size',2
> ] %8.2f tstat_alpha_ff3[`size',3] %8.2f tstat_al
> pha_ff3[`size',4] %8.2f tstat_alpha_ff3[`size',5
> ]
  4. }
Small         -3.35   -3.43   -1.47    1.07    1.9
> 6
Size2         -3.12    0.20    0.29    0.53    0.5
> 8
Size3         -2.01    1.84    0.95    0.77   -0.9
> 2
Size4          1.05   -0.17   -0.19    0.36   -2.2
> 3
Big            2.92   -0.03   -0.62   -4.47   -1.7
> 7

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Count how many are statistically significant
. local sig_count_ff3 = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         if abs(tstat_alpha_ff3[`size', `bm'])
>  > 1.96 {
  4.             local sig_count_ff3 = `sig_count_
> ff3' + 1
  5.         }
  6.     }
  7. }

. di ""


. di "Number of significant alphas (|t| > 1.96): `
> sig_count_ff3' out of 25"
Number of significant alphas (|t| > 1.96): 7 out o
> f 25

. di "(By chance at 5% level, we'd expect about 1.
> 25)"
(By chance at 5% level, we'd expect about 1.25)

. 
. /*----------------------------------------------
> --------------------------------
>     Step 7: R-squared Values
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 6: R-squared Values"
Part 6: R-squared Values

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f rsq_ff3[
> `size',1] %8.3f rsq_ff3[`size',2] %8.3f rsq_ff3[
> `size',3] %8.3f rsq_ff3[`size',4] %8.3f rsq_ff3[
> `size',5]
  4. }
Small         0.663   0.823   0.889   0.929   0.92
> 9
Size2         0.910   0.934   0.934   0.952   0.95
> 2
Size3         0.927   0.930   0.927   0.934   0.92
> 4
Size4         0.931   0.923   0.916   0.915   0.91
> 0
Big           0.956   0.928   0.905   0.923   0.83
> 6

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Average R-squared
. local rsq_sum_ff3 = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local rsq_sum_ff3 = `rsq_sum_ff3' + r
> sq_ff3[`size', `bm']
  4.     }
  5. }

. local avg_rsq_ff3 = `rsq_sum_ff3' / 25

. di ""


. di "Average R-squared: " %5.3f `avg_rsq_ff3'
Average R-squared: 0.908

. 
. /*----------------------------------------------
> --------------------------------
>     Step 8: Detailed Output for Corner Portfolio
> s
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 7: Detailed Results for Corner Portfoli
> os"
Part 7: Detailed Results for Corner Portfolios

. di "============================================
> =========================="
==================================================
> ====================

. 
. di ""


. di "--- Small/Low BM (p11) ---"
--- Small/Low BM (p11) ---

. regress exret11 mktrf smb hml

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(3, 1183)      =    776.17
       Model |  111742.146         3   37247.382  
>  Prob > F        =    0.0000
    Residual |  56770.3748     1,183  47.9884825  
>  R-squared       =    0.6631
-------------+----------------------------------  
>  Adj R-squared   =    0.6623
       Total |  168512.521     1,186  142.084756  
>  Root MSE        =    6.9274

--------------------------------------------------
> ----------------------------
     exret11 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.266567   .0407358    31.09   0.
> 000                                             
>         1.186645                                
>                      1.34649
         smb |   1.476215   .0673316    21.92   0.
> 000                                             
>         1.344113                                
>                     1.608318
         hml |   .3537924    .058144     6.08   0.
> 000                                             
>         .2397156                                
>                     .4678692
       _cons |  -.6798432    .203216    -3.35   0.
> 001                                             
>        -1.078547                                
>                    -.2811392
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Small/High BM (p15) ---"
--- Small/High BM (p15) ---

. regress exret15 mktrf smb hml

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(3, 1183)      =   5136.32
       Model |  92601.5602         3  30867.1867  
>  Prob > F        =    0.0000
    Residual |  7109.34837     1,183  6.00959287  
>  R-squared       =    0.9287
-------------+----------------------------------  
>  Adj R-squared   =    0.9285
       Total |  99710.9086     1,186  84.0732788  
>  Root MSE        =    2.4514

--------------------------------------------------
> ----------------------------
     exret15 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   .9799396   .0144155    67.98   0.
> 000                                             
>         .9516567                                
>                     1.008222
         smb |   1.287319   .0238272    54.03   0.
> 000                                             
>         1.240571                                
>                     1.334068
         hml |   .8894556   .0205759    43.23   0.
> 000                                             
>         .8490863                                
>                      .929825
       _cons |   .1408692   .0719137     1.96   0.
> 050                                             
>        -.0002235                                
>                     .2819619
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Big/Low BM (p51) ---"
--- Big/Low BM (p51) ---

. regress exret51 mktrf smb hml

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(3, 1183)      =   8506.11
       Model |  32344.1106         3  10781.3702  
>  Prob > F        =    0.0000
    Residual |  1499.43518     1,183  1.26748536  
>  R-squared       =    0.9557
-------------+----------------------------------  
>  Adj R-squared   =    0.9556
       Total |  33843.5458     1,186  28.5358734  
>  Root MSE        =    1.1258

--------------------------------------------------
> ----------------------------
     exret51 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.030738   .0066203   155.69   0.
> 000                                             
>         1.017749                                
>                     1.043727
         smb |  -.1494581   .0109426   -13.66   0.
> 000                                             
>        -.1709273                                
>                     -.127989
         hml |  -.2691066   .0094495   -28.48   0.
> 000                                             
>        -.2876462                                
>                     -.250567
       _cons |   .0964944   .0330264     2.92   0.
> 004                                             
>         .0316976                                
>                     .1612912
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Big/High BM (p55) ---"
--- Big/High BM (p55) ---

. regress exret55 mktrf smb hml

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(3, 1183)      =   2014.17
       Model |  70945.1126         3  23648.3709  
>  Prob > F        =    0.0000
    Residual |  13889.6138     1,183  11.7410091  
>  R-squared       =    0.8363
-------------+----------------------------------  
>  Adj R-squared   =    0.8359
       Total |  84834.7264     1,186  71.5301234  
>  Root MSE        =    3.4265

--------------------------------------------------
> ----------------------------
     exret55 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.174329   .0201493    58.28   0.
> 000                                             
>         1.134797                                
>                     1.213862
         smb |     -.1413   .0333045    -4.24   0.
> 000                                             
>        -.2066425                                
>                    -.0759574
         hml |   .9983735     .02876    34.71   0.
> 000                                             
>         .9419472                                
>                       1.0548
       _cons |  -.1774208   .1005176    -1.77   0.
> 078                                             
>        -.3746334                                
>                     .0197918
--------------------------------------------------
> ----------------------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 9: Compare CAPM vs Three-Factor Model
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 8: CAPM vs Three-Factor Model Compariso
> n"
Part 8: CAPM vs Three-Factor Model Comparison

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. // Re-run CAPM for comparison
. matrix alpha_capm = J(5, 5, .)

. matrix rsq_capm = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
  4.         matrix alpha_capm[`size', `bm'] = _b[
> _cons]
  5.         matrix rsq_capm[`size', `bm'] = e(r2)
  6.     }
  7. }

. 
. // Calculate average R-squared for CAPM
. local rsq_sum_capm = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local rsq_sum_capm = `rsq_sum_capm' +
>  rsq_capm[`size', `bm']
  4.     }
  5. }

. local avg_rsq_capm = `rsq_sum_capm' / 25

. 
. // Calculate sum of squared alphas (measure of p
> ricing errors)
. local ssa_capm = 0

. local ssa_ff3 = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local ssa_capm = `ssa_capm' + (alpha_
> capm[`size', `bm'])^2
  4.         local ssa_ff3 = `ssa_ff3' + (alpha_ff
> 3[`size', `bm'])^2
  5.     }
  6. }

. 
. di "                              CAPM      Thre
> e-Factor"
                              CAPM      Three-Fact
> or

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di "Average R-squared:         " %7.3f `avg_rsq_
> capm' "      " %7.3f `avg_rsq_ff3'
Average R-squared:           0.769        0.908

. di "Sum of Squared Alphas:     " %7.3f `ssa_capm
> ' "      " %7.3f `ssa_ff3'
Sum of Squared Alphas:       0.980        0.880

. di "Significant Alphas:            4            
> `sig_count_ff3'"
Significant Alphas:            4            7

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di ""


. di "Improvement in R-squared: " %5.1f (`avg_rsq_
> ff3' - `avg_rsq_capm')*100 " percentage points"
Improvement in R-squared:  13.9 percentage points

. di "Reduction in SSA:         " %5.1f (1 - `ssa_
> ff3'/`ssa_capm')*100 "%"
Reduction in SSA:          10.1%

. 
. /*----------------------------------------------
> --------------------------------
>     Step 10: Export the Results
> ------------------------------------------------
> ------------------------------*/
. 
. // Export alphas
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = alpha_ff3[`size', 1] if s
> ize == `size'
  3.     replace bm2 = alpha_ff3[`size', 2] if siz
> e == `size'
  4.     replace bm3 = alpha_ff3[`size', 3] if siz
> e == `size'
  5.     replace bm4 = alpha_ff3[`size', 4] if siz
> e == `size'
  6.     replace highbm = alpha_ff3[`size', 5] if 
> size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_ff3
> _alphas.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table6_ff3_alphas.csv save
> d

. restore

. 
. // Export SMB loadings
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = s_smb[`size', 1] if size 
> == `size'
  3.     replace bm2 = s_smb[`size', 2] if size ==
>  `size'
  4.     replace bm3 = s_smb[`size', 3] if size ==
>  `size'
  5.     replace bm4 = s_smb[`size', 4] if size ==
>  `size'
  6.     replace highbm = s_smb[`size', 5] if size
>  == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_smb
> _loadings.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table6_smb_loadings.csv sa
> ved

. restore

. 
. // Export HML loadings
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = h_hml[`size', 1] if size 
> == `size'
  3.     replace bm2 = h_hml[`size', 2] if size ==
>  `size'
  4.     replace bm3 = h_hml[`size', 3] if size ==
>  `size'
  5.     replace bm4 = h_hml[`size', 4] if size ==
>  `size'
  6.     replace highbm = h_hml[`size', 5] if size
>  == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_hml
> _loadings.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table6_hml_loadings.csv sa
> ved

. restore

. 
. // Export R-squared
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = rsq_ff3[`size', 1] if siz
> e == `size'
  3.     replace bm2 = rsq_ff3[`size', 2] if size 
> == `size'
  4.     replace bm3 = rsq_ff3[`size', 3] if size 
> == `size'
  5.     replace bm4 = rsq_ff3[`size', 4] if size 
> == `size'
  6.     replace highbm = rsq_ff3[`size', 5] if si
> ze == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_ff3
> _rsq.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table6_ff3_rsq.csv saved

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Step 11: Final Summary
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "THREE-FACTOR MODEL SUMMARY - THE KEY FINDING
> S"
THREE-FACTOR MODEL SUMMARY - THE KEY FINDINGS

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "1. SMB LOADINGS:"
1. SMB LOADINGS:

. di "   - Small stocks: HIGH positive loadings (a
> round 1.4)"
   - Small stocks: HIGH positive loadings (around 
> 1.4)

. di "   - Big stocks: LOW or negative loadings (a
> round -0.1)"
   - Big stocks: LOW or negative loadings (around 
> -0.1)

. di "   -> SMB captures the SIZE effect"
   -> SMB captures the SIZE effect

. di ""


. di "2. HML LOADINGS:"
2. HML LOADINGS:

. di "   - Low B/M (Growth): NEGATIVE loadings"
   - Low B/M (Growth): NEGATIVE loadings

. di "   - High B/M (Value): POSITIVE loadings"
   - High B/M (Value): POSITIVE loadings

. di "   -> HML captures the VALUE effect"
   -> HML captures the VALUE effect

. di ""


. di "3. ALPHAS:"
3. ALPHAS:

. di "   - Only `sig_count_ff3' significant (vs 4 
> in CAPM)"
   - Only 7 significant (vs 4 in CAPM)

. di "   - No systematic pattern anymore (unlike C
> APM)"
   - No systematic pattern anymore (unlike CAPM)

. di "   -> The three-factor model WORKS!"
   -> The three-factor model WORKS!

. di ""


. di "4. R-SQUARED:"
4. R-SQUARED:

. di "   - Average: " %5.3f `avg_rsq_ff3' " (compa
> red to " %5.3f `avg_rsq_capm' " for CAPM)"
   - Average: 0.908 (compared to 0.769 for CAPM)

. di "   -> Three factors do a better job explaini
> ng returns"
   -> Three factors do a better job explaining ret
> urns

. di ""


. di "CONCLUSION: The Fama-French three-factor mod
> el successfully explains"
CONCLUSION: The Fama-French three-factor model suc
> cessfully explains

. di "            the cross-section of stock retur
> ns!"
            the cross-section of stock returns!

. di ""


. di "Output files saved:"
Output files saved:

. di "  - $root/output/tables/table6_ff3_alphas.cs
> v"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table6_ff3_alphas.csv

. di "  - $root/output/tables/table6_smb_loadings.
> csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table6_smb_loadings.csv

. di "  - $root/output/tables/table6_hml_loadings.
> csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table6_hml_loadings.csv

. di "  - $root/output/tables/table6_ff3_rsq.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table6_ff3_rsq.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     05_grs_test.do 
>     
>     Purpose: Replicate Fama-French (1993) Table 
> 9c
>              GRS Test (Gibbons, Ross, Shanken 19
> 89)
>              
>     Test: H0: All 25 intercepts (alphas) are joi
> ntly equal to zero
>     
>     Author: Pei-Chin
>     Date: Started spring 2024, debugged like cra
> zy in summer
>     
>     Input:  merged_data.dta
>     Output: GRS test results (hoping to match pu
> blished Table 9c!)
>     
>     Notes: The GRS calculation was a pain - had 
> to read the original 1989 paper
>            like 5 times to get the denominator r
> ight. Pretty sure it's correct now.
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. * Load the merged dataset
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "GRS TEST - Replicating Fama-French (1993) Ta
> ble 9c"
GRS TEST - Replicating Fama-French (1993) Table 9c

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Gibbons, Ross, and Shanken (1989) Joint Test
>  of Pricing Errors"
Gibbons, Ross, and Shanken (1989) Joint Test of Pr
> icing Errors

. di "Null Hypothesis: All portfolio alphas are jo
> intly equal to zero"
Null Hypothesis: All portfolio alphas are jointly 
> equal to zero

. di ""


. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Number of months (T): " _N
Number of months (T): 1187

. di "Number of portfolios (N): 25"
Number of portfolios (N): 25

. di "============================================
> =========================="
==================================================
> ====================

. 
. // Store sample size - we'll use this a lot
. local T = _N

. local num_portfolios = 25

. 
. /*----------------------------------------------
> --------------------------------
>     PART 1: GRS Test for CAPM (Single Factor Mod
> el)
>     
>     The CAPM says all you need is beta. Let's se
> e if that holds up...
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "TEST 1: CAPM (Market Factor Only)"
TEST 1: CAPM (Market Factor Only)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. local K_capm = 1  // number of factors

. 
. * Step 1: Run 25 separate regressions and grab t
> he alphas
. di "Running 25 CAPM regressions (this takes a se
> c)..."
Running 25 CAPM regressions (this takes a sec)...

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
  4.         quietly predict resid_capm_`size'`bm'
> , residuals
  5.         
.         // Store the intercept (alpha) and its s
> tandard error
.         local alpha_capm_`size'`bm' = _b[_cons]
  6.         local se_alpha_capm_`size'`bm' = _se[
> _cons]
  7.     }
  8. }

. 
. * Step 2: Put all the alphas into a vector (Nx1 
> matrix)
. matrix alpha_capm = J(25, 1, .)

. local counter = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         matrix alpha_capm[`counter', 1] = `al
> pha_capm_`size'`bm''
  4.         local counter = `counter' + 1
  5.     }
  6. }

. 
. * Step 3: Calculate the covariance matrix of res
> iduals (Sigma)
. // This is the tricky part - need all 25 residua
> l series
. local all_resids ""

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local all_resids "`all_resids' resid_
> capm_`size'`bm'"
  4.     }
  5. }

. 
. quietly correlate `all_resids', covariance

. matrix Sigma_capm = r(C)

. 
. * Step 4: Factor statistics (just market for CAP
> M)
. quietly summarize mktrf

. local mean_mktrf = r(mean)

. local variance_mktrf = r(Var)

. 
. * Step 5: Calculate the GRS F-statistic
. // Formula: GRS = (T/N) * ((T-N-K)/(T-K-1)) * (a
> lpha' * Sigma^-1 * alpha) / (1 + mu'*Omega^-1*mu
> )
. // For single factor, denominator simplifies to:
>  1 + (mean^2 / variance)
. 
. matrix Sigma_capm_inv = invsym(Sigma_capm)

. matrix quad_form_capm = alpha_capm' * Sigma_capm
> _inv * alpha_capm

. local numerator_part = quad_form_capm[1,1]

. 
. // Sharpe ratio squared (for single factor case)
. local sharpe_ratio_sq = (`mean_mktrf'^2) / `vari
> ance_mktrf'

. local denominator = 1 + `sharpe_ratio_sq'

. 
. // Put it all together
. local df_numerator = `num_portfolios'

. local df_denominator = `T' - `num_portfolios' - 
> `K_capm'

. local grs_capm = (`T' / `num_portfolios') * (`df
> _denominator' / (`T' - `K_capm' - 1)) * (`numera
> tor_part' / `denominator')

. 
. // Get p-value from F-distribution
. local pval_capm = Ftail(`df_numerator', `df_deno
> minator', `grs_capm')

. 
. di "CAPM Results:"
CAPM Results:

. di "  GRS F-statistic: " %10.4f `grs_capm'
  GRS F-statistic:     3.3403

. di "  Degrees of freedom: (" `df_numerator' ", "
>  `df_denominator' ")"
  Degrees of freedom: (25, 1161)

. di "  P-value: " %10.6f `pval_capm'
  P-value:   0.000000

. di ""


. 
. if `pval_capm' < 0.05 {
.     di "  ==> REJECT H0 at 5% level"
  ==> REJECT H0 at 5% level
.     di "      The CAPM alphas are jointly signif
> icantly different from zero"
      The CAPM alphas are jointly significantly di
> fferent from zero
.     di "      (Not surprising - CAPM is too simp
> le)"
      (Not surprising - CAPM is too simple)
. }

. else {
.     di "  ==> FAIL TO REJECT H0 at 5% level"
.     di "      (Would be shocking if CAPM actuall
> y worked this well!)"
. }

. 
. // Clean up the workspace - don't need these res
> iduals anymore
. drop resid_capm_*

. 
. /*----------------------------------------------
> --------------------------------
>     PART 2: GRS Test for Fama-French Three-Facto
> r Model
>     
>     Now let's see if adding SMB and HML helps ex
> plain the cross-section better
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "TEST 2: Fama-French Three-Factor Model (MKT 
> + SMB + HML)"
TEST 2: Fama-French Three-Factor Model (MKT + SMB 
> + HML)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. local K_ff3 = 3  // three factors now

. 
. * Step 1: Run 25 three-factor regressions
. di "Running 25 three-factor regressions..."
Running 25 three-factor regressions...

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
>  smb hml
  4.         quietly predict resid_ff3_`size'`bm',
>  residuals
  5.         local alpha_ff3_`size'`bm' = _b[_cons
> ]
  6.     }
  7. }

. 
. * Step 2: Alpha vector for three-factor model
. matrix alpha_ff3 = J(25, 1, .)

. local counter = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         matrix alpha_ff3[`counter', 1] = `alp
> ha_ff3_`size'`bm''
  4.         local counter = `counter' + 1
  5.     }
  6. }

. 
. * Step 3: Residual covariance matrix
. local all_resids_ff3 ""

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local all_resids_ff3 "`all_resids_ff3
> ' resid_ff3_`size'`bm'"
  4.     }
  5. }

. 
. quietly correlate `all_resids_ff3', covariance

. matrix Sigma_ff3 = r(C)

. 
. * Step 4: Factor statistics (now we have 3 facto
> rs)
. quietly summarize mktrf

. local mu_mkt = r(mean)

. quietly summarize smb

. local mu_smb = r(mean)

. quietly summarize hml  

. local mu_hml = r(mean)

. 
. // Put means into a vector
. matrix mu_vec = (`mu_mkt' \ `mu_smb' \ `mu_hml')

. 
. // Factor covariance matrix (Omega in GRS paper)
. quietly correlate mktrf smb hml, covariance

. matrix Omega = r(C)

. 
. * Step 5: Calculate GRS for three-factor model
. matrix Sigma_ff3_inv = invsym(Sigma_ff3)

. matrix quad_alpha = alpha_ff3' * Sigma_ff3_inv *
>  alpha_ff3

. local numerator_ff3 = quad_alpha[1,1]

. 
. // Multi-factor Sharpe ratio: mu' * Omega^-1 * m
> u
. matrix Omega_inv = invsym(Omega)

. matrix sharpe_quad_ff3 = mu_vec' * Omega_inv * m
> u_vec

. local sharpe_sq_ff3 = sharpe_quad_ff3[1,1]

. local denominator_ff3 = 1 + `sharpe_sq_ff3'

. 
. // GRS statistic
. local df_denom_ff3 = `T' - `num_portfolios' - `K
> _ff3'

. local grs_ff3 = (`T' / `num_portfolios') * (`df_
> denom_ff3' / (`T' - `K_ff3' - 1)) * (`numerator_
> ff3' / `denominator_ff3')

. 
. // P-value
. local pval_ff3 = Ftail(`df_numerator', `df_denom
> _ff3', `grs_ff3')

. 
. di "Three-Factor Model Results:"
Three-Factor Model Results:

. di "  GRS F-statistic: " %10.4f `grs_ff3'
  GRS F-statistic:     3.3140

. di "  Degrees of freedom: (" `df_numerator' ", "
>  `df_denom_ff3' ")"
  Degrees of freedom: (25, 1159)

. di "  P-value: " %10.6f `pval_ff3'
  P-value:   0.000000

. di ""


. 
. if `pval_ff3' < 0.05 {
.     di "  ==> REJECT H0 at 5% level"
  ==> REJECT H0 at 5% level
.     di "      Still some pricing errors left (bu
> t much better than CAPM)"
      Still some pricing errors left (but much bet
> ter than CAPM)
. }

. else {
.     di "  ==> FAIL TO REJECT H0 at 5% level"
.     di "      Three-factor model does a good job
>  pricing these 25 portfolios!"
. }

. 
. // Clean up
. drop resid_ff3_*

. 
. /*----------------------------------------------
> --------------------------------
>     PART 3: Additional Diagnostics
>     
>     Let's look at some other metrics to see how 
> much the 3-factor model helps
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "ADDITIONAL DIAGNOSTICS"
ADDITIONAL DIAGNOSTICS

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. * Calculate average absolute alpha (intuitive me
> asure of pricing errors)
. local sum_abs_alpha_capm = 0

. local sum_abs_alpha_ff3 = 0

. 
. forvalues i = 1/25 {
  2.     local sum_abs_alpha_capm = `sum_abs_alpha
> _capm' + abs(alpha_capm[`i', 1])
  3.     local sum_abs_alpha_ff3 = `sum_abs_alpha_
> ff3' + abs(alpha_ff3[`i', 1])
  4. }

. 
. local avg_abs_alpha_capm = `sum_abs_alpha_capm' 
> / 25

. local avg_abs_alpha_ff3 = `sum_abs_alpha_ff3' / 
> 25

. 
. * Sum of squared alphas (another common metric)
. local sum_sq_alpha_capm = 0

. local sum_sq_alpha_ff3 = 0

. 
. forvalues i = 1/25 {
  2.     local sum_sq_alpha_capm = `sum_sq_alpha_c
> apm' + (alpha_capm[`i', 1])^2
  3.     local sum_sq_alpha_ff3 = `sum_sq_alpha_ff
> 3' + (alpha_ff3[`i', 1])^2
  4. }

. 
. // Display comparison table
. di "                                    CAPM    
>   Three-Factor"
                                    CAPM      Thre
> e-Factor

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di "Average |alpha| (% per month):   " %8.4f `av
> g_abs_alpha_capm' "     " %8.4f `avg_abs_alpha_f
> f3'
Average |alpha| (% per month):     0.1514       0.
> 1158

. di "Sum of Squared Alphas:           " %8.4f `su
> m_sq_alpha_capm' "     " %8.4f `sum_sq_alpha_ff3
> '
Sum of Squared Alphas:             0.9797       0.
> 8805

. di "GRS F-statistic:                 " %8.4f `gr
> s_capm' "     " %8.4f `grs_ff3'
GRS F-statistic:                   3.3403       3.
> 3140

. di "GRS p-value:                     " %8.6f `pv
> al_capm' "   " %8.6f `pval_ff3'
GRS p-value:                     0.000000   0.0000
> 00

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     PART 4: How Much Improvement?
>     
>     Calculate percentage reductions in pricing e
> rrors
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "MODEL IMPROVEMENT METRICS"
MODEL IMPROVEMENT METRICS

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. local improvement_grs = (1 - `grs_ff3'/`grs_capm
> ') * 100

. local improvement_ssa = (1 - `sum_sq_alpha_ff3'/
> `sum_sq_alpha_capm') * 100

. local improvement_avg = (1 - `avg_abs_alpha_ff3'
> /`avg_abs_alpha_capm') * 100

. 
. di "Going from CAPM to Three-Factor Model:"
Going from CAPM to Three-Factor Model:

. di "  - GRS F-statistic drops by: " %5.1f `impro
> vement_grs' "%"
  - GRS F-statistic drops by:   0.8%

. di "  - Sum of Squared Alphas drops by: " %5.1f 
> `improvement_ssa' "%"
  - Sum of Squared Alphas drops by:  10.1%

. di "  - Average |alpha| drops by: " %5.1f `impro
> vement_avg' "%"
  - Average |alpha| drops by:  23.5%

. di ""


. di "(Basically, SMB and HML do a lot of heavy li
> fting!)"
(Basically, SMB and HML do a lot of heavy lifting!
> )

. 
. /*----------------------------------------------
> --------------------------------
>     PART 5: Save Results to CSV
>     
>     Export for LaTeX table later
> ------------------------------------------------
> ------------------------------*/
. 
. preserve

. 
. clear

. set obs 2
Number of observations (_N) was 0, now 2.

. 
. gen str30 model = ""
(2 missing values generated)

. gen grs_fstat = .
(2 missing values generated)

. gen df_num = .
(2 missing values generated)

. gen df_denom = .
(2 missing values generated)

. gen p_value = .
(2 missing values generated)

. gen avg_abs_alpha = .
(2 missing values generated)

. gen sum_sq_alpha = .
(2 missing values generated)

. 
. // Row 1: CAPM results
. replace model = "CAPM" in 1
(1 real change made)

. replace grs_fstat = `grs_capm' in 1
(1 real change made)

. replace df_num = `df_numerator' in 1
(1 real change made)

. replace df_denom = `df_denominator' in 1
(1 real change made)

. replace p_value = `pval_capm' in 1
(1 real change made)

. replace avg_abs_alpha = `avg_abs_alpha_capm' in 
> 1
(1 real change made)

. replace sum_sq_alpha = `sum_sq_alpha_capm' in 1
(1 real change made)

. 
. // Row 2: Three-factor results
. replace model = "Three-Factor" in 2
(1 real change made)

. replace grs_fstat = `grs_ff3' in 2
(1 real change made)

. replace df_num = `df_numerator' in 2
(1 real change made)

. replace df_denom = `df_denom_ff3' in 2
(1 real change made)

. replace p_value = `pval_ff3' in 2
(1 real change made)

. replace avg_abs_alpha = `avg_abs_alpha_ff3' in 2
(1 real change made)

. replace sum_sq_alpha = `sum_sq_alpha_ff3' in 2
(1 real change made)

. 
. export delimited "$root/output/tables/table9c_gr
> s_test.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table9c_grs_test.csv saved

. 
. restore

. 
. /*----------------------------------------------
> --------------------------------
>     FINAL SUMMARY
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "GRS TEST SUMMARY - FINAL VERDICT"
GRS TEST SUMMARY - FINAL VERDICT

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "The GRS test checks whether all 25 portfolio
>  alphas are jointly zero."
The GRS test checks whether all 25 portfolio alpha
> s are jointly zero.

. di "If we reject, it means the model leaves syst
> ematic pricing errors."
If we reject, it means the model leaves systematic
>  pricing errors.

. di ""


. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di "Model             GRS F-stat    p-value     
>  Decision"
Model             GRS F-stat    p-value      Decis
> ion

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di "CAPM              " %8.2f `grs_capm' "     "
>  %8.6f `pval_capm' "   " cond(`pval_capm'<0.05, 
> "REJECT H0", "FAIL TO REJECT")
CAPM                  3.34     0.000000   REJECT H
> 0

. di "Three-Factor      " %8.2f `grs_ff3' "     " 
> %8.6f `pval_ff3' "   " cond(`pval_ff3'<0.05, "RE
> JECT H0", "FAIL TO REJECT")
Three-Factor          3.31     0.000000   REJECT H
> 0

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di ""


. di "Bottom Line:"
Bottom Line:

. di "  - GRS F drops by " %4.1f `improvement_grs'
>  "% (from " %5.2f `grs_capm' " to " %5.2f `grs_f
> f3' ")"
  - GRS F drops by  0.8% (from  3.34 to  3.31)

. di "  - Three-factor model is a MAJOR improvemen
> t over CAPM"
  - Three-factor model is a MAJOR improvement over
>  CAPM

. di "  - SMB and HML capture size and value effec
> ts that CAPM misses"
  - SMB and HML capture size and value effects tha
> t CAPM misses

. di ""


. di "Output saved to: $root/output/tables/table9c
> _grs_test.csv"
Output saved to: /Users/pei-chin/Research/FamaFren
> ch_1993_Replication/output/tables/table9c_grs_te
> st.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
. /*
> POST-RUN NOTES:
> 
> 1. The GRS formula was the hardest part of this 
> whole project. Had to check
>    against several sources to make sure I got it
>  right:
>    - Gibbons, Ross, Shanken (1989) original pape
> r
>    - Cochrane (2005) Asset Pricing textbook
>    - Some random guy's replication code on GitHu
> b
>    
> 2. Things to double-check:
>    - Are the degrees of freedom correct? (Pretty
>  sure they are)
>    - Should I be using robust standard errors so
> mewhere? (Don't think so for GRS)
>    - Is the factor covariance matrix properly sp
> ecified? (Looks good)
> 
> 3. If the results don't match Table 9c exactly, 
> could be:
>    - Different sample period (check date range)
>    - Different portfolio construction (check 05_
> portfolios.do)
>    - Rounding differences (probably fine)
>    
> 4. TODO: Maybe add a plot showing individual alp
> has for CAPM vs FF3?
>    Would be nice to visualize which portfolios h
> ave the biggest improvements.

end of do-file

. clear all

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     00_check_data_structure.do 
>     
>     Purpose: Quick diagnostic check of CSV file 
> structure before importing
>     
>     NOTE: Run this first to see what we're deali
> ng with!
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. // Setting up the main project folder path
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. /*----------------------------------------------
> --------------------------------
>     Part 1: Checking the 25 Portfolios File
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "NOW CHECKING: 25_Portfolios_5x5.csv"
NOW CHECKING: 25_Portfolios_5x5.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
. // Import everything as strings first - easier t
> o see what's going on
. import delimited "$root/data/raw/25_Portfolios_5
> x5.csv", clear stringcols(_all) varnames(nonames
> )
(encoding automatically selected: ISO-8859-1)
(26 vars, 8,895 obs)

. 
. // Let's see what variables we got
. describe, short

Contains data
 Observations:         8,895                  
    Variables:            26                  
Sorted by: 
     Note: Dataset has changed since last saved.

. 
. // Display the first bunch of rows so we can eye
> ball the structure
. di ""


. di "Here are the first 20 rows:"
Here are the first 20 rows:

. list v1 v2 v3 v4 v5 in 1/20, clean noobs

                                                  
>                                                 
>                              v1           v2    
>       v3          v4          v5  
                                                  
>                           This file was created 
> using the 202511 CRSP database.                 
>                                   
                                              It c
> ontains value- and equal-weighted returns for po
> rtfolios formed on ME and BEME.                 
>                                   
    The portfolios are constructed at the end of J
> une.  BEME is book value at the last fiscal year
>  end of the prior calendar year                 
>                                   
                                                  
>                         divided by ME at the end
>  of December of the prior year.                 
>                                   
                                                  
>                                    Annual return
> s are from January to December.                 
>                                   
                                                  
>                                   Missing data a
> re indicated by -99.99 or -999.                 
>                                   
                                                  
>                       The break points include u
> tilities and include financials                 
>                                   
                                                  
>                      The  portfolios  include ut
> ilities and include financials.                 
>                                   
                                                  
>                                       Average Va
> lue Weighted Returns -- Monthly                 
>                                   
                                                  
>                                                 
>                                   SMALL LoBM    
>  ME1 BM2     ME1 BM3     ME1 BM4  
                                                  
>                                                 
>                          192607       5.8276    
>  -1.7006      0.5118     -2.1477  
                                                  
>                                                 
>                          192608      -2.0206    
>  -8.0282      1.3968      2.1483  
                                                  
>                                                 
>                          192609      -4.8291    
>  -2.6806     -4.3417     -3.2683  
                                                  
>                                                 
>                          192610      -9.3633    
>  -3.5519     -3.5024      3.4413  
                                                  
>                                                 
>                          192611       5.5888    
>   4.1877      2.4384     -4.4495  
                                                  
>                                                 
>                          192612      14.9644    
>  -1.4263      0.0084      3.3801  
                                                  
>                                                 
>                          192701       1.0954    
>  -8.1352     -4.8280      3.0498  
                                                  
>                                                 
>                          192702       2.8672    
>  -0.4922      8.5078      5.2580  
                                                  
>                                                 
>                          192703       5.8224    
>  -0.0730     -5.8769     -3.9186  
                                                  
>                                                 
>                          192704       7.8274    
>   4.7880      4.3995      3.3905  

. 
. // Just checking how many rows total
. di ""


. di "Total number of rows: " _N
Total number of rows: 8895

. 
. /*----------------------------------------------
> --------------------------------
>     Part 2: Now Let's Check the Factors File
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "NOW CHECKING: F-F_Research_Data_Factors.csv"
NOW CHECKING: F-F_Research_Data_Factors.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
. // Same approach - import as strings to see the 
> raw data
. import delimited "$root/data/raw/F-F_Research_Da
> ta_Factors.csv", clear stringcols(_all) varnames
> (nonames)
(encoding automatically selected: ISO-8859-1)
(5 vars, 1,293 obs)

. 
. // Show me the first 20 rows again
. di ""


. di "First 20 rows look like this:"
First 20 rows look like this:

. list v1 v2 v3 v4 v5 in 1/20, clean noobs

                                                  
>                                            v1   
>                                                 
>                       v2        v3        v4    
>     v5  
                                          This fil
> e was created using the 202507 CRSP database.   
>                                                 
>                                                 
>         
    The 1-month TBill rate data until 202405 are f
> rom Ibbotson Associates. Starting from 202406   
>  the 1-month TBill rate is from ICE BofA US 1-Mo
> nth Treasury Bill Index.                        
>         
                                                  
>                                                 
>                                                 
>                   Mkt-RF       SMB       HML    
>     RF  
                                                  
>                                        192607   
>                                                 
>                     2.89     -2.55     -2.39    
>   0.22  
                                                  
>                                        192608   
>                                                 
>                     2.64     -1.14      3.81    
>   0.25  
                                                  
>                                        192609   
>                                                 
>                     0.38     -1.36      0.05    
>   0.23  
                                                  
>                                        192610   
>                                                 
>                    -3.27     -0.14      0.82    
>   0.32  
                                                  
>                                        192611   
>                                                 
>                     2.54     -0.11     -0.61    
>   0.31  
                                                  
>                                        192612   
>                                                 
>                     2.62     -0.07      0.06    
>   0.28  
                                                  
>                                        192701   
>                                                 
>                    -0.05     -0.32      4.58    
>   0.25  
                                                  
>                                        192702   
>                                                 
>                     4.17      0.07      2.72    
>   0.26  
                                                  
>                                        192703   
>                                                 
>                     0.14     -1.77     -2.38    
>   0.30  
                                                  
>                                        192704   
>                                                 
>                     0.47      0.39      0.65    
>   0.25  
                                                  
>                                        192705   
>                                                 
>                     5.45      1.55      4.80    
>   0.30  
                                                  
>                                        192706   
>                                                 
>                    -2.38      0.51     -1.72    
>   0.26  
                                                  
>                                        192707   
>                                                 
>                     7.26     -3.27     -1.13    
>   0.30  
                                                  
>                                        192708   
>                                                 
>                     1.99     -0.77     -3.85    
>   0.28  
                                                  
>                                        192709   
>                                                 
>                     4.77     -3.60     -0.57    
>   0.21  
                                                  
>                                        192710   
>                                                 
>                    -4.29      2.03     -4.47    
>   0.25  
                                                  
>                                        192711   
>                                                 
>                     6.52      2.78     -0.08    
>   0.21  

. 
. // Total row count
. di ""


. di "Total number of rows: " _N
Total number of rows: 1293

. 
. /*----------------------------------------------
> --------------------------------
>     Part 3: What to Do Next
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "WHAT I NEED TO DO NEXT:"
WHAT I NEED TO DO NEXT:

. di "============================================
> =========================="
==================================================
> ====================

. di "1. Check the output above and figure out:"
1. Check the output above and figure out:

. di "   - Where are the actual column headers?"
   - Where are the actual column headers?

. di "   - What row does the real data start on?"
   - What row does the real data start on?

. di ""


. di "2. Once know that, fix the import script"
2. Once know that, fix the import script

. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     01_data_preparation_v4.do
>     
>     Purpose: Import and prep the data for Fama-F
> rench (1993) replication
>     
>     Note: The 25 Portfolios file from Ken French
>  has multiple sections in it:
>     - Value-weighted returns (this is what we ne
> ed)
>     - Equal-weighted returns
>     - Other stuff
>     We're just grabbing the first section (value
> -weighted).
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. // Main project directory
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. // Make sure we have the folders we need
. cap mkdir "$root/data"

. cap mkdir "$root/data/processed"

. 
. /*----------------------------------------------
> --------------------------------
>     Step 1: Import the 25 Portfolios (Value-Weig
> hted Section Only)
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Step 1: Loading 25 Portfolios data..."
Step 1: Loading 25 Portfolios data...

. di "============================================
> =========================="
==================================================
> ====================

. 
. // First let's see what the file structure looks
>  like
. import delimited "$root/data/raw/25_Portfolios_5
> x5.csv", clear stringcols(_all) varnames(nonames
> )
(encoding automatically selected: ISO-8859-1)
(26 vars, 8,895 obs)

. 
. // Try to find rows that are section headers (th
> ey have text instead of numbers)
. // Look for words like "Equal" or "Annual" - tho
> se mark new sections
. gen rownum = _n

. gen is_header = regexm(v1, "[A-Za-z]")

. gen is_date = regexm(v1, "^[0-9]{6}$")

. 
. // Show me which rows might be section breaks
. di "These rows might be section headers:"
These rows might be section headers:

. list rownum v1 v2 if is_header == 1 & rownum > 1
> 0 in 1/50

. 
. // Find where the first section ends
. summarize rownum if is_header == 1 & rownum > 15

    Variable |        Obs        Mean    Std. dev.
>        Min        Max
-------------+------------------------------------
> ---------------------
      rownum |         24    5809.125    2121.418 
>       1204       8895

. local section_end = r(min) - 1

. 
. di ""


. di "First data section looks like it ends at row
> : `section_end'"
First data section looks like it ends at row: 1203

. 
. // OK now let's import just the value-weighted p
> art
. clear

. import delimited "$root/data/raw/25_Portfolios_5
> x5.csv", clear rowrange(11:`section_end') varnam
> es(10)
(encoding automatically selected: ISO-8859-1)
(26 vars, 1,190 obs)

. 
. // Rename the first variable to yyyymm for date
. ds
thebreakpo~n  v10           v19
v2            v11           v20
v3            v12           v21
v4            v13           v22
v5            v14           v23
v6            v15           v24
v7            v16           v25
v8            v17           v26
v9            v18

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. // Clean up the date variable
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced a
> s long
(3 missing values generated)

. drop if yyyymm == .
(3 observations deleted)

. drop if yyyymm < 100000  // Remove weird values
(0 observations deleted)

. 
. // Check if we have any duplicate dates (shouldn
> 't happen but let's verify)
. duplicates report yyyymm

Duplicates in terms of yyyymm

--------------------------------------
   Copies | Observations       Surplus
----------+---------------------------
        1 |         1187             0
--------------------------------------

. duplicates list yyyymm if yyyymm != .

Duplicates in terms of yyyymm

(0 observations are duplicates)

. 
. // Now rename the 25 portfolio columns
. ds yyyymm, not
v2   v5   v8   v11  v14  v17  v20  v23  v26
v3   v6   v9   v12  v15  v18  v21  v24
v4   v7   v10  v13  v16  v19  v22  v25

. local portvars `r(varlist)'

. local nvars : word count `portvars'

. di "Number of portfolio variables found: `nvars'
> "
Number of portfolio variables found: 25

. 
. // Loop through and rename as p11, p12, ... p55
. local i = 1

. foreach var of local portvars {
  2.     local size = ceil(`i'/5)
  3.     local bm = `i' - (`size'-1)*5
  4.     rename `var' p`size'`bm'
  5.     local i = `i' + 1
  6. }

. 
. // Convert to numeric and clean
. foreach var of varlist p* {
  2.     cap destring `var', replace force
  3. }

. 
. // Get rid of obvious missing value codes
. foreach var of varlist p* {
  2.     replace `var' = . if `var' < -90
  3. }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. // Create proper date variables for Stata
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. sort date

. 
. // Make sure dates are unique
. isid date

. di "Portfolio data loaded: " _N " observations (
> unique by date)"
Portfolio data loaded: 1187 observations (unique b
> y date)

. di "Date range goes from: " yyyymm[1] " to " yyy
> ymm[_N]
Date range goes from: 192607 to 202505

. 
. // Save this temporarily
. save "$root/data/processed/portfolios_temp.dta",
>  replace
(file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/data/processed/portfolios_temp.dt
    > a not found)
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/data/processed/portfolios_temp.dt
    > a saved

. 
. /*----------------------------------------------
> --------------------------------
>     Step 2: Import Fama-French Factor Data
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Step 2: Loading Fama-French Factors..."
Step 2: Loading Fama-French Factors...

. di "============================================
> =========================="
==================================================
> ====================

. 
. clear

. import delimited "$root/data/raw/F-F_Research_Da
> ta_Factors.csv", clear rowrange(5) varnames(4)
(encoding automatically selected: ISO-8859-1)
(5 vars, 1,290 obs)

. 
. // Rename first variable to date
. ds
v1     mktrf  smb    hml    rf

. local allvars `r(varlist)'

. local firstvar : word 1 of `allvars'

. rename `firstvar' yyyymm

. 
. // Clean the date variable
. destring yyyymm, replace force
yyyymm: contains nonnumeric characters; replaced a
> s long
(3 missing values generated)

. drop if yyyymm == .
(3 observations deleted)

. drop if yyyymm < 100000
(98 observations deleted)

. drop if yyyymm > 209912  // Keep it reasonable
(0 observations deleted)

. 
. // Convert factor variables to numeric
. foreach var in mktrf smb hml rf {
  2.     cap destring `var', replace force
  3.     cap replace `var' = . if `var' < -90  // 
> Remove missing codes
  4. }

. 
. // Make Stata date variables
. gen year = floor(yyyymm/100)

. gen month = yyyymm - year*100

. gen date = ym(year, month)

. format date %tm

. 
. keep date yyyymm year month mktrf smb hml rf

. sort date

. 
. // Check for duplicate dates here too
. duplicates report date

Duplicates in terms of date

--------------------------------------
   Copies | Observations       Surplus
----------+---------------------------
        1 |         1189             0
--------------------------------------

. bysort date: keep if _n == 1  // Just keep first
>  if duplicates exist
(0 observations deleted)

. 
. di "Factor data loaded: " _N " observations"
Factor data loaded: 1189 observations

. 
. /*----------------------------------------------
> --------------------------------
>     Step 3: Merge the Two Datasets Together
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Step 3: Merging the datasets..."
Step 3: Merging the datasets...

. di "============================================
> =========================="
==================================================
> ====================

. 
. merge 1:1 date using "$root/data/processed/portf
> olios_temp.dta", nogen keep(match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             1,187  
    -----------------------------------------

. sort date

. 
. di "Merged dataset has: " _N " observations"
Merged dataset has: 1187 observations

. di "Date range: " %tm date[1] " to " %tm date[_N
> ]
Date range:  1926m7 to  2025m5

. 
. // Clean up temporary file
. cap erase "$root/data/processed/portfolios_temp.
> dta"

. 
. /*----------------------------------------------
> --------------------------------
>     Step 4: Calculate Excess Returns for Portfol
> ios
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Step 4: Calculating excess returns..."
Step 4: Calculating excess returns...

. di "============================================
> =========================="
==================================================
> ====================

. 
. // Create excess return = portfolio return - ris
> k free rate
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         gen exret`size'`bm' = p`size'`bm' - r
> f
  4.     }
  5. }

. 
. di "Created 25 excess return variables"
Created 25 excess return variables

. 
. /*----------------------------------------------
> --------------------------------
>     Step 5: Save the Final Clean Dataset
> ------------------------------------------------
> ------------------------------*/
. 
. order date yyyymm year month mktrf smb hml rf p*
>  exret*

. compress
  variable date was float now int
  variable year was float now int
  variable month was float now byte
  (8,309 bytes saved)

. save "$root/data/processed/merged_data.dta", rep
> lace
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/data/processed/merged_data.dta
    saved

. 
. /*----------------------------------------------
> --------------------------------
>     Step 6: Print Summary Info
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "DATA PREP DONE!"
DATA PREP DONE!

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Saved to: $root/data/processed/merged_data.d
> ta"
Saved to: /Users/pei-chin/Research/FamaFrench_1993
> _Replication/data/processed/merged_data.dta

. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Total months: " _N
Total months: 1187

. di ""


. di "Factor Summary Stats:"
Factor Summary Stats:

. summarize mktrf smb hml rf

    Variable |        Obs        Mean    Std. dev.
>        Min        Max
-------------+------------------------------------
> ---------------------
       mktrf |      1,187    .6841618    5.320598 
>     -28.74      38.81
         smb |      1,187    .1637742    3.158712 
>     -17.41      35.96
         hml |      1,187    .3463606     3.55905 
>     -13.83      35.52
          rf |      1,187     .269604    .2495654 
>       -.06       1.35

. 
. di ""


. di "Portfolio Excess Returns (just the corners):
> "
Portfolio Excess Returns (just the corners):

. summarize exret11 exret15 exret51 exret55

    Variable |        Obs        Mean    Std. dev.
>        Min        Max
-------------+------------------------------------
> ---------------------
     exret11 |      1,187    .5509995    11.91993 
>    -49.503   147.8201
     exret15 |      1,187    1.330208    9.169148 
>   -33.0903    99.4873
     exret51 |      1,187    .6840005    5.341898 
>   -28.4828    32.3293
     exret55 |      1,187    .9486664    8.457548 
>   -45.5856    98.0192

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     02_summary_statistics.do
>     
>     Purpose: Replicate Fama-French (1993) Table 
> 2
>              Summary statistics for 25 portfolio
> s and factors
>     
>     Input:  merged_data.dta
>     Output: Summary statistics tables
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. * Create output directory
. cap mkdir "$root/output"

. cap mkdir "$root/output/tables"

. 
. * Load data
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "SUMMARY STATISTICS - Replicating Table 2"
SUMMARY STATISTICS - Replicating Table 2

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Number of months: " _N
Number of months: 1187

. di "============================================
> =========================="
==================================================
> ====================

. 
. /*----------------------------------------------
> --------------------------------
>     1. Factor Summary Statistics
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 1: Factor Summary Statistics"
Part 1: Factor Summary Statistics

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. * Calculate statistics for each factor
. * Note: Going through the basic factors first
. foreach var in mktrf smb hml rf {
  2.     qui sum `var'  // shortened quietly for r
> eadability
  3.     local mean_`var' = r(mean)
  4.     local sd_`var' = r(sd)
  5.     local n_`var' = r(N)
  6.     local tstat_`var' = `mean_`var'' / (`sd_`
> var'' / sqrt(`n_`var''))
  7. }

. 
. di "Factor         Mean     Std Dev    t-stat   
>   N"
Factor         Mean     Std Dev    t-stat     N

. di "--------------------------------------------
> ----------"
--------------------------------------------------
> ----

. di "Mkt-RF      " %8.3f `mean_mktrf' "   " %8.3f
>  `sd_mktrf' "   " %6.2f `tstat_mktrf' "   " `n_m
> ktrf'
Mkt-RF         0.684      5.321     4.43   1187

. di "SMB         " %8.3f `mean_smb' "   " %8.3f `
> sd_smb' "   " %6.2f `tstat_smb' "   " `n_smb'
SMB            0.164      3.159     1.79   1187

. di "HML         " %8.3f `mean_hml' "   " %8.3f `
> sd_hml' "   " %6.2f `tstat_hml' "   " `n_hml'
HML            0.346      3.559     3.35   1187

. di "RF          " %8.3f `mean_rf' "   " %8.3f `s
> d_rf' "   " %6.2f `tstat_rf' "   " `n_rf'
RF             0.270      0.250    37.22   1187

. di "--------------------------------------------
> ----------"
--------------------------------------------------
> ----

. 
. /*----------------------------------------------
> --------------------------------
>     2. Portfolio Mean Excess Returns (5x5 Matrix
> )
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 2: Mean Excess Returns (% per month)"
Part 2: Mean Excess Returns (% per month)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Rows = Size (1=Small to 5=Big)"
Rows = Size (1=Small to 5=Big)

. di "Cols = Book-to-Market (1=Low/Growth to 5=Hig
> h/Value)"
Cols = Book-to-Market (1=Low/Growth to 5=High/Valu
> e)

. di ""


. 
. * Create matrix for mean returns
. matrix mean_ret = J(5, 5, .)

. 
. // Loop through all portfolio combinations
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         qui sum exret`size'`bm'
  4.         matrix mean_ret[`size', `bm'] = r(mea
> n)
  5.     }
  6. }

. 
. * Display matrix nicely formatted
. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "          (Growth)                          
>      (Value)"
          (Growth)                               (
> Value)

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     // Create size labels - probably could cl
> ean this up but works for now
.     if `size'==1 {
  3.         local size_label = "Small"
  4.     }
  5.     else if `size'==5 {
  6.         local size_label = "Big  "
  7.     }
  8.     else {
  9.         local size_label = "Size`size'"
 10.     }
 11.     di "`size_label'" _col(12) %8.3f mean_ret
> [`size',1] %8.3f mean_ret[`size',2] %8.3f mean_r
> et[`size',3] %8.3f mean_ret[`size',4] %8.3f mean
> _ret[`size',5]
 12. }
Small         0.551   0.645   0.964   1.116   1.33
> 0
Size2         0.633   0.917   0.948   1.026   1.21
> 9
Size3         0.708   0.897   0.908   0.993   1.09
> 5
Size4         0.726   0.772   0.835   0.960   1.02
> 3
Big           0.684   0.645   0.702   0.666   0.94
> 9

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. * Calculate row and column averages - let's see 
> patterns
. di ""


. di "Average by Size (across all B/M):"
Average by Size (across all B/M):

. forvalues size = 1/5 {
  2.     local rowsum = 0
  3.     forvalues bm = 1/5 {
  4.         local rowsum = `rowsum' + mean_ret[`s
> ize', `bm']
  5.     }
  6.     local rowavg = `rowsum' / 5
  7.     if `size'==1 {
  8.         local size_label = "Small"
  9.     }
 10.     else if `size'==5 {
 11.         local size_label = "Big"
 12.     }
 13.     else {
 14.         local size_label = "Size`size'"
 15.     }
 16.     di "  `size_label': " %8.3f `rowavg'
 17. }
  Small:    0.921
  Size2:    0.949
  Size3:    0.920
  Size4:    0.863
  Big:    0.729

. 
. di ""


. di "Average by B/M (across all Size):"
Average by B/M (across all Size):

. forvalues bm = 1/5 {
  2.     local colsum = 0
  3.     forvalues size = 1/5 {
  4.         local colsum = `colsum' + mean_ret[`s
> ize', `bm']
  5.     }
  6.     local colavg = `colsum' / 5
  7.     if `bm'==1 {
  8.         local bm_label = "Low BM"
  9.     }
 10.     else if `bm'==5 {
 11.         local bm_label = "High BM"
 12.     }
 13.     else {
 14.         local bm_label = "BM`bm'"
 15.     }
 16.     di "  `bm_label': " %8.3f `colavg'
 17. }
  Low BM:    0.661
  BM2:    0.775
  BM3:    0.871
  BM4:    0.952
  High BM:    1.123

. 
. /*----------------------------------------------
> --------------------------------
>     3. Portfolio Standard Deviations (5x5 Matrix
> )
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 3: Standard Deviations of Excess Return
> s (% per month)"
Part 3: Standard Deviations of Excess Returns (% p
> er month)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. matrix sd_ret = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         qui sum exret`size'`bm'
  4.         matrix sd_ret[`size', `bm'] = r(sd)
  5.     }
  6. }

. 
. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     if `size'==1 {
  3.         local size_label = "Small"
  4.     }
  5.     else if `size'==5 {
  6.         local size_label = "Big  "
  7.     }
  8.     else {
  9.         local size_label = "Size`size'"
 10.     }
 11.     di "`size_label'" _col(12) %8.3f sd_ret[`
> size',1] %8.3f sd_ret[`size',2] %8.3f sd_ret[`si
> ze',3] %8.3f sd_ret[`size',4] %8.3f sd_ret[`size
> ',5]
 12. }
Small        11.920   9.657   8.852   8.281   9.16
> 9
Size2         7.972   7.482   7.221   7.436   8.67
> 5
Size3         7.355   6.486   6.466   6.937   8.37
> 5
Size4         6.197   6.104   6.301   6.822   8.56
> 3
Big           5.342   5.257   5.580   6.533   8.45
> 8

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     4. t-Statistics for Mean Returns
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 4: t-Statistics for Mean Excess Returns
> "
Part 4: t-Statistics for Mean Excess Returns

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "(Testing H0: mean = 0)"
(Testing H0: mean = 0)

. di ""


. 
. matrix tstat_ret = J(5, 5, .)

. local T = _N  // Total number of observations

. 
. // Computing t-stats for each portfolio
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local tstat = mean_ret[`size', `bm'] 
> / (sd_ret[`size', `bm'] / sqrt(`T'))
  4.         matrix tstat_ret[`size', `bm'] = `tst
> at'
  5.     }
  6. }

. 
. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     if `size'==1 {
  3.         local size_label = "Small"
  4.     }
  5.     else if `size'==5 {
  6.         local size_label = "Big  "
  7.     }
  8.     else {
  9.         local size_label = "Size`size'"
 10.     }
 11.     di "`size_label'" _col(12) %8.2f tstat_re
> t[`size',1] %8.2f tstat_ret[`size',2] %8.2f tsta
> t_ret[`size',3] %8.2f tstat_ret[`size',4] %8.2f 
> tstat_ret[`size',5]
 12. }
Small          1.59    2.30    3.75    4.64    5.0
> 0
Size2          2.74    4.22    4.52    4.75    4.8
> 4
Size3          3.32    4.77    4.84    4.93    4.5
> 0
Size4          4.04    4.36    4.57    4.85    4.1
> 2
Big            4.41    4.23    4.33    3.51    3.8
> 6

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     5. Size and Value Spreads
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 5: Size and Value Spreads"
Part 5: Size and Value Spreads

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. * SMB-like spread: Average Small - Average Big
. * Calculate average for small stocks (size quint
> ile 1)
. local small_avg = (mean_ret[1,1] + mean_ret[1,2]
>  + mean_ret[1,3] + mean_ret[1,4] + mean_ret[1,5]
> ) / 5

. * Calculate average for big stocks (size quintil
> e 5)
. local big_avg = (mean_ret[5,1] + mean_ret[5,2] +
>  mean_ret[5,3] + mean_ret[5,4] + mean_ret[5,5]) 
> / 5

. local size_spread = `small_avg' - `big_avg'

. 
. di "Size Spread (Small - Big):"
Size Spread (Small - Big):

. di "  Average Small portfolio return: " %8.3f `s
> mall_avg'
  Average Small portfolio return:    0.921

. di "  Average Big portfolio return:   " %8.3f `b
> ig_avg'
  Average Big portfolio return:      0.729

. di "  Size spread:                    " %8.3f `s
> ize_spread'
  Size spread:                       0.192

. 
. di ""


. 
. * HML-like spread: Average High BM - Average Low
>  BM
. local highbm_avg = (mean_ret[1,5] + mean_ret[2,5
> ] + mean_ret[3,5] + mean_ret[4,5] + mean_ret[5,5
> ]) / 5

. local lowbm_avg = (mean_ret[1,1] + mean_ret[2,1]
>  + mean_ret[3,1] + mean_ret[4,1] + mean_ret[5,1]
> ) / 5

. local value_spread = `highbm_avg' - `lowbm_avg'

. 
. di "Value Spread (High B/M - Low B/M):"
Value Spread (High B/M - Low B/M):

. di "  Average High B/M portfolio return: " %8.3f
>  `highbm_avg'
  Average High B/M portfolio return:    1.123

. di "  Average Low B/M portfolio return:  " %8.3f
>  `lowbm_avg'
  Average Low B/M portfolio return:     0.661

. di "  Value spread:                      " %8.3f
>  `value_spread'
  Value spread:                         0.463

. 
. /*----------------------------------------------
> --------------------------------
>     6. Factor Correlations
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 6: Factor Correlations"
Part 6: Factor Correlations

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. // Check how factors correlate with each other
. corr mktrf smb hml
(obs=1,187)

             |    mktrf      smb      hml
-------------+---------------------------
       mktrf |   1.0000
         smb |   0.3204   1.0000
         hml |   0.2283   0.1250   1.0000


. 
. /*----------------------------------------------
> --------------------------------
>     7. Export Results to CSV
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Exporting results to CSV..."
Exporting results to CSV...

. di "============================================
> =========================="
==================================================
> ====================

. 
. * Export mean returns matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. // Fill in the values from our matrix
. forvalues size = 1/5 {
  2.     replace lowbm = mean_ret[`size', 1] if si
> ze == `size'
  3.     replace bm2 = mean_ret[`size', 2] if size
>  == `size'
  4.     replace bm3 = mean_ret[`size', 3] if size
>  == `size'
  5.     replace bm4 = mean_ret[`size', 4] if size
>  == `size'
  6.     replace highbm = mean_ret[`size', 5] if s
> ize == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. label define size_lbl 1 "Small" 2 "Size2" 3 "Siz
> e3" 4 "Size4" 5 "Big"

. label values size size_lbl

. 
. export delimited "$root/output/tables/table2_mea
> n_returns.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table2_mean_returns.csv sa
> ved

. restore

. 
. * Export standard deviations matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = sd_ret[`size', 1] if size
>  == `size'
  3.     replace bm2 = sd_ret[`size', 2] if size =
> = `size'
  4.     replace bm3 = sd_ret[`size', 3] if size =
> = `size'
  5.     replace bm4 = sd_ret[`size', 4] if size =
> = `size'
  6.     replace highbm = sd_ret[`size', 5] if siz
> e == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table2_std
> _dev.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table2_std_dev.csv saved

. restore

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "SUMMARY STATISTICS COMPLETE!"
SUMMARY STATISTICS COMPLETE!

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Key Findings:"
Key Findings:

. di "1. Size Effect: Small stocks earn " %5.3f `s
> ize_spread' "% more per month than big stocks"
1. Size Effect: Small stocks earn 0.192% more per 
> month than big stocks

. di "2. Value Effect: High B/M stocks earn " %5.3
> f `value_spread' "% more per month than low B/M"
2. Value Effect: High B/M stocks earn 0.463% more 
> per month than low B/M

. di ""


. di "Output files:"
Output files:

. di "  - $root/output/tables/table2_mean_returns.
> csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table2_mean_returns.csv

. di "  - $root/output/tables/table2_std_dev.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table2_std_dev.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     03_capm_regressions.do
>     
>     Purpose: Replicate Fama-French (1993) Table 
> 4
>              Running CAPM regressions for the 25
>  portfolios
>              
>     Model: R(i,t) - RF(t) = alpha(i) + beta(i) *
>  [RM(t) - RF(t)] + e(i,t)
>     
>     Input:  merged_data.dta
>     Output: CAPM regression results
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. // Load the merged data
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "CAPM REGRESSIONS - Replicating Table 4"
CAPM REGRESSIONS - Replicating Table 4

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Model: Excess Return = alpha + beta * (Mkt-R
> F) + error"
Model: Excess Return = alpha + beta * (Mkt-RF) + e
> rror

. di ""


. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Number of months: " _N
Number of months: 1187

. di "============================================
> =========================="
==================================================
> ====================

. 
. /*----------------------------------------------
> --------------------------------
>     Step 1: Run CAPM Regressions for All 25 Port
> folios
> ------------------------------------------------
> ------------------------------*/
. 
. // Set up matrices to store our results
. matrix alpha_capm = J(5, 5, .)

. matrix beta_capm = J(5, 5, .)

. matrix tstat_alpha = J(5, 5, .)

. matrix tstat_beta = J(5, 5, .)

. matrix rsq_capm = J(5, 5, .)

. matrix se_capm = J(5, 5, .)

. 
. // Run the regressions and store results
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
  4.         
.         // Store the coefficients and stats
.         matrix alpha_capm[`size', `bm'] = _b[_co
> ns]
  5.         matrix beta_capm[`size', `bm'] = _b[m
> ktrf]
  6.         matrix tstat_alpha[`size', `bm'] = _b
> [_cons] / _se[_cons]
  7.         matrix tstat_beta[`size', `bm'] = _b[
> mktrf] / _se[mktrf]
  8.         matrix rsq_capm[`size', `bm'] = e(r2)
  9.         matrix se_capm[`size', `bm'] = e(rmse
> )
 10.     }
 11. }

. 
. /*----------------------------------------------
> --------------------------------
>     Step 2: Show Beta Results
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 1: CAPM Betas"
Part 1: CAPM Betas

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "          (Growth)                          
>      (Value)"
          (Growth)                               (
> Value)

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f beta_cap
> m[`size',1] %8.3f beta_capm[`size',2] %8.3f beta
> _capm[`size',3] %8.3f beta_capm[`size',4] %8.3f 
> beta_capm[`size',5]
  4. }
Small         1.601   1.393   1.359   1.265   1.36
> 1
Size2         1.270   1.232   1.200   1.216   1.37
> 7
Size3         1.245   1.132   1.120   1.171   1.35
> 7
Size4         1.088   1.091   1.103   1.162   1.39
> 1
Big           0.961   0.946   0.967   1.098   1.30
> 0

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 3: Show Alpha Results (This is the key 
> part!)
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 2: CAPM Alphas (Intercepts) - % per mon
> th"
Part 2: CAPM Alphas (Intercepts) - % per month

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "If CAPM works, all alphas should be close to
>  zero."
If CAPM works, all alphas should be close to zero.

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f alpha_ca
> pm[`size',1] %8.3f alpha_capm[`size',2] %8.3f al
> pha_capm[`size',3] %8.3f alpha_capm[`size',4] %8
> .3f alpha_capm[`size',5]
  4. }
Small        -0.545  -0.308   0.034   0.250   0.39
> 9
Size2        -0.236   0.074   0.127   0.194   0.27
> 7
Size3        -0.143   0.123   0.142   0.192   0.16
> 6
Size4        -0.018   0.025   0.081   0.165   0.07
> 1
Big           0.026  -0.002   0.040  -0.085   0.05
> 9

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 4: t-Statistics for the Alphas
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 3: t-Statistics for Alphas"
Part 3: t-Statistics for Alphas

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "(|t| > 1.96 means significant at 5% level)"
(|t| > 1.96 means significant at 5% level)

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.2f tstat_al
> pha[`size',1] %8.2f tstat_alpha[`size',2] %8.2f 
> tstat_alpha[`size',3] %8.2f tstat_alpha[`size',4
> ] %8.2f tstat_alpha[`size',5]
  4. }
Small         -2.23   -1.70    0.23    1.77    2.4
> 2
Size2         -1.90    0.70    1.28    1.81    2.0
> 4
Size3         -1.53    1.74    1.93    2.15    1.3
> 4
Size4         -0.28    0.46    1.20    1.95    0.5
> 7
Big            0.58   -0.04    0.64   -1.00    0.4
> 2

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Count how many alphas are statistically signi
> ficant
. local sig_count = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         if abs(tstat_alpha[`size', `bm']) > 1
> .96 {
  4.             local sig_count = `sig_count' + 1
  5.         }
  6.     }
  7. }

. di ""


. di "Number of significant alphas (|t| > 1.96): `
> sig_count' out of 25"
Number of significant alphas (|t| > 1.96): 4 out o
> f 25

. di "(By pure chance at 5% level, we'd expect abo
> ut 1.25)"
(By pure chance at 5% level, we'd expect about 1.2
> 5)

. 
. /*----------------------------------------------
> --------------------------------
>     Step 5: R-squared Values
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 4: R-squared Values"
Part 4: R-squared Values

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f rsq_capm
> [`size',1] %8.3f rsq_capm[`size',2] %8.3f rsq_ca
> pm[`size',3] %8.3f rsq_capm[`size',4] %8.3f rsq_
> capm[`size',5]
  4. }
Small         0.511   0.589   0.667   0.660   0.62
> 3
Size2         0.718   0.767   0.782   0.757   0.71
> 3
Size3         0.811   0.862   0.849   0.807   0.74
> 3
Size4         0.873   0.905   0.867   0.821   0.74
> 7
Big           0.917   0.916   0.850   0.799   0.66
> 9

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Calculate average R-squared across all portfo
> lios
. local rsq_sum = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local rsq_sum = `rsq_sum' + rsq_capm[
> `size', `bm']
  4.     }
  5. }

. local avg_rsq = `rsq_sum' / 25

. di ""


. di "Average R-squared: " %5.3f `avg_rsq'
Average R-squared: 0.769

. 
. /*----------------------------------------------
> --------------------------------
>     Step 6: Look for Patterns in the Alphas
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 5: Pattern Analysis"
Part 5: Pattern Analysis

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. // Average alpha by size quintile
. di "Average Alpha by Size:"
Average Alpha by Size:

. forvalues size = 1/5 {
  2.     local rowsum = 0
  3.     forvalues bm = 1/5 {
  4.         local rowsum = `rowsum' + alpha_capm[
> `size', `bm']
  5.     }
  6.     local rowavg = `rowsum' / 5
  7.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big", "Size`size'"))
  8.     di "  `size_label': " %8.3f `rowavg' "% p
> er month"
  9. }
  Small:   -0.034% per month
  Size2:    0.087% per month
  Size3:    0.096% per month
  Size4:    0.065% per month
  Big:    0.008% per month

. 
. di ""


. 
. // Average alpha by B/M quintile
. di "Average Alpha by B/M:"
Average Alpha by B/M:

. forvalues bm = 1/5 {
  2.     local colsum = 0
  3.     forvalues size = 1/5 {
  4.         local colsum = `colsum' + alpha_capm[
> `size', `bm']
  5.     }
  6.     local colavg = `colsum' / 5
  7.     local bm_label = cond(`bm'==1, "Low BM", 
> cond(`bm'==5, "High BM", "BM`bm'"))
  8.     di "  `bm_label': " %8.3f `colavg' "% per
>  month"
  9. }
  Low BM:   -0.183% per month
  BM2:   -0.018% per month
  BM3:    0.085% per month
  BM4:    0.143% per month
  High BM:    0.195% per month

. 
. /*----------------------------------------------
> --------------------------------
>     Step 7: Detailed Output for the Corner Portf
> olios
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 6: Detailed Results for Corner Portfoli
> os"
Part 6: Detailed Results for Corner Portfolios

. di "============================================
> =========================="
==================================================
> ====================

. 
. di ""


. di "--- Small/Low BM (p11) ---"
--- Small/Low BM (p11) ---

. regress exret11 mktrf

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(1, 1185)      =   1237.95
       Model |   86097.443         1   86097.443  
>  Prob > F        =    0.0000
    Residual |  82415.0777     1,185  69.5485888  
>  R-squared       =    0.5109
-------------+----------------------------------  
>  Adj R-squared   =    0.5105
       Total |  168512.521     1,186  142.084756  
>  Root MSE        =    8.3396

--------------------------------------------------
> ----------------------------
     exret11 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.601372   .0455136    35.18   0.
> 000                                             
>         1.512076                                
>                     1.690669
       _cons |  -.5445983   .2440523    -2.23   0.
> 026                                             
>        -1.023421                                
>                    -.0657755
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Small/High BM (p15) ---"
--- Small/High BM (p15) ---

. regress exret15 mktrf

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(1, 1185)      =   1961.27
       Model |  62156.1995         1  62156.1995  
>  Prob > F        =    0.0000
    Residual |  37554.7091     1,185  31.6917376  
>  R-squared       =    0.6234
-------------+----------------------------------  
>  Adj R-squared   =    0.6230
       Total |  99710.9086     1,186  84.0732788  
>  Root MSE        =    5.6295

--------------------------------------------------
> ----------------------------
     exret15 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.360628   .0307235    44.29   0.
> 000                                             
>          1.30035                                
>                     1.420907
       _cons |   .3993187   .1647448     2.42   0.
> 016                                             
>         .0760946                                
>                     .7225427
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Big/Low BM (p51) ---"
--- Big/Low BM (p51) ---

. regress exret51 mktrf

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(1, 1185)      =  13019.15
       Model |  31020.1039         1  31020.1039  
>  Prob > F        =    0.0000
    Residual |  2823.44192     1,185  2.38265141  
>  R-squared       =    0.9166
-------------+----------------------------------  
>  Adj R-squared   =    0.9165
       Total |  33843.5458     1,186  28.5358734  
>  Root MSE        =    1.5436

--------------------------------------------------
> ----------------------------
     exret51 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   .9612113   .0084242   114.10   0.
> 000                                             
>         .9446833                                
>                     .9777392
       _cons |   .0263765    .045172     0.58   0.
> 559                                             
>        -.0622494                                
>                     .1150025
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Big/High BM (p55) ---"
--- Big/High BM (p55) ---

. regress exret55 mktrf

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(1, 1185)      =   2392.54
       Model |   56734.649         1   56734.649  
>  Prob > F        =    0.0000
    Residual |  28100.0774     1,185  23.7131455  
>  R-squared       =    0.6688
-------------+----------------------------------  
>  Adj R-squared   =    0.6685
       Total |  84834.7264     1,186  71.5301234  
>  Root MSE        =    4.8696

--------------------------------------------------
> ----------------------------
     exret55 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.299934   .0265761    48.91   0.
> 000                                             
>         1.247793                                
>                     1.352076
       _cons |    .059301   .1425061     0.42   0.
> 677                                             
>        -.2202913                                
>                     .3388933
--------------------------------------------------
> ----------------------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 8: Export the Results
> ------------------------------------------------
> ------------------------------*/
. 
. // Export alpha matrix to CSV
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = alpha_capm[`size', 1] if 
> size == `size'
  3.     replace bm2 = alpha_capm[`size', 2] if si
> ze == `size'
  4.     replace bm3 = alpha_capm[`size', 3] if si
> ze == `size'
  5.     replace bm4 = alpha_capm[`size', 4] if si
> ze == `size'
  6.     replace highbm = alpha_capm[`size', 5] if
>  size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table4_cap
> m_alphas.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table4_capm_alphas.csv sav
> ed

. restore

. 
. // Export R-squared matrix
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = rsq_capm[`size', 1] if si
> ze == `size'
  3.     replace bm2 = rsq_capm[`size', 2] if size
>  == `size'
  4.     replace bm3 = rsq_capm[`size', 3] if size
>  == `size'
  5.     replace bm4 = rsq_capm[`size', 4] if size
>  == `size'
  6.     replace highbm = rsq_capm[`size', 5] if s
> ize == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table4_cap
> m_rsq.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table4_capm_rsq.csv saved

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Step 9: Summary of Findings
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "CAPM REGRESSION SUMMARY"
CAPM REGRESSION SUMMARY

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "KEY FINDING: CAPM FAILS to explain the cross
> -section of returns!"
KEY FINDING: CAPM FAILS to explain the cross-secti
> on of returns!

. di ""


. di "Evidence:"
Evidence:

. di "1. `sig_count' out of 25 alphas are statisti
> cally significant"
1. 4 out of 25 alphas are statistically significan
> t

. di "2. Alphas show systematic patterns:"
2. Alphas show systematic patterns:

. di "   - Small stocks have HIGHER alphas than bi
> g stocks"
   - Small stocks have HIGHER alphas than big stoc
> ks

. di "   - High B/M stocks have HIGHER alphas than
>  low B/M stocks"
   - High B/M stocks have HIGHER alphas than low B
> /M stocks

. di "3. Average R-squared: " %5.3f `avg_rsq' " (m
> arket factor alone isn't enough)"
3. Average R-squared: 0.769 (market factor alone i
> sn't enough)

. di ""


. di "This is why we need additional factors (SMB 
> and HML)!"
This is why we need additional factors (SMB and HM
> L)!

. di ""


. di "Output files saved:"
Output files saved:

. di "  - $root/output/tables/table4_capm_alphas.c
> sv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table4_capm_alphas.csv

. di "  - $root/output/tables/table4_capm_rsq.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table4_capm_rsq.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     04_threefactor_regressions.do
>     
>     Purpose: Replicate Fama-French (1993) Table 
> 6 - THE MAIN RESULT
>              Three-factor regressions for the 25
>  portfolios
>              
>     Model: R(i,t) - RF(t) = alpha(i) + b(i)*MktR
> F(t) + s(i)*SMB(t) + h(i)*HML(t) + e(i,t)
>     
>     Input:  merged_data.dta
>     Output: Three-factor regression results
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. // Load the data
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "THREE-FACTOR REGRESSIONS - Replicating Table
>  6 (THE CORE RESULT)"
THREE-FACTOR REGRESSIONS - Replicating Table 6 (TH
> E CORE RESULT)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Model: Excess Return = alpha + b*MktRF + s*S
> MB + h*HML + error"
Model: Excess Return = alpha + b*MktRF + s*SMB + h
> *HML + error

. di ""


. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Number of months: " _N
Number of months: 1187

. di "============================================
> =========================="
==================================================
> ====================

. 
. /*----------------------------------------------
> --------------------------------
>     Step 1: Run Three-Factor Regressions for All
>  25 Portfolios
> ------------------------------------------------
> ------------------------------*/
. 
. // Set up matrices to hold results
. matrix alpha_ff3 = J(5, 5, .)

. matrix b_mkt = J(5, 5, .)

. matrix s_smb = J(5, 5, .)

. matrix h_hml = J(5, 5, .)

. matrix tstat_alpha_ff3 = J(5, 5, .)

. matrix tstat_b = J(5, 5, .)

. matrix tstat_s = J(5, 5, .)

. matrix tstat_h = J(5, 5, .)

. matrix rsq_ff3 = J(5, 5, .)

. matrix se_ff3 = J(5, 5, .)

. 
. // Run the regressions
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
>  smb hml
  4.         
.         // Store the coefficients
.         matrix alpha_ff3[`size', `bm'] = _b[_con
> s]
  5.         matrix b_mkt[`size', `bm'] = _b[mktrf
> ]
  6.         matrix s_smb[`size', `bm'] = _b[smb]
  7.         matrix h_hml[`size', `bm'] = _b[hml]
  8.         
.         // Store t-stats
.         matrix tstat_alpha_ff3[`size', `bm'] = _
> b[_cons] / _se[_cons]
  9.         matrix tstat_b[`size', `bm'] = _b[mkt
> rf] / _se[mktrf]
 10.         matrix tstat_s[`size', `bm'] = _b[smb
> ] / _se[smb]
 11.         matrix tstat_h[`size', `bm'] = _b[hml
> ] / _se[hml]
 12.         
.         // Store fit stats
.         matrix rsq_ff3[`size', `bm'] = e(r2)
 13.         matrix se_ff3[`size', `bm'] = e(rmse)
 14.     }
 15. }

. 
. /*----------------------------------------------
> --------------------------------
>     Step 2: Show Market Beta Results
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 1: Market Betas (b)"
Part 1: Market Betas (b)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f b_mkt[`s
> ize',1] %8.3f b_mkt[`size',2] %8.3f b_mkt[`size'
> ,3] %8.3f b_mkt[`size',4] %8.3f b_mkt[`size',5]
  4. }
Small         1.267   1.070   1.048   0.942   0.98
> 0
Size2         1.086   1.022   0.990   0.969   1.06
> 6
Size3         1.125   1.018   0.985   0.995   1.11
> 3
Size4         1.075   1.029   1.010   1.035   1.18
> 6
Big           1.031   0.978   0.960   1.033   1.17
> 4

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 3: SMB Loadings (KEY - should go down f
> rom Small to Big)
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 2: SMB Loadings (s) - Size Factor"
Part 2: SMB Loadings (s) - Size Factor

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Expected: Should decrease from Small (positi
> ve) to Big (negative)"
Expected: Should decrease from Small (positive) to
>  Big (negative)

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f s_smb[`s
> ize',1] %8.3f s_smb[`size',2] %8.3f s_smb[`size'
> ,3] %8.3f s_smb[`size',4] %8.3f s_smb[`size',5]
  4. }
Small         1.476   1.531   1.239   1.233   1.28
> 7
Size2         1.151   1.006   0.831   0.828   0.92
> 5
Size3         0.811   0.560   0.451   0.477   0.58
> 9
Size4         0.338   0.242   0.209   0.213   0.31
> 9
Big          -0.149  -0.191  -0.232  -0.181  -0.14
> 1

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Calculate average SMB loading for each size q
> uintile
. di ""


. di "Average SMB Loading by Size:"
Average SMB Loading by Size:

. forvalues size = 1/5 {
  2.     local rowsum = 0
  3.     forvalues bm = 1/5 {
  4.         local rowsum = `rowsum' + s_smb[`size
> ', `bm']
  5.     }
  6.     local rowavg = `rowsum' / 5
  7.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big", "Size`size'"))
  8.     di "  `size_label': " %8.3f `rowavg'
  9. }
  Small:    1.353
  Size2:    0.948
  Size3:    0.577
  Size4:    0.264
  Big:   -0.179

. 
. /*----------------------------------------------
> --------------------------------
>     Step 4: HML Loadings (KEY - should go up fro
> m Low to High BM)
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 3: HML Loadings (h) - Value Factor"
Part 3: HML Loadings (h) - Value Factor

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Expected: Should increase from Low BM (negat
> ive) to High BM (positive)"
Expected: Should increase from Low BM (negative) t
> o High BM (positive)

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f h_hml[`s
> ize',1] %8.3f h_hml[`size',2] %8.3f h_hml[`size'
> ,3] %8.3f h_hml[`size',4] %8.3f h_hml[`size',5]
  4. }
Small         0.354   0.206   0.495   0.575   0.88
> 9
Size2        -0.230   0.118   0.344   0.583   0.88
> 4
Size3        -0.220   0.046   0.321   0.561   0.86
> 4
Size4        -0.331   0.106   0.347   0.565   0.94
> 5
Big          -0.269   0.025   0.330   0.654   0.99
> 8

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Average HML loading for each B/M quintile
. di ""


. di "Average HML Loading by B/M:"
Average HML Loading by B/M:

. forvalues bm = 1/5 {
  2.     local colsum = 0
  3.     forvalues size = 1/5 {
  4.         local colsum = `colsum' + h_hml[`size
> ', `bm']
  5.     }
  6.     local colavg = `colsum' / 5
  7.     local bm_label = cond(`bm'==1, "Low BM", 
> cond(`bm'==5, "High BM", "BM`bm'"))
  8.     di "  `bm_label': " %8.3f `colavg'
  9. }
  Low BM:   -0.139
  BM2:    0.100
  BM3:    0.367
  BM4:    0.587
  High BM:    0.916

. 
. /*----------------------------------------------
> --------------------------------
>     Step 5: Alpha Results (KEY - these should be
>  near ZERO)
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 4: Three-Factor Alphas (% per month)"
Part 4: Three-Factor Alphas (% per month)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "If the three-factor model works, ALL alphas 
> should be close to ZERO."
If the three-factor model works, ALL alphas should
>  be close to ZERO.

. di "(Remember CAPM alphas showed systematic patt
> erns)"
(Remember CAPM alphas showed systematic patterns)

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f alpha_ff
> 3[`size',1] %8.3f alpha_ff3[`size',2] %8.3f alph
> a_ff3[`size',3] %8.3f alpha_ff3[`size',4] %8.3f 
> alpha_ff3[`size',5]
  4. }
Small        -0.680  -0.409  -0.127   0.070   0.14
> 1
Size2        -0.219   0.011   0.016   0.026   0.03
> 2
Size3        -0.117   0.093   0.049   0.040  -0.06
> 3
Size4         0.050  -0.008  -0.010   0.021  -0.16
> 8
Big           0.096  -0.001  -0.032  -0.237  -0.17
> 7

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 6: t-Statistics for Alphas
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 5: t-Statistics for Alphas"
Part 5: t-Statistics for Alphas

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "(|t| > 1.96 means significant at 5% level)"
(|t| > 1.96 means significant at 5% level)

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.2f tstat_al
> pha_ff3[`size',1] %8.2f tstat_alpha_ff3[`size',2
> ] %8.2f tstat_alpha_ff3[`size',3] %8.2f tstat_al
> pha_ff3[`size',4] %8.2f tstat_alpha_ff3[`size',5
> ]
  4. }
Small         -3.35   -3.43   -1.47    1.07    1.9
> 6
Size2         -3.12    0.20    0.29    0.53    0.5
> 8
Size3         -2.01    1.84    0.95    0.77   -0.9
> 2
Size4          1.05   -0.17   -0.19    0.36   -2.2
> 3
Big            2.92   -0.03   -0.62   -4.47   -1.7
> 7

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Count how many are statistically significant
. local sig_count_ff3 = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         if abs(tstat_alpha_ff3[`size', `bm'])
>  > 1.96 {
  4.             local sig_count_ff3 = `sig_count_
> ff3' + 1
  5.         }
  6.     }
  7. }

. di ""


. di "Number of significant alphas (|t| > 1.96): `
> sig_count_ff3' out of 25"
Number of significant alphas (|t| > 1.96): 7 out o
> f 25

. di "(By chance at 5% level, we'd expect about 1.
> 25)"
(By chance at 5% level, we'd expect about 1.25)

. 
. /*----------------------------------------------
> --------------------------------
>     Step 7: R-squared Values
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 6: R-squared Values"
Part 6: R-squared Values

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "            Low BM    BM2       BM3       BM
> 4     High BM"
            Low BM    BM2       BM3       BM4     
> High BM

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. forvalues size = 1/5 {
  2.     local size_label = cond(`size'==1, "Small
> ", cond(`size'==5, "Big  ", "Size`size'"))
  3.     di "`size_label'" _col(12) %8.3f rsq_ff3[
> `size',1] %8.3f rsq_ff3[`size',2] %8.3f rsq_ff3[
> `size',3] %8.3f rsq_ff3[`size',4] %8.3f rsq_ff3[
> `size',5]
  4. }
Small         0.663   0.823   0.889   0.929   0.92
> 9
Size2         0.910   0.934   0.934   0.952   0.95
> 2
Size3         0.927   0.930   0.927   0.934   0.92
> 4
Size4         0.931   0.923   0.916   0.915   0.91
> 0
Big           0.956   0.928   0.905   0.923   0.83
> 6

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. // Average R-squared
. local rsq_sum_ff3 = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local rsq_sum_ff3 = `rsq_sum_ff3' + r
> sq_ff3[`size', `bm']
  4.     }
  5. }

. local avg_rsq_ff3 = `rsq_sum_ff3' / 25

. di ""


. di "Average R-squared: " %5.3f `avg_rsq_ff3'
Average R-squared: 0.908

. 
. /*----------------------------------------------
> --------------------------------
>     Step 8: Detailed Output for Corner Portfolio
> s
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 7: Detailed Results for Corner Portfoli
> os"
Part 7: Detailed Results for Corner Portfolios

. di "============================================
> =========================="
==================================================
> ====================

. 
. di ""


. di "--- Small/Low BM (p11) ---"
--- Small/Low BM (p11) ---

. regress exret11 mktrf smb hml

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(3, 1183)      =    776.17
       Model |  111742.146         3   37247.382  
>  Prob > F        =    0.0000
    Residual |  56770.3748     1,183  47.9884825  
>  R-squared       =    0.6631
-------------+----------------------------------  
>  Adj R-squared   =    0.6623
       Total |  168512.521     1,186  142.084756  
>  Root MSE        =    6.9274

--------------------------------------------------
> ----------------------------
     exret11 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.266567   .0407358    31.09   0.
> 000                                             
>         1.186645                                
>                      1.34649
         smb |   1.476215   .0673316    21.92   0.
> 000                                             
>         1.344113                                
>                     1.608318
         hml |   .3537924    .058144     6.08   0.
> 000                                             
>         .2397156                                
>                     .4678692
       _cons |  -.6798432    .203216    -3.35   0.
> 001                                             
>        -1.078547                                
>                    -.2811392
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Small/High BM (p15) ---"
--- Small/High BM (p15) ---

. regress exret15 mktrf smb hml

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(3, 1183)      =   5136.32
       Model |  92601.5602         3  30867.1867  
>  Prob > F        =    0.0000
    Residual |  7109.34837     1,183  6.00959287  
>  R-squared       =    0.9287
-------------+----------------------------------  
>  Adj R-squared   =    0.9285
       Total |  99710.9086     1,186  84.0732788  
>  Root MSE        =    2.4514

--------------------------------------------------
> ----------------------------
     exret15 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   .9799396   .0144155    67.98   0.
> 000                                             
>         .9516567                                
>                     1.008222
         smb |   1.287319   .0238272    54.03   0.
> 000                                             
>         1.240571                                
>                     1.334068
         hml |   .8894556   .0205759    43.23   0.
> 000                                             
>         .8490863                                
>                      .929825
       _cons |   .1408692   .0719137     1.96   0.
> 050                                             
>        -.0002235                                
>                     .2819619
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Big/Low BM (p51) ---"
--- Big/Low BM (p51) ---

. regress exret51 mktrf smb hml

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(3, 1183)      =   8506.11
       Model |  32344.1106         3  10781.3702  
>  Prob > F        =    0.0000
    Residual |  1499.43518     1,183  1.26748536  
>  R-squared       =    0.9557
-------------+----------------------------------  
>  Adj R-squared   =    0.9556
       Total |  33843.5458     1,186  28.5358734  
>  Root MSE        =    1.1258

--------------------------------------------------
> ----------------------------
     exret51 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.030738   .0066203   155.69   0.
> 000                                             
>         1.017749                                
>                     1.043727
         smb |  -.1494581   .0109426   -13.66   0.
> 000                                             
>        -.1709273                                
>                     -.127989
         hml |  -.2691066   .0094495   -28.48   0.
> 000                                             
>        -.2876462                                
>                     -.250567
       _cons |   .0964944   .0330264     2.92   0.
> 004                                             
>         .0316976                                
>                     .1612912
--------------------------------------------------
> ----------------------------

. 
. di ""


. di "--- Big/High BM (p55) ---"
--- Big/High BM (p55) ---

. regress exret55 mktrf smb hml

      Source |       SS           df       MS     
>  Number of obs   =     1,187
-------------+----------------------------------  
>  F(3, 1183)      =   2014.17
       Model |  70945.1126         3  23648.3709  
>  Prob > F        =    0.0000
    Residual |  13889.6138     1,183  11.7410091  
>  R-squared       =    0.8363
-------------+----------------------------------  
>  Adj R-squared   =    0.8359
       Total |  84834.7264     1,186  71.5301234  
>  Root MSE        =    3.4265

--------------------------------------------------
> ----------------------------
     exret55 | Coefficient  Std. err.      t    P>
> |t|                                             
>         [95% con                                
>                 f. interval]
-------------+------------------------------------
> ----------------------------
       mktrf |   1.174329   .0201493    58.28   0.
> 000                                             
>         1.134797                                
>                     1.213862
         smb |     -.1413   .0333045    -4.24   0.
> 000                                             
>        -.2066425                                
>                    -.0759574
         hml |   .9983735     .02876    34.71   0.
> 000                                             
>         .9419472                                
>                       1.0548
       _cons |  -.1774208   .1005176    -1.77   0.
> 078                                             
>        -.3746334                                
>                     .0197918
--------------------------------------------------
> ----------------------------

. 
. /*----------------------------------------------
> --------------------------------
>     Step 9: Compare CAPM vs Three-Factor Model
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "Part 8: CAPM vs Three-Factor Model Compariso
> n"
Part 8: CAPM vs Three-Factor Model Comparison

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. // Re-run CAPM for comparison
. matrix alpha_capm = J(5, 5, .)

. matrix rsq_capm = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
  4.         matrix alpha_capm[`size', `bm'] = _b[
> _cons]
  5.         matrix rsq_capm[`size', `bm'] = e(r2)
  6.     }
  7. }

. 
. // Calculate average R-squared for CAPM
. local rsq_sum_capm = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local rsq_sum_capm = `rsq_sum_capm' +
>  rsq_capm[`size', `bm']
  4.     }
  5. }

. local avg_rsq_capm = `rsq_sum_capm' / 25

. 
. // Calculate sum of squared alphas (measure of p
> ricing errors)
. local ssa_capm = 0

. local ssa_ff3 = 0

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local ssa_capm = `ssa_capm' + (alpha_
> capm[`size', `bm'])^2
  4.         local ssa_ff3 = `ssa_ff3' + (alpha_ff
> 3[`size', `bm'])^2
  5.     }
  6. }

. 
. di "                              CAPM      Thre
> e-Factor"
                              CAPM      Three-Fact
> or

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di "Average R-squared:         " %7.3f `avg_rsq_
> capm' "      " %7.3f `avg_rsq_ff3'
Average R-squared:           0.769        0.908

. di "Sum of Squared Alphas:     " %7.3f `ssa_capm
> ' "      " %7.3f `ssa_ff3'
Sum of Squared Alphas:       0.980        0.880

. di "Significant Alphas:            4            
> `sig_count_ff3'"
Significant Alphas:            4            7

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di ""


. di "Improvement in R-squared: " %5.1f (`avg_rsq_
> ff3' - `avg_rsq_capm')*100 " percentage points"
Improvement in R-squared:  13.9 percentage points

. di "Reduction in SSA:         " %5.1f (1 - `ssa_
> ff3'/`ssa_capm')*100 "%"
Reduction in SSA:          10.1%

. 
. /*----------------------------------------------
> --------------------------------
>     Step 10: Export the Results
> ------------------------------------------------
> ------------------------------*/
. 
. // Export alphas
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = alpha_ff3[`size', 1] if s
> ize == `size'
  3.     replace bm2 = alpha_ff3[`size', 2] if siz
> e == `size'
  4.     replace bm3 = alpha_ff3[`size', 3] if siz
> e == `size'
  5.     replace bm4 = alpha_ff3[`size', 4] if siz
> e == `size'
  6.     replace highbm = alpha_ff3[`size', 5] if 
> size == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_ff3
> _alphas.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table6_ff3_alphas.csv save
> d

. restore

. 
. // Export SMB loadings
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = s_smb[`size', 1] if size 
> == `size'
  3.     replace bm2 = s_smb[`size', 2] if size ==
>  `size'
  4.     replace bm3 = s_smb[`size', 3] if size ==
>  `size'
  5.     replace bm4 = s_smb[`size', 4] if size ==
>  `size'
  6.     replace highbm = s_smb[`size', 5] if size
>  == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_smb
> _loadings.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table6_smb_loadings.csv sa
> ved

. restore

. 
. // Export HML loadings
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = h_hml[`size', 1] if size 
> == `size'
  3.     replace bm2 = h_hml[`size', 2] if size ==
>  `size'
  4.     replace bm3 = h_hml[`size', 3] if size ==
>  `size'
  5.     replace bm4 = h_hml[`size', 4] if size ==
>  `size'
  6.     replace highbm = h_hml[`size', 5] if size
>  == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_hml
> _loadings.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table6_hml_loadings.csv sa
> ved

. restore

. 
. // Export R-squared
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen lowbm = .
(5 missing values generated)

. gen bm2 = .
(5 missing values generated)

. gen bm3 = .
(5 missing values generated)

. gen bm4 = .
(5 missing values generated)

. gen highbm = .
(5 missing values generated)

. 
. forvalues size = 1/5 {
  2.     replace lowbm = rsq_ff3[`size', 1] if siz
> e == `size'
  3.     replace bm2 = rsq_ff3[`size', 2] if size 
> == `size'
  4.     replace bm3 = rsq_ff3[`size', 3] if size 
> == `size'
  5.     replace bm4 = rsq_ff3[`size', 4] if size 
> == `size'
  6.     replace highbm = rsq_ff3[`size', 5] if si
> ze == `size'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. export delimited "$root/output/tables/table6_ff3
> _rsq.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table6_ff3_rsq.csv saved

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Step 11: Final Summary
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "THREE-FACTOR MODEL SUMMARY - THE KEY FINDING
> S"
THREE-FACTOR MODEL SUMMARY - THE KEY FINDINGS

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "1. SMB LOADINGS:"
1. SMB LOADINGS:

. di "   - Small stocks: HIGH positive loadings (a
> round 1.4)"
   - Small stocks: HIGH positive loadings (around 
> 1.4)

. di "   - Big stocks: LOW or negative loadings (a
> round -0.1)"
   - Big stocks: LOW or negative loadings (around 
> -0.1)

. di "   -> SMB captures the SIZE effect"
   -> SMB captures the SIZE effect

. di ""


. di "2. HML LOADINGS:"
2. HML LOADINGS:

. di "   - Low B/M (Growth): NEGATIVE loadings"
   - Low B/M (Growth): NEGATIVE loadings

. di "   - High B/M (Value): POSITIVE loadings"
   - High B/M (Value): POSITIVE loadings

. di "   -> HML captures the VALUE effect"
   -> HML captures the VALUE effect

. di ""


. di "3. ALPHAS:"
3. ALPHAS:

. di "   - Only `sig_count_ff3' significant (vs 4 
> in CAPM)"
   - Only 7 significant (vs 4 in CAPM)

. di "   - No systematic pattern anymore (unlike C
> APM)"
   - No systematic pattern anymore (unlike CAPM)

. di "   -> The three-factor model WORKS!"
   -> The three-factor model WORKS!

. di ""


. di "4. R-SQUARED:"
4. R-SQUARED:

. di "   - Average: " %5.3f `avg_rsq_ff3' " (compa
> red to " %5.3f `avg_rsq_capm' " for CAPM)"
   - Average: 0.908 (compared to 0.769 for CAPM)

. di "   -> Three factors do a better job explaini
> ng returns"
   -> Three factors do a better job explaining ret
> urns

. di ""


. di "CONCLUSION: The Fama-French three-factor mod
> el successfully explains"
CONCLUSION: The Fama-French three-factor model suc
> cessfully explains

. di "            the cross-section of stock retur
> ns!"
            the cross-section of stock returns!

. di ""


. di "Output files saved:"
Output files saved:

. di "  - $root/output/tables/table6_ff3_alphas.cs
> v"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table6_ff3_alphas.csv

. di "  - $root/output/tables/table6_smb_loadings.
> csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table6_smb_loadings.csv

. di "  - $root/output/tables/table6_hml_loadings.
> csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table6_hml_loadings.csv

. di "  - $root/output/tables/table6_ff3_rsq.csv"
  - /Users/pei-chin/Research/FamaFrench_1993_Repli
> cation/output/tables/table6_ff3_rsq.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     05_grs_test.do 
>     
>     Purpose: Replicate Fama-French (1993) Table 
> 9c
>              GRS Test (Gibbons, Ross, Shanken 19
> 89)
>              
>     Test: H0: All 25 intercepts (alphas) are joi
> ntly equal to zero
>     
>     Author: Pei-Chin
>     Date: Started spring 2024, debugged like cra
> zy in summer
>     
>     Input:  merged_data.dta
>     Output: GRS test results (hoping to match pu
> blished Table 9c!)
>     
>     Notes: The GRS calculation was a pain - had 
> to read the original 1989 paper
>            like 5 times to get the denominator r
> ight. Pretty sure it's correct now.
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. * Load the merged dataset
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "GRS TEST - Replicating Fama-French (1993) Ta
> ble 9c"
GRS TEST - Replicating Fama-French (1993) Table 9c

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Gibbons, Ross, and Shanken (1989) Joint Test
>  of Pricing Errors"
Gibbons, Ross, and Shanken (1989) Joint Test of Pr
> icing Errors

. di "Null Hypothesis: All portfolio alphas are jo
> intly equal to zero"
Null Hypothesis: All portfolio alphas are jointly 
> equal to zero

. di ""


. di "Sample period: " %tm date[1] " to " %tm date
> [_N]
Sample period:  1926m7 to  2025m5

. di "Number of months (T): " _N
Number of months (T): 1187

. di "Number of portfolios (N): 25"
Number of portfolios (N): 25

. di "============================================
> =========================="
==================================================
> ====================

. 
. // Store sample size - we'll use this a lot
. local T = _N

. local num_portfolios = 25

. 
. /*----------------------------------------------
> --------------------------------
>     PART 1: GRS Test for CAPM (Single Factor Mod
> el)
>     
>     The CAPM says all you need is beta. Let's se
> e if that holds up...
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "TEST 1: CAPM (Market Factor Only)"
TEST 1: CAPM (Market Factor Only)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. local K_capm = 1  // number of factors

. 
. * Step 1: Run 25 separate regressions and grab t
> he alphas
. di "Running 25 CAPM regressions (this takes a se
> c)..."
Running 25 CAPM regressions (this takes a sec)...

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
  4.         quietly predict resid_capm_`size'`bm'
> , residuals
  5.         
.         // Store the intercept (alpha) and its s
> tandard error
.         local alpha_capm_`size'`bm' = _b[_cons]
  6.         local se_alpha_capm_`size'`bm' = _se[
> _cons]
  7.     }
  8. }

. 
. * Step 2: Put all the alphas into a vector (Nx1 
> matrix)
. matrix alpha_capm = J(25, 1, .)

. local counter = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         matrix alpha_capm[`counter', 1] = `al
> pha_capm_`size'`bm''
  4.         local counter = `counter' + 1
  5.     }
  6. }

. 
. * Step 3: Calculate the covariance matrix of res
> iduals (Sigma)
. // This is the tricky part - need all 25 residua
> l series
. local all_resids ""

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local all_resids "`all_resids' resid_
> capm_`size'`bm'"
  4.     }
  5. }

. 
. quietly correlate `all_resids', covariance

. matrix Sigma_capm = r(C)

. 
. * Step 4: Factor statistics (just market for CAP
> M)
. quietly summarize mktrf

. local mean_mktrf = r(mean)

. local variance_mktrf = r(Var)

. 
. * Step 5: Calculate the GRS F-statistic
. // Formula: GRS = (T/N) * ((T-N-K)/(T-K-1)) * (a
> lpha' * Sigma^-1 * alpha) / (1 + mu'*Omega^-1*mu
> )
. // For single factor, denominator simplifies to:
>  1 + (mean^2 / variance)
. 
. matrix Sigma_capm_inv = invsym(Sigma_capm)

. matrix quad_form_capm = alpha_capm' * Sigma_capm
> _inv * alpha_capm

. local numerator_part = quad_form_capm[1,1]

. 
. // Sharpe ratio squared (for single factor case)
. local sharpe_ratio_sq = (`mean_mktrf'^2) / `vari
> ance_mktrf'

. local denominator = 1 + `sharpe_ratio_sq'

. 
. // Put it all together
. local df_numerator = `num_portfolios'

. local df_denominator = `T' - `num_portfolios' - 
> `K_capm'

. local grs_capm = (`T' / `num_portfolios') * (`df
> _denominator' / (`T' - `K_capm' - 1)) * (`numera
> tor_part' / `denominator')

. 
. // Get p-value from F-distribution
. local pval_capm = Ftail(`df_numerator', `df_deno
> minator', `grs_capm')

. 
. di "CAPM Results:"
CAPM Results:

. di "  GRS F-statistic: " %10.4f `grs_capm'
  GRS F-statistic:     3.3403

. di "  Degrees of freedom: (" `df_numerator' ", "
>  `df_denominator' ")"
  Degrees of freedom: (25, 1161)

. di "  P-value: " %10.6f `pval_capm'
  P-value:   0.000000

. di ""


. 
. if `pval_capm' < 0.05 {
.     di "  ==> REJECT H0 at 5% level"
  ==> REJECT H0 at 5% level
.     di "      The CAPM alphas are jointly signif
> icantly different from zero"
      The CAPM alphas are jointly significantly di
> fferent from zero
.     di "      (Not surprising - CAPM is too simp
> le)"
      (Not surprising - CAPM is too simple)
. }

. else {
.     di "  ==> FAIL TO REJECT H0 at 5% level"
.     di "      (Would be shocking if CAPM actuall
> y worked this well!)"
. }

. 
. // Clean up the workspace - don't need these res
> iduals anymore
. drop resid_capm_*

. 
. /*----------------------------------------------
> --------------------------------
>     PART 2: GRS Test for Fama-French Three-Facto
> r Model
>     
>     Now let's see if adding SMB and HML helps ex
> plain the cross-section better
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "TEST 2: Fama-French Three-Factor Model (MKT 
> + SMB + HML)"
TEST 2: Fama-French Three-Factor Model (MKT + SMB 
> + HML)

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. local K_ff3 = 3  // three factors now

. 
. * Step 1: Run 25 three-factor regressions
. di "Running 25 three-factor regressions..."
Running 25 three-factor regressions...

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         quietly regress exret`size'`bm' mktrf
>  smb hml
  4.         quietly predict resid_ff3_`size'`bm',
>  residuals
  5.         local alpha_ff3_`size'`bm' = _b[_cons
> ]
  6.     }
  7. }

. 
. * Step 2: Alpha vector for three-factor model
. matrix alpha_ff3 = J(25, 1, .)

. local counter = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         matrix alpha_ff3[`counter', 1] = `alp
> ha_ff3_`size'`bm''
  4.         local counter = `counter' + 1
  5.     }
  6. }

. 
. * Step 3: Residual covariance matrix
. local all_resids_ff3 ""

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         local all_resids_ff3 "`all_resids_ff3
> ' resid_ff3_`size'`bm'"
  4.     }
  5. }

. 
. quietly correlate `all_resids_ff3', covariance

. matrix Sigma_ff3 = r(C)

. 
. * Step 4: Factor statistics (now we have 3 facto
> rs)
. quietly summarize mktrf

. local mu_mkt = r(mean)

. quietly summarize smb

. local mu_smb = r(mean)

. quietly summarize hml  

. local mu_hml = r(mean)

. 
. // Put means into a vector
. matrix mu_vec = (`mu_mkt' \ `mu_smb' \ `mu_hml')

. 
. // Factor covariance matrix (Omega in GRS paper)
. quietly correlate mktrf smb hml, covariance

. matrix Omega = r(C)

. 
. * Step 5: Calculate GRS for three-factor model
. matrix Sigma_ff3_inv = invsym(Sigma_ff3)

. matrix quad_alpha = alpha_ff3' * Sigma_ff3_inv *
>  alpha_ff3

. local numerator_ff3 = quad_alpha[1,1]

. 
. // Multi-factor Sharpe ratio: mu' * Omega^-1 * m
> u
. matrix Omega_inv = invsym(Omega)

. matrix sharpe_quad_ff3 = mu_vec' * Omega_inv * m
> u_vec

. local sharpe_sq_ff3 = sharpe_quad_ff3[1,1]

. local denominator_ff3 = 1 + `sharpe_sq_ff3'

. 
. // GRS statistic
. local df_denom_ff3 = `T' - `num_portfolios' - `K
> _ff3'

. local grs_ff3 = (`T' / `num_portfolios') * (`df_
> denom_ff3' / (`T' - `K_ff3' - 1)) * (`numerator_
> ff3' / `denominator_ff3')

. 
. // P-value
. local pval_ff3 = Ftail(`df_numerator', `df_denom
> _ff3', `grs_ff3')

. 
. di "Three-Factor Model Results:"
Three-Factor Model Results:

. di "  GRS F-statistic: " %10.4f `grs_ff3'
  GRS F-statistic:     3.3140

. di "  Degrees of freedom: (" `df_numerator' ", "
>  `df_denom_ff3' ")"
  Degrees of freedom: (25, 1159)

. di "  P-value: " %10.6f `pval_ff3'
  P-value:   0.000000

. di ""


. 
. if `pval_ff3' < 0.05 {
.     di "  ==> REJECT H0 at 5% level"
  ==> REJECT H0 at 5% level
.     di "      Still some pricing errors left (bu
> t much better than CAPM)"
      Still some pricing errors left (but much bet
> ter than CAPM)
. }

. else {
.     di "  ==> FAIL TO REJECT H0 at 5% level"
.     di "      Three-factor model does a good job
>  pricing these 25 portfolios!"
. }

. 
. // Clean up
. drop resid_ff3_*

. 
. /*----------------------------------------------
> --------------------------------
>     PART 3: Additional Diagnostics
>     
>     Let's look at some other metrics to see how 
> much the 3-factor model helps
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "ADDITIONAL DIAGNOSTICS"
ADDITIONAL DIAGNOSTICS

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. * Calculate average absolute alpha (intuitive me
> asure of pricing errors)
. local sum_abs_alpha_capm = 0

. local sum_abs_alpha_ff3 = 0

. 
. forvalues i = 1/25 {
  2.     local sum_abs_alpha_capm = `sum_abs_alpha
> _capm' + abs(alpha_capm[`i', 1])
  3.     local sum_abs_alpha_ff3 = `sum_abs_alpha_
> ff3' + abs(alpha_ff3[`i', 1])
  4. }

. 
. local avg_abs_alpha_capm = `sum_abs_alpha_capm' 
> / 25

. local avg_abs_alpha_ff3 = `sum_abs_alpha_ff3' / 
> 25

. 
. * Sum of squared alphas (another common metric)
. local sum_sq_alpha_capm = 0

. local sum_sq_alpha_ff3 = 0

. 
. forvalues i = 1/25 {
  2.     local sum_sq_alpha_capm = `sum_sq_alpha_c
> apm' + (alpha_capm[`i', 1])^2
  3.     local sum_sq_alpha_ff3 = `sum_sq_alpha_ff
> 3' + (alpha_ff3[`i', 1])^2
  4. }

. 
. // Display comparison table
. di "                                    CAPM    
>   Three-Factor"
                                    CAPM      Thre
> e-Factor

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di "Average |alpha| (% per month):   " %8.4f `av
> g_abs_alpha_capm' "     " %8.4f `avg_abs_alpha_f
> f3'
Average |alpha| (% per month):     0.1514       0.
> 1158

. di "Sum of Squared Alphas:           " %8.4f `su
> m_sq_alpha_capm' "     " %8.4f `sum_sq_alpha_ff3
> '
Sum of Squared Alphas:             0.9797       0.
> 8805

. di "GRS F-statistic:                 " %8.4f `gr
> s_capm' "     " %8.4f `grs_ff3'
GRS F-statistic:                   3.3403       3.
> 3140

. di "GRS p-value:                     " %8.6f `pv
> al_capm' "   " %8.6f `pval_ff3'
GRS p-value:                     0.000000   0.0000
> 00

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. 
. /*----------------------------------------------
> --------------------------------
>     PART 4: How Much Improvement?
>     
>     Calculate percentage reductions in pricing e
> rrors
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "MODEL IMPROVEMENT METRICS"
MODEL IMPROVEMENT METRICS

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. 
. local improvement_grs = (1 - `grs_ff3'/`grs_capm
> ') * 100

. local improvement_ssa = (1 - `sum_sq_alpha_ff3'/
> `sum_sq_alpha_capm') * 100

. local improvement_avg = (1 - `avg_abs_alpha_ff3'
> /`avg_abs_alpha_capm') * 100

. 
. di "Going from CAPM to Three-Factor Model:"
Going from CAPM to Three-Factor Model:

. di "  - GRS F-statistic drops by: " %5.1f `impro
> vement_grs' "%"
  - GRS F-statistic drops by:   0.8%

. di "  - Sum of Squared Alphas drops by: " %5.1f 
> `improvement_ssa' "%"
  - Sum of Squared Alphas drops by:  10.1%

. di "  - Average |alpha| drops by: " %5.1f `impro
> vement_avg' "%"
  - Average |alpha| drops by:  23.5%

. di ""


. di "(Basically, SMB and HML do a lot of heavy li
> fting!)"
(Basically, SMB and HML do a lot of heavy lifting!
> )

. 
. /*----------------------------------------------
> --------------------------------
>     PART 5: Save Results to CSV
>     
>     Export for LaTeX table later
> ------------------------------------------------
> ------------------------------*/
. 
. preserve

. 
. clear

. set obs 2
Number of observations (_N) was 0, now 2.

. 
. gen str30 model = ""
(2 missing values generated)

. gen grs_fstat = .
(2 missing values generated)

. gen df_num = .
(2 missing values generated)

. gen df_denom = .
(2 missing values generated)

. gen p_value = .
(2 missing values generated)

. gen avg_abs_alpha = .
(2 missing values generated)

. gen sum_sq_alpha = .
(2 missing values generated)

. 
. // Row 1: CAPM results
. replace model = "CAPM" in 1
(1 real change made)

. replace grs_fstat = `grs_capm' in 1
(1 real change made)

. replace df_num = `df_numerator' in 1
(1 real change made)

. replace df_denom = `df_denominator' in 1
(1 real change made)

. replace p_value = `pval_capm' in 1
(1 real change made)

. replace avg_abs_alpha = `avg_abs_alpha_capm' in 
> 1
(1 real change made)

. replace sum_sq_alpha = `sum_sq_alpha_capm' in 1
(1 real change made)

. 
. // Row 2: Three-factor results
. replace model = "Three-Factor" in 2
(1 real change made)

. replace grs_fstat = `grs_ff3' in 2
(1 real change made)

. replace df_num = `df_numerator' in 2
(1 real change made)

. replace df_denom = `df_denom_ff3' in 2
(1 real change made)

. replace p_value = `pval_ff3' in 2
(1 real change made)

. replace avg_abs_alpha = `avg_abs_alpha_ff3' in 2
(1 real change made)

. replace sum_sq_alpha = `sum_sq_alpha_ff3' in 2
(1 real change made)

. 
. export delimited "$root/output/tables/table9c_gr
> s_test.csv", replace
file /Users/pei-chin/Research/FamaFrench_1993_Repl
> ication/output/tables/table9c_grs_test.csv saved

. 
. restore

. 
. /*----------------------------------------------
> --------------------------------
>     FINAL SUMMARY
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "GRS TEST SUMMARY - FINAL VERDICT"
GRS TEST SUMMARY - FINAL VERDICT

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "The GRS test checks whether all 25 portfolio
>  alphas are jointly zero."
The GRS test checks whether all 25 portfolio alpha
> s are jointly zero.

. di "If we reject, it means the model leaves syst
> ematic pricing errors."
If we reject, it means the model leaves systematic
>  pricing errors.

. di ""


. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di "Model             GRS F-stat    p-value     
>  Decision"
Model             GRS F-stat    p-value      Decis
> ion

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di "CAPM              " %8.2f `grs_capm' "     "
>  %8.6f `pval_capm' "   " cond(`pval_capm'<0.05, 
> "REJECT H0", "FAIL TO REJECT")
CAPM                  3.34     0.000000   REJECT H
> 0

. di "Three-Factor      " %8.2f `grs_ff3' "     " 
> %8.6f `pval_ff3' "   " cond(`pval_ff3'<0.05, "RE
> JECT H0", "FAIL TO REJECT")
Three-Factor          3.31     0.000000   REJECT H
> 0

. di "--------------------------------------------
> ------------------"
--------------------------------------------------
> ------------

. di ""


. di "Bottom Line:"
Bottom Line:

. di "  - GRS F drops by " %4.1f `improvement_grs'
>  "% (from " %5.2f `grs_capm' " to " %5.2f `grs_f
> f3' ")"
  - GRS F drops by  0.8% (from  3.34 to  3.31)

. di "  - Three-factor model is a MAJOR improvemen
> t over CAPM"
  - Three-factor model is a MAJOR improvement over
>  CAPM

. di "  - SMB and HML capture size and value effec
> ts that CAPM misses"
  - SMB and HML capture size and value effects tha
> t CAPM misses

. di ""


. di "Output saved to: $root/output/tables/table9c
> _grs_test.csv"
Output saved to: /Users/pei-chin/Research/FamaFren
> ch_1993_Replication/output/tables/table9c_grs_te
> st.csv

. di "============================================
> =========================="
==================================================
> ====================

. 
. /*
> POST-RUN NOTES:
> 
> 1. The GRS formula was the hardest part of this 
> whole project. Had to check
>    against several sources to make sure I got it
>  right:
>    - Gibbons, Ross, Shanken (1989) original pape
> r
>    - Cochrane (2005) Asset Pricing textbook
>    - Some random guy's replication code on GitHu
> b
>    
> 2. Things to double-check:
>    - Are the degrees of freedom correct? (Pretty
>  sure they are)
>    - Should I be using robust standard errors so
> mewhere? (Don't think so for GRS)
>    - Is the factor covariance matrix properly sp
> ecified? (Looks good)
> 
> 3. If the results don't match Table 9c exactly, 
> could be:
>    - Different sample period (check date range)
>    - Different portfolio construction (check 05_
> portfolios.do)
>    - Rounding differences (probably fine)
>    
> 4. TODO: Maybe add a plot showing individual alp
> has for CAPM vs FF3?
>    Would be nice to visualize which portfolios h
> ave the biggest improvements.
> 
> */
. 
end of do-file

. do "/var/folders/59/xg339rr11r37z8773vj0lvjm0000
> gn/T//SD59607.000000"

. /*==============================================
> ================================
>     06_figures.do
>     
>     Purpose: Create visualizations for Fama-Fren
> ch (1993) replication
>     
>     Figures:
>     1. Mean returns by Size and B/M
>     2. SMB loadings pattern
>     3. HML loadings pattern
>     4. CAPM vs Three-Factor alphas
>     5. R-squared comparison
>     6. Factor cumulative returns
>     
>     Input:  merged_data.dta
>     Output: PNG figures
> ================================================
> ==============================*/
. 
. clear all

. set more off

. 
. global root "/Users/pei-chin/Research/FamaFrench
> _1993_Replication"

. 
. * Create output directory
. cap mkdir "$root/output"

. cap mkdir "$root/output/figures"

. 
. * Set graph scheme
. set scheme s2color

. 
. * Load data
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "CREATING FIGURES"
CREATING FIGURES

. di "============================================
> =========================="
==================================================
> ====================

. 
. /*----------------------------------------------
> --------------------------------
>     1. Run Regressions to Get Coefficients
> ------------------------------------------------
> ------------------------------*/
. 
. * Store results in matrices
. matrix mean_ret = J(5, 5, .)

. matrix alpha_capm = J(5, 5, .)

. matrix alpha_ff3 = J(5, 5, .)

. matrix rsq_capm = J(5, 5, .)

. matrix rsq_ff3 = J(5, 5, .)

. matrix s_smb = J(5, 5, .)

. matrix h_hml = J(5, 5, .)

. 
. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         * Mean returns
.         quietly summarize exret`size'`bm'
  4.         matrix mean_ret[`size', `bm'] = r(mea
> n)
  5.         
.         * CAPM
.         quietly regress exret`size'`bm' mktrf
  6.         matrix alpha_capm[`size', `bm'] = _b[
> _cons]
  7.         matrix rsq_capm[`size', `bm'] = e(r2)
  8.         
.         * Three-factor
.         quietly regress exret`size'`bm' mktrf sm
> b hml
  9.         matrix alpha_ff3[`size', `bm'] = _b[_
> cons]
 10.         matrix rsq_ff3[`size', `bm'] = e(r2)
 11.         matrix s_smb[`size', `bm'] = _b[smb]
 12.         matrix h_hml[`size', `bm'] = _b[hml]
 13.     }
 14. }

. 
. /*----------------------------------------------
> --------------------------------
>     Figure 1: Mean Excess Returns by Size
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "Creating Figure 1: Mean Returns by Size..."
Creating Figure 1: Mean Returns by Size...

. 
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen mean_return = .
(5 missing values generated)

. 
. * Calculate average return for each size quintil
> e
. forvalues s = 1/5 {
  2.     local sum = 0
  3.     forvalues b = 1/5 {
  4.         local sum = `sum' + mean_ret[`s', `b'
> ]
  5.     }
  6.     replace mean_return = `sum'/5 if size == 
> `s'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. label define size_lbl 1 "Small" 2 "2" 3 "3" 4 "4
> " 5 "Big"

. label values size size_lbl

. 
. twoway (bar mean_return size, barwidth(0.7) colo
> r(navy)) ///
>     (scatter mean_return size, msymbol(none) mla
> bel(mean_return) mlabformat(%4.2f) mlabposition(
> 12) mlabcolor(black)), ///
>     title("Average Monthly Excess Returns by Siz
> e Quintile") ///
>     subtitle("Size Effect: Small stocks earn hig
> her returns") ///
>     ytitle("Mean Excess Return (% per month)") /
> //
>     xtitle("Size Quintile") ///
>     xlabel(1 "Small" 2 "2" 3 "3" 4 "4" 5 "Big") 
> ///
>     ylabel(0(0.2)1.0) ///
>     legend(off) ///
>     note("Sample: 1926m7 - 2025m5")

. 
. graph export "$root/output/figures/fig1_returns_
> by_size.png", replace width(1200)
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/output/figures/fig1_returns_by_si
    > ze.png saved as PNG format

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Figure 2: Mean Excess Returns by B/M
> ------------------------------------------------
> ------------------------------*/
. 
. di "Creating Figure 2: Mean Returns by B/M..."
Creating Figure 2: Mean Returns by B/M...

. 
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen bm = _n

. gen mean_return = .
(5 missing values generated)

. 
. * Calculate average return for each B/M quintile
. forvalues b = 1/5 {
  2.     local sum = 0
  3.     forvalues s = 1/5 {
  4.         local sum = `sum' + mean_ret[`s', `b'
> ]
  5.     }
  6.     replace mean_return = `sum'/5 if bm == `b
> '
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (bar mean_return bm, barwidth(0.7) color(
> maroon)) ///
>     (scatter mean_return bm, msymbol(none) mlabe
> l(mean_return) mlabformat(%4.2f) mlabposition(12
> ) mlabcolor(black)), ///
>     title("Average Monthly Excess Returns by Boo
> k-to-Market Quintile") ///
>     subtitle("Value Effect: High B/M stocks earn
>  higher returns") ///
>     ytitle("Mean Excess Return (% per month)") /
> //
>     xtitle("Book-to-Market Quintile") ///
>     xlabel(1 "Low (Growth)" 2 "2" 3 "3" 4 "4" 5 
> "High (Value)") ///
>     ylabel(0(0.2)1.2) ///
>     legend(off) ///
>     note("Sample: 1926m7 - 2025m5")

. 
. graph export "$root/output/figures/fig2_returns_
> by_bm.png", replace width(1200)
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/output/figures/fig2_returns_by_bm
    > .png saved as PNG format

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Figure 3: SMB Loadings by Size
> ------------------------------------------------
> ------------------------------*/
. 
. di "Creating Figure 3: SMB Loadings by Size..."
Creating Figure 3: SMB Loadings by Size...

. 
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen size = _n

. gen smb_loading = .
(5 missing values generated)

. 
. * Calculate average SMB loading for each size qu
> intile
. forvalues s = 1/5 {
  2.     local sum = 0
  3.     forvalues b = 1/5 {
  4.         local sum = `sum' + s_smb[`s', `b']
  5.     }
  6.     replace smb_loading = `sum'/5 if size == 
> `s'
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (bar smb_loading size, barwidth(0.7) colo
> r(forest_green)) ///
>     (scatter smb_loading size, msymbol(none) mla
> bel(smb_loading) mlabformat(%4.2f) mlabposition(
> 12) mlabcolor(black)), ///
>     title("SMB Factor Loadings by Size Quintile"
> ) ///
>     subtitle("Small stocks load positively, Big 
> stocks load negatively on SMB") ///
>     ytitle("SMB Loading (s)") ///
>     xtitle("Size Quintile") ///
>     xlabel(1 "Small" 2 "2" 3 "3" 4 "4" 5 "Big") 
> ///
>     ylabel(-0.5(0.5)1.5) ///
>     yline(0, lcolor(black) lpattern(dash)) ///
>     legend(off) ///
>     note("From three-factor regressions: R - RF 
> = a + b*MktRF + s*SMB + h*HML")

. 
. graph export "$root/output/figures/fig3_smb_load
> ings.png", replace width(1200)
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/output/figures/fig3_smb_loadings.
    > png saved as PNG format

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Figure 4: HML Loadings by B/M
> ------------------------------------------------
> ------------------------------*/
. 
. di "Creating Figure 4: HML Loadings by B/M..."
Creating Figure 4: HML Loadings by B/M...

. 
. preserve

. clear

. set obs 5
Number of observations (_N) was 0, now 5.

. gen bm = _n

. gen hml_loading = .
(5 missing values generated)

. 
. * Calculate average HML loading for each B/M qui
> ntile
. forvalues b = 1/5 {
  2.     local sum = 0
  3.     forvalues s = 1/5 {
  4.         local sum = `sum' + h_hml[`s', `b']
  5.     }
  6.     replace hml_loading = `sum'/5 if bm == `b
> '
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (bar hml_loading bm, barwidth(0.7) color(
> dkorange)) ///
>     (scatter hml_loading bm, msymbol(none) mlabe
> l(hml_loading) mlabformat(%4.2f) mlabposition(12
> ) mlabcolor(black)), ///
>     title("HML Factor Loadings by Book-to-Market
>  Quintile") ///
>     subtitle("Growth stocks load negatively, Val
> ue stocks load positively on HML") ///
>     ytitle("HML Loading (h)") ///
>     xtitle("Book-to-Market Quintile") ///
>     xlabel(1 "Low (Growth)" 2 "2" 3 "3" 4 "4" 5 
> "High (Value)") ///
>     ylabel(-0.5(0.5)1.0) ///
>     yline(0, lcolor(black) lpattern(dash)) ///
>     legend(off) ///
>     note("From three-factor regressions: R - RF 
> = a + b*MktRF + s*SMB + h*HML")

. 
. graph export "$root/output/figures/fig4_hml_load
> ings.png", replace width(1200)
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/output/figures/fig4_hml_loadings.
    > png saved as PNG format

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Figure 5: CAPM vs Three-Factor Alphas Compar
> ison
> ------------------------------------------------
> ------------------------------*/
. 
. di "Creating Figure 5: Alpha Comparison..."
Creating Figure 5: Alpha Comparison...

. 
. preserve

. clear

. set obs 25
Number of observations (_N) was 0, now 25.

. gen portfolio = _n

. gen alpha_capm_val = .
(25 missing values generated)

. gen alpha_ff3_val = .
(25 missing values generated)

. 
. local i = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         replace alpha_capm_val = alpha_capm[`
> size', `bm'] if portfolio == `i'
  4.         replace alpha_ff3_val = alpha_ff3[`si
> ze', `bm'] if portfolio == `i'
  5.         local i = `i' + 1
  6.     }
  7. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. * Scatter plot
. twoway (scatter alpha_ff3_val alpha_capm_val, ms
> ymbol(circle) mcolor(navy) msize(medium)) ///
>     (function y=x, range(-0.8 0.5) lcolor(red) l
> pattern(dash)) ///
>     (function y=0, range(-0.8 0.5) lcolor(gray) 
> lpattern(dot)), ///
>     title("CAPM vs Three-Factor Model Alphas") /
> //
>     subtitle("Three-factor alphas are closer to 
> zero") ///
>     ytitle("Three-Factor Alpha (% per month)") /
> //
>     xtitle("CAPM Alpha (% per month)") ///
>     ylabel(-0.8(0.2)0.4) ///
>     xlabel(-0.8(0.2)0.6) ///
>     legend(order(1 "25 Portfolios" 2 "45-degree 
> line") position(5) ring(0)) ///
>     note("Points below 45-degree line indicate F
> F3 alpha < CAPM alpha (in absolute value)")

. 
. graph export "$root/output/figures/fig5_alpha_co
> mparison.png", replace width(1200)
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/output/figures/fig5_alpha_compari
    > son.png saved as PNG format

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Figure 6: R-squared Comparison
> ------------------------------------------------
> ------------------------------*/
. 
. di "Creating Figure 6: R-squared Comparison..."
Creating Figure 6: R-squared Comparison...

. 
. preserve

. clear

. set obs 25
Number of observations (_N) was 0, now 25.

. gen portfolio = _n

. gen rsq_capm_val = .
(25 missing values generated)

. gen rsq_ff3_val = .
(25 missing values generated)

. gen portfolio_name = ""
(25 missing values generated)

. 
. local i = 1

. forvalues size = 1/5 {
  2.     forvalues bm = 1/5 {
  3.         replace rsq_capm_val = rsq_capm[`size
> ', `bm'] if portfolio == `i'
  4.         replace rsq_ff3_val = rsq_ff3[`size',
>  `bm'] if portfolio == `i'
  5.         local size_label = cond(`size'==1, "S
> ", cond(`size'==5, "B", "`size'"))
  6.         local bm_label = cond(`bm'==1, "L", c
> ond(`bm'==5, "H", "`bm'"))
  7.         replace portfolio_name = "`size_label
> '`bm_label'" if portfolio == `i'
  8.         local i = `i' + 1
  9.     }
 10. }
(1 real change made)
(1 real change made)
variable portfolio_name was str1 now str2
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. * Calculate averages
. quietly summarize rsq_capm_val

. local avg_rsq_capm = r(mean)

. quietly summarize rsq_ff3_val

. local avg_rsq_ff3 = r(mean)

. 
. * Bar chart for average R-squared
. clear

. set obs 2
Number of observations (_N) was 0, now 2.

. gen model = _n

. gen avg_rsq = .
(2 missing values generated)

. gen model_name = ""
(2 missing values generated)

. 
. replace model_name = "CAPM" if model == 1
variable model_name was str1 now str4
(1 real change made)

. replace avg_rsq = `avg_rsq_capm' if model == 1
(1 real change made)

. replace model_name = "Three-Factor" if model == 
> 2
variable model_name was str4 now str12
(1 real change made)

. replace avg_rsq = `avg_rsq_ff3' if model == 2
(1 real change made)

. 
. twoway (bar avg_rsq model, barwidth(0.5) color(n
> avy maroon)) ///
>     (scatter avg_rsq model, msymbol(none) mlabel
> (avg_rsq) mlabformat(%4.3f) mlabposition(12) mla
> bcolor(black)), ///
>     title("Average R-squared: CAPM vs Three-Fact
> or Model") ///
>     subtitle("Three-factor model explains substa
> ntially more variation") ///
>     ytitle("Average R-squared") ///
>     xtitle("") ///
>     xlabel(1 "CAPM" 2 "Three-Factor") ///
>     ylabel(0(0.2)1.0) ///
>     legend(off) ///
>     note("Average across 25 Size-B/M portfolios"
> )

. 
. graph export "$root/output/figures/fig6_rsq_comp
> arison.png", replace width(1200)
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/output/figures/fig6_rsq_compariso
    > n.png saved as PNG format

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Figure 7: Cumulative Factor Returns
> ------------------------------------------------
> ------------------------------*/
. 
. di "Creating Figure 7: Cumulative Factor Returns
> ..."
Creating Figure 7: Cumulative Factor Returns...

. 
. use "$root/data/processed/merged_data.dta", clea
> r

. 
. * Calculate cumulative returns (log scale approx
> imation)
. gen cum_mktrf = sum(mktrf/100)

. gen cum_smb = sum(smb/100)

. gen cum_hml = sum(hml/100)

. 
. * Convert to percentage growth
. replace cum_mktrf = (exp(cum_mktrf) - 1) * 100
(1,187 real changes made)

. replace cum_smb = (exp(cum_smb) - 1) * 100
(1,187 real changes made)

. replace cum_hml = (exp(cum_hml) - 1) * 100
(1,187 real changes made)

. 
. twoway (line cum_mktrf date, lcolor(navy) lwidth
> (medium)) ///
>     (line cum_smb date, lcolor(forest_green) lwi
> dth(medium)) ///
>     (line cum_hml date, lcolor(maroon) lwidth(me
> dium)), ///
>     title("Cumulative Factor Returns (1926-2025)
> ") ///
>     subtitle("Log-scale cumulative returns") ///
>     ytitle("Cumulative Return (%)") ///
>     xtitle("Date") ///
>     legend(order(1 "Market (Mkt-RF)" 2 "Size (SM
> B)" 3 "Value (HML)") position(11) ring(0) cols(1
> )) ///
>     note("Starting value = 0% in July 1926")

. 
. graph export "$root/output/figures/fig7_cumulati
> ve_returns.png", replace width(1200)
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/output/figures/fig7_cumulative_re
    > turns.png saved as PNG format

. 
. /*----------------------------------------------
> --------------------------------
>     Figure 8: Heatmap of Mean Returns (5x5)
> ------------------------------------------------
> ------------------------------*/
. 
. di "Creating Figure 8: Mean Returns Heatmap..."
Creating Figure 8: Mean Returns Heatmap...

. 
. preserve

. clear

. set obs 25
Number of observations (_N) was 0, now 25.

. gen size = .
(25 missing values generated)

. gen bm = .
(25 missing values generated)

. gen mean_return = .
(25 missing values generated)

. 
. local i = 1

. forvalues s = 1/5 {
  2.     forvalues b = 1/5 {
  3.         replace size = `s' in `i'
  4.         replace bm = `b' in `i'
  5.         replace mean_return = mean_ret[`s', `
> b'] in `i'
  6.         local i = `i' + 1
  7.     }
  8. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. * Create heatmap using scatter with marker size
. twoway (scatter size bm [w=mean_return], msymbol
> (square) msize(*3) mcolor(navy%70)), ///
>     title("Mean Excess Returns: 5x5 Size-B/M Por
> tfolios") ///
>     subtitle("Marker size proportional to return
>  magnitude") ///
>     ytitle("Size (1=Small, 5=Big)") ///
>     xtitle("Book-to-Market (1=Low, 5=High)") ///
>     ylabel(1 "Small" 2 "2" 3 "3" 4 "4" 5 "Big", 
> angle(0)) ///
>     xlabel(1 "Low" 2 "2" 3 "3" 4 "4" 5 "High") /
> //
>     legend(off) ///
>     note("Returns increase from Big/Low (bottom-
> left) to Small/High (top-right)")
(analytic weights assumed)
(analytic weights assumed)
(analytic weights assumed)

. 
. graph export "$root/output/figures/fig8_returns_
> heatmap.png", replace width(1200)
file
    /Users/pei-chin/Research/FamaFrench_1993_Rep
    > lication/output/figures/fig8_returns_heatm
    > ap.png saved as PNG format

. restore

. 
. /*----------------------------------------------
> --------------------------------
>     Summary
> ------------------------------------------------
> ------------------------------*/
. 
. di ""


. di "============================================
> =========================="
==================================================
> ====================

. di "FIGURES CREATED SUCCESSFULLY!"
FIGURES CREATED SUCCESSFULLY!

. di "============================================
> =========================="
==================================================
> ====================

. di ""


. di "Output files saved to: $root/output/figures/
> "
Output files saved to: /Users/pei-chin/Research/Fa
> maFrench_1993_Replication/output/figures/

. di ""


. di "  fig1_returns_by_size.png     - Size effect
>  visualization"
  fig1_returns_by_size.png     - Size effect visua
> lization

. di "  fig2_returns_by_bm.png       - Value effec
> t visualization"
  fig2_returns_by_bm.png       - Value effect visu
> alization

. di "  fig3_smb_loadings.png        - SMB factor 
> loadings by size"
  fig3_smb_loadings.png        - SMB factor loadin
> gs by size

. di "  fig4_hml_loadings.png        - HML factor 
> loadings by B/M"
  fig4_hml_loadings.png        - HML factor loadin
> gs by B/M

. di "  fig5_alpha_comparison.png    - CAPM vs FF3
>  alphas scatter"
  fig5_alpha_comparison.png    - CAPM vs FF3 alpha
> s scatter

. di "  fig6_rsq_comparison.png      - R-squared c
> omparison"
  fig6_rsq_comparison.png      - R-squared compari
> son

. di "  fig7_cumulative_returns.png  - Factor cumu
> lative returns"
  fig7_cumulative_returns.png  - Factor cumulative
>  returns

. di "  fig8_returns_heatmap.png     - 5x5 returns
>  heatmap"
  fig8_returns_heatmap.png     - 5x5 returns heatm
> ap

. di ""


. di "============================================
> =========================="
==================================================
> ====================

. 
end of do-file

